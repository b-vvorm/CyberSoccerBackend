(function($){$.fn.layout=function(opts){var
prefix="ui-layout-",defaults={paneClass:prefix+"pane",resizerClass:prefix+"resizer",togglerClass:prefix+"toggler",togglerInnerClass:prefix+"",buttonClass:prefix+"button",contentSelector:"."+prefix+"content",contentIgnoreSelector:"."+prefix+"ignore"};var options={name:"",scrollToBookmarkOnLoad:true,defaults:{applyDefaultStyles:false,closable:true,resizable:true,slidable:true,contentSelector:defaults.contentSelector,contentIgnoreSelector:defaults.contentIgnoreSelector,paneClass:defaults.paneClass,resizerClass:defaults.resizerClass,togglerClass:defaults.togglerClass,buttonClass:defaults.buttonClass,resizerDragOpacity:1,maskIframesOnResize:true,minSize:0,maxSize:0,spacing_open:6,spacing_closed:6,togglerLength_open:50,togglerLength_closed:50,togglerAlign_open:"center",togglerAlign_closed:"center",togglerTip_open:"Close",togglerTip_closed:"Open",resizerTip:"Resize",sliderTip:"Slide Open",sliderCursor:"pointer",slideTrigger_open:"click",slideTrigger_close:"mouseout",hideTogglerOnSlide:false,togglerContent_open:"",togglerContent_closed:"",showOverflowOnHover:false,enableCursorHotkey:true,customHotkeyModifier:"SHIFT",fxName:"slide",fxSpeed:null,fxSettings:{},initClosed:false,initHidden:false},north:{paneSelector:"."+prefix+"north",size:"auto",resizerCursor:"n-resize"},south:{paneSelector:"."+prefix+"south",size:"auto",resizerCursor:"s-resize"},east:{paneSelector:"."+prefix+"east",size:200,resizerCursor:"e-resize"},west:{paneSelector:"."+prefix+"west",size:200,resizerCursor:"w-resize"},center:{paneSelector:"."+prefix+"center"}};var effects={slide:{all:{duration:"fast"},north:{direction:"up"},south:{direction:"down"},east:{direction:"right"},west:{direction:"left"}},drop:{all:{duration:"slow"},north:{direction:"up"},south:{direction:"down"},east:{direction:"right"},west:{direction:"left"}},scale:{all:{duration:"fast"}}};var config={allPanes:"north,south,east,west,center",borderPanes:"north,south,east,west",zIndex:{resizer_normal:1,pane_normal:2,mask:4,sliding:100,resizing:10000,animation:10000},resizers:{cssReq:{position:"absolute",padding:0,margin:0,fontSize:"1px",textAlign:"left",overflow:"hidden",zIndex:1},cssDef:{background:"#DDD",border:"none"}},togglers:{cssReq:{position:"absolute",display:"block",padding:0,margin:0,overflow:"hidden",textAlign:"center",fontSize:"1px",cursor:"pointer",zIndex:1},cssDef:{background:"#AAA"}},content:{cssReq:{overflow:"auto"},cssDef:{}},defaults:{cssReq:{position:"absolute",margin:0,zIndex:2},cssDef:{padding:"10px",background:"#FFF",border:"1px solid #BBB",overflow:"auto"}},north:{edge:"top",sizeType:"height",dir:"horz",cssReq:{top:0,bottom:"auto",left:0,right:0,width:"auto"}},south:{edge:"bottom",sizeType:"height",dir:"horz",cssReq:{top:"auto",bottom:0,left:0,right:0,width:"auto"}},east:{edge:"right",sizeType:"width",dir:"vert",cssReq:{left:"auto",right:0,top:"auto",bottom:"auto",height:"auto"}},west:{edge:"left",sizeType:"width",dir:"vert",cssReq:{left:0,right:"auto",top:"auto",bottom:"auto",height:"auto"}},center:{dir:"center",cssReq:{left:"auto",right:"auto",top:"auto",bottom:"auto",height:"auto",width:"auto"}}};var state={id:Math.floor(Math.random()*10000),container:{},north:{},south:{},east:{},west:{},center:{}};var
altEdge={top:"bottom",bottom:"top",left:"right",right:"left"},altSide={north:"south",south:"north",east:"west",west:"east"};var isStr=function(o){if(typeof o=="string")return true;else if(typeof o=="object"){try{var match=o.constructor.toString().match(/string/i);return(match!==null);}catch(e){}}return false;};var str=function(o){if(typeof o=="string"||isStr(o))return $.trim(o);else return o;};var min=function(x,y){return Math.min(x,y);};var max=function(x,y){return Math.max(x,y);};var transformData=function(d){var json={defaults:{fxSettings:{}},north:{fxSettings:{}},south:{fxSettings:{}},east:{fxSettings:{}},west:{fxSettings:{}},center:{fxSettings:{}}};d=d||{};if(d.effects||d.defaults||d.north||d.south||d.west||d.east||d.center)json=$.extend(json,d);else
$.each(d,function(key,val){a=key.split("__");json[a[1]?a[0]:"defaults"][a[1]?a[1]:a[0]]=val;});return json;};var setFlowCallback=function(action,pane,param){var
cb=action+","+pane+","+(param?1:0),cP,cbPane;$.each(c.borderPanes.split(","),function(i,p){if(c[p].isMoving){bindCallback(p);return false;}});function bindCallback(p,test){cP=c[p];if(!cP.doCallback){cP.doCallback=true;cP.callback=cb;}else{cpPane=cP.callback.split(",")[1];if(cpPane!=p&&cpPane!=pane)bindCallback(cpPane,true);}}};var execFlowCallback=function(pane){var cP=c[pane];c.isLayoutBusy=false;delete cP.isMoving;if(!cP.doCallback||!cP.callback)return;cP.doCallback=false;var
cb=cP.callback.split(","),param=(cb[2]>0?true:false);if(cb[0]=="open")open(cb[1],param);else if(cb[0]=="close")close(cb[1],param);if(!cP.doCallback)cP.callback=null;};var execUserCallback=function(pane,v_fn){if(!v_fn)return;var fn;try{if(typeof v_fn=="function")fn=v_fn;else if(typeof v_fn!="string")return;else if(v_fn.indexOf(",")>0){var
args=v_fn.split(","),fn=eval(args[0]);if(typeof fn=="function"&&args.length>1)return fn(args[1]);}else
fn=eval(v_fn);if(typeof fn=="function")return fn(pane,$Ps[pane],$.extend({},state[pane]),$.extend({},options[pane]),options.name);}catch(ex){}};var cssNum=function($E,prop){var
val=0,hidden=false,visibility="";if(!$.browser.msie){if($.curCSS($E[0],"display",true)=="none"){hidden=true;visibility=$.curCSS($E[0],"visibility",true);$E.css({display:"block",visibility:"hidden"});}}val=parseInt($.curCSS($E[0],prop,true),10)||0;if(hidden){$E.css({display:"none"});if(visibility&&visibility!="hidden")$E.css({visibility:visibility});}return val;};var cssW=function(e,outerWidth){var $E;if(isStr(e)){e=str(e);$E=$Ps[e];}else
$E=$(e);if(outerWidth<=0)return 0;else if(!(outerWidth>0))outerWidth=isStr(e)?getPaneSize(e):$E.outerWidth();if(!$.boxModel)return outerWidth;else
return outerWidth
-cssNum($E,"paddingLeft")-cssNum($E,"paddingRight")-($.curCSS($E[0],"borderLeftStyle",true)=="none"?0:cssNum($E,"borderLeftWidth"))-($.curCSS($E[0],"borderRightStyle",true)=="none"?0:cssNum($E,"borderRightWidth"));};var cssH=function(e,outerHeight){var $E;if(isStr(e)){e=str(e);$E=$Ps[e];}else
$E=$(e);if(outerHeight<=0)return 0;else if(!(outerHeight>0))outerHeight=(isStr(e))?getPaneSize(e):$E.outerHeight();if(!$.boxModel)return outerHeight;else
return outerHeight
-cssNum($E,"paddingTop")-cssNum($E,"paddingBottom")-($.curCSS($E[0],"borderTopStyle",true)=="none"?0:cssNum($E,"borderTopWidth"))-($.curCSS($E[0],"borderBottomStyle",true)=="none"?0:cssNum($E,"borderBottomWidth"));};var cssSize=function(pane,outerSize){if(c[pane].dir=="horz")return cssH(pane,outerSize);else
return cssW(pane,outerSize);};var getPaneSize=function(pane,inclSpace){var
$P=$Ps[pane],o=options[pane],s=state[pane],oSp=(inclSpace?o.spacing_open:0),cSp=(inclSpace?o.spacing_closed:0);if(!$P||s.isHidden)return 0;else if(s.isClosed||(s.isSliding&&inclSpace))return cSp;else if(c[pane].dir=="horz")return $P.outerHeight()+oSp;else
return $P.outerWidth()+oSp;};var setPaneMinMaxSizes=function(pane){var
d=cDims,edge=c[pane].edge,dir=c[pane].dir,o=options[pane],s=state[pane],$P=$Ps[pane],$altPane=$Ps[altSide[pane]],paneSpacing=o.spacing_open,altPaneSpacing=options[altSide[pane]].spacing_open,altPaneSize=(!$altPane?0:(dir=="horz"?$altPane.outerHeight():$altPane.outerWidth())),containerSize=(dir=="horz"?d.innerHeight:d.innerWidth),limitSize=containerSize-paneSpacing-altPaneSize-altPaneSpacing,minSize=s.minSize||0,maxSize=Math.min(s.maxSize||9999,limitSize),minPos,maxPos;switch(pane){case"north":minPos=d.offsetTop+minSize;maxPos=d.offsetTop+maxSize;break;case"west":minPos=d.offsetLeft+minSize;maxPos=d.offsetLeft+maxSize;break;case"south":minPos=d.offsetTop+d.innerHeight-maxSize;maxPos=d.offsetTop+d.innerHeight-minSize;break;case"east":minPos=d.offsetLeft+d.innerWidth-maxSize;maxPos=d.offsetLeft+d.innerWidth-minSize;break;}$.extend(s,{minSize:minSize,maxSize:maxSize,minPosition:minPos,maxPosition:maxPos});};var getPaneDims=function(){var d={top:getPaneSize("north",true),bottom:getPaneSize("south",true),left:getPaneSize("west",true),right:getPaneSize("east",true),width:0,height:0};with(d){width=cDims.innerWidth-left-right;height=cDims.innerHeight-bottom-top;top+=cDims.top;bottom+=cDims.bottom;left+=cDims.left;right+=cDims.right;}return d;};var getElemDims=function($E){var
d={},e,b,p;$.each("Left,Right,Top,Bottom".split(","),function(){e=str(this);b=d["border"+e]=cssNum($E,"border"+e+"Width");p=d["padding"+e]=cssNum($E,"padding"+e);d["offset"+e]=b+p;if($E==$Container)d[e.toLowerCase()]=($.boxModel?p:0);});d.innerWidth=d.outerWidth=$E.outerWidth();d.innerHeight=d.outerHeight=$E.outerHeight();if($.boxModel){d.innerWidth-=(d.offsetLeft+d.offsetRight);d.innerHeight-=(d.offsetTop+d.offsetBottom);}return d;};var setTimer=function(pane,action,fn,ms){var
Layout=window.layout=window.layout||{},Timers=Layout.timers=Layout.timers||{},name="layout_"+state.id+"_"+pane+"_"+action;if(Timers[name])return;else Timers[name]=setTimeout(fn,ms);};var clearTimer=function(pane,action){var
Layout=window.layout=window.layout||{},Timers=Layout.timers=Layout.timers||{},name="layout_"+state.id+"_"+pane+"_"+action;if(Timers[name]){clearTimeout(Timers[name]);delete Timers[name];return true;}else
return false;};var create=function(){initOptions();initContainer();initPanes();initHandles();initResizable();sizeContent("all");if(options.scrollToBookmarkOnLoad)with(self.location)if(hash)replace(hash);initHotkeys();$(window).resize(function(){var timerID="timerLayout_"+state.id;if(window[timerID])clearTimeout(window[timerID]);window[timerID]=null;if(true||$.browser.msie)window[timerID]=setTimeout(resizeAll,100);else
resizeAll();});};var initContainer=function(){try{if($Container[0].tagName=="BODY"){$("html").css({height:"100%",overflow:"hidden"});$("body").css({position:"relative",height:"100%",overflow:"hidden",margin:0,padding:0,border:"none"});}else{var
CSS={overflow:"hidden"},p=$Container.css("position"),h=$Container.css("height");if(!$Container.hasClass("ui-layout-pane")){if(!p||"fixed,absolute,relative".indexOf(p)<0)CSS.position="relative";if(!h||h=="auto")CSS.height="100%";}$Container.css(CSS);}}catch(ex){}cDims=state.container=getElemDims($Container);};var initHotkeys=function(){$.each(c.borderPanes.split(","),function(i,pane){var o=options[pane];if(o.enableCursorHotkey||o.customHotkey){$(document).keydown(keyDown);return false;}});};var initOptions=function(){opts=transformData(opts);if(opts.effects){$.extend(effects,opts.effects);delete opts.effects;}$.each("name,scrollToBookmarkOnLoad".split(","),function(idx,key){if(opts[key]!==undefined)options[key]=opts[key];else if(opts.defaults[key]!==undefined){options[key]=opts.defaults[key];delete opts.defaults[key];}});$.each("paneSelector,resizerCursor,customHotkey".split(","),function(idx,key){delete opts.defaults[key];});$.extend(options.defaults,opts.defaults);c.center=$.extend(true,{},c.defaults,c.center);$.extend(options.center,opts.center);var o_Center=$.extend(true,{},options.defaults,opts.defaults,options.center);$.each("paneClass,contentSelector,contentIgnoreSelector,applyDefaultStyles,showOverflowOnHover".split(","),function(idx,key){options.center[key]=o_Center[key];});var defs=options.defaults;$.each(c.borderPanes.split(","),function(i,pane){c[pane]=$.extend(true,{},c.defaults,c[pane]);o=options[pane]=$.extend(true,{},options.defaults,options[pane],opts.defaults,opts[pane]);if(!o.paneClass)o.paneClass=defaults.paneClass;if(!o.resizerClass)o.resizerClass=defaults.resizerClass;if(!o.togglerClass)o.togglerClass=defaults.togglerClass;$.each(["_open","_close",""],function(i,n){var
sName="fxName"+n,sSpeed="fxSpeed"+n,sSettings="fxSettings"+n;o[sName]=opts[pane][sName]||opts[pane].fxName||opts.defaults[sName]||opts.defaults.fxName||o[sName]||o.fxName||defs[sName]||defs.fxName||"none";var fxName=o[sName];if(fxName=="none"||!$.effects||!$.effects[fxName]||(!effects[fxName]&&!o[sSettings]&&!o.fxSettings))fxName=o[sName]="none";var
fx=effects[fxName]||{},fx_all=fx.all||{},fx_pane=fx[pane]||{};o[sSettings]=$.extend({},fx_all,fx_pane,defs.fxSettings||{},defs[sSettings]||{},o.fxSettings,o[sSettings],opts.defaults.fxSettings,opts.defaults[sSettings]||{},opts[pane].fxSettings,opts[pane][sSettings]||{});o[sSpeed]=opts[pane][sSpeed]||opts[pane].fxSpeed||opts.defaults[sSpeed]||opts.defaults.fxSpeed||o[sSpeed]||o[sSettings].duration||o.fxSpeed||o.fxSettings.duration||defs.fxSpeed||defs.fxSettings.duration||fx_pane.duration||fx_all.duration||"normal";});});};var initPanes=function(){$.each(c.allPanes.split(","),function(){var
pane=str(this),o=options[pane],s=state[pane],fx=s.fx,dir=c[pane].dir,size=o.size=="auto"||isNaN(o.size)?0:o.size,minSize=o.minSize||1,maxSize=o.maxSize||9999,spacing=o.spacing_open||0,sel=o.paneSelector,isIE6=($.browser.msie&&$.browser.version<7),CSS={},$P,$C;$Cs[pane]=false;if(sel.substr(0,1)==="#")$P=$Ps[pane]=$Container.find(sel+":first");else{$P=$Ps[pane]=$Container.children(sel+":first");if(!$P.length)$P=$Ps[pane]=$Container.children("form:first").children(sel+":first");}if(!$P.length){$Ps[pane]=false;return true;}$P.attr("pane",pane).addClass(o.paneClass+" "+o.paneClass+"-"+pane);if(pane!="center"){s.isClosed=false;s.isSliding=false;s.isResizing=false;s.isHidden=false;s.noRoom=false;c[pane].pins=[];}CSS=$.extend({visibility:"visible",display:"block"},c.defaults.cssReq,c[pane].cssReq);if(o.applyDefaultStyles)$.extend(CSS,c.defaults.cssDef,c[pane].cssDef);$P.css(CSS);CSS={};switch(pane){case"north":CSS.top=cDims.top;CSS.left=cDims.left;CSS.right=cDims.right;break;case"south":CSS.bottom=cDims.bottom;CSS.left=cDims.left;CSS.right=cDims.right;break;case"west":CSS.left=cDims.left;break;case"east":CSS.right=cDims.right;break;case"center":}if(dir=="horz"){if(size===0||size=="auto"){$P.css({height:"auto"});size=$P.outerHeight();}size=max(size,minSize);size=min(size,maxSize);size=min(size,cDims.innerHeight-spacing);CSS.height=max(1,cssH(pane,size));s.size=size;s.maxSize=maxSize;s.minSize=max(minSize,size-CSS.height+1);$P.css(CSS);}else if(dir=="vert"){if(size===0||size=="auto"){$P.css({width:"auto",float:"left"});size=$P.outerWidth();$P.css({float:"none"});}size=max(size,minSize);size=min(size,maxSize);size=min(size,cDims.innerWidth-spacing);CSS.width=max(1,cssW(pane,size));s.size=size;s.maxSize=maxSize;s.minSize=max(minSize,size-CSS.width+1);$P.css(CSS);sizeMidPanes(pane,null,true);}else if(pane=="center"){$P.css(CSS);sizeMidPanes("center",null,true);}if(o.initClosed&&o.closable){$P.hide().addClass("closed");s.isClosed=true;}else if(o.initHidden||o.initClosed){hide(pane,true);s.isHidden=true;}else
$P.addClass("open");if(o.showOverflowOnHover)$P.hover(allowOverflow,resetOverflow);if(o.contentSelector){$C=$Cs[pane]=$P.children(o.contentSelector+":first");if(!$C.length){$Cs[pane]=false;return true;}$C.css(c.content.cssReq);if(o.applyDefaultStyles)$C.css(c.content.cssDef);$P.css({overflow:"hidden"});}});};var initHandles=function(){$.each(c.borderPanes.split(","),function(){var
pane=str(this),o=options[pane],s=state[pane],rClass=o.resizerClass,tClass=o.togglerClass,$P=$Ps[pane];$Rs[pane]=false;$Ts[pane]=false;if(!$P||(!o.closable&&!o.resizable))return;var
edge=c[pane].edge,isOpen=$P.is(":visible"),spacing=(isOpen?o.spacing_open:o.spacing_closed),_pane="-"+pane,_state=(isOpen?"-open":"-closed"),$R,$T;$R=$Rs[pane]=$("<span></span>");if(isOpen&&o.resizable);else if(!isOpen&&o.slidable)$R.attr("title",o.sliderTip).css("cursor",o.sliderCursor);$R.attr("id",(o.paneSelector.substr(0,1)=="#"?o.paneSelector.substr(1)+"-resizer":"")).attr("resizer",pane).css(c.resizers.cssReq).css(edge,cDims[edge]+getPaneSize(pane)).addClass(rClass+" "+rClass+_pane+" "+rClass+_state+" "+rClass+_pane+_state).appendTo($Container);if(o.applyDefaultStyles)$R.css(c.resizers.cssDef);if(o.closable){$T=$Ts[pane]=$("<div></div>");$T.attr("id",(o.paneSelector.substr(0,1)=="#"?o.paneSelector.substr(1)+"-toggler":"")).css(c.togglers.cssReq).attr("title",(isOpen?o.togglerTip_open:o.togglerTip_closed)).click(function(evt){toggle(pane);evt.stopPropagation();}).mouseover(function(evt){evt.stopPropagation();}).addClass(tClass+" "+tClass+_pane+" "+tClass+_state+" "+tClass+_pane+_state).appendTo($R);if(o.togglerContent_open)$("<span>"+o.togglerContent_open+"</span>").addClass("content content-open").css("display",s.isClosed?"none":"block").appendTo($T);if(o.togglerContent_closed)$("<span>"+o.togglerContent_closed+"</span>").addClass("content content-closed").css("display",s.isClosed?"block":"none").appendTo($T);if(o.applyDefaultStyles)$T.css(c.togglers.cssDef);if(!isOpen)bindStartSlidingEvent(pane,true);}});sizeHandles("all",true);};var initResizable=function(){var
draggingAvailable=(typeof $.fn.draggable=="function"),minPosition,maxPosition,edge;$.each(c.borderPanes.split(","),function(){var
pane=str(this),o=options[pane],s=state[pane];if(!draggingAvailable||!$Ps[pane]||!o.resizable){o.resizable=false;return true;}var
rClass=o.resizerClass,dragClass=rClass+"-drag",dragPaneClass=rClass+"-"+pane+"-drag",draggingClass=rClass+"-dragging",draggingPaneClass=rClass+"-"+pane+"-dragging",draggingClassSet=false,$P=$Ps[pane],$R=$Rs[pane];if(!s.isClosed)$R.attr("title",o.resizerTip).css("cursor",o.resizerCursor);$R.draggable({containment:$Container[0],axis:(c[pane].dir=="horz"?"y":"x"),delay:200,distance:1,helper:"clone",opacity:o.resizerDragOpacity,zIndex:c.zIndex.resizing,start:function(e,ui){if(false===execUserCallback(pane,o.onresize_start))return false;s.isResizing=true;clearTimer(pane,"closeSlider");$R.addClass(dragClass+" "+dragPaneClass);draggingClassSet=false;var resizerWidth=(pane=="east"||pane=="south"?o.spacing_open:0);setPaneMinMaxSizes(pane);s.minPosition-=resizerWidth;s.maxPosition-=resizerWidth;edge=(c[pane].dir=="horz"?"top":"left");$(o.maskIframesOnResize===true?"iframe":o.maskIframesOnResize).each(function(){$('<div class="ui-layout-mask"/>').css({background:"#fff",opacity:"0.001",zIndex:9,position:"absolute",width:this.offsetWidth+"px",height:this.offsetHeight+"px"}).css($(this).offset()).appendTo(this.parentNode);});},drag:function(e,ui){if(!draggingClassSet){$(".ui-draggable-dragging").addClass(draggingClass+" "+draggingPaneClass).children().css("visibility","hidden");draggingClassSet=true;if(s.isSliding)$Ps[pane].css("zIndex",c.zIndex.sliding);}if(ui.position[edge]<s.minPosition)ui.position[edge]=s.minPosition;else if(ui.position[edge]>s.maxPosition)ui.position[edge]=s.maxPosition;},stop:function(e,ui){var
dragPos=ui.position,resizerPos,newSize;$R.removeClass(dragClass+" "+dragPaneClass);switch(pane){case"north":resizerPos=dragPos.top;break;case"west":resizerPos=dragPos.left;break;case"south":resizerPos=cDims.outerHeight-dragPos.top-$R.outerHeight();break;case"east":resizerPos=cDims.outerWidth-dragPos.left-$R.outerWidth();break;}newSize=resizerPos-cDims[c[pane].edge];sizePane(pane,newSize);$("div.ui-layout-mask").remove();s.isResizing=false;}});});};var hide=function(pane,onInit){var
o=options[pane],s=state[pane],$P=$Ps[pane],$R=$Rs[pane];if(!$P||s.isHidden)return;if(false===execUserCallback(pane,o.onhide_start))return;s.isSliding=false;if($R)$R.hide();if(onInit||s.isClosed){s.isClosed=true;s.isHidden=true;$P.hide();sizeMidPanes(c[pane].dir=="horz"?"all":"center");execUserCallback(pane,o.onhide_end||o.onhide);}else{s.isHiding=true;close(pane,false);}};var show=function(pane,openPane){var
o=options[pane],s=state[pane],$P=$Ps[pane],$R=$Rs[pane];if(!$P||!s.isHidden)return;if(false===execUserCallback(pane,o.onshow_start))return;s.isSliding=false;s.isShowing=true;if($R&&o.spacing_open>0)$R.show();if(openPane===false)close(pane,true);else
open(pane);};var toggle=function(pane){var s=state[pane];if(s.isHidden)show(pane);else if(s.isClosed)open(pane);else
close(pane);};var close=function(pane,force,noAnimation){var
$P=$Ps[pane],$R=$Rs[pane],$T=$Ts[pane],o=options[pane],s=state[pane],doFX=!noAnimation&&!s.isClosed&&(o.fxName_close!="none"),edge=c[pane].edge,rClass=o.resizerClass,tClass=o.togglerClass,_pane="-"+pane,_open="-open",_sliding="-sliding",_closed="-closed",isShowing=s.isShowing,isHiding=s.isHiding;delete s.isShowing;delete s.isHiding;if(!$P||(!o.resizable&&!o.closable))return;else if(!force&&s.isClosed&&!isShowing)return;if(c.isLayoutBusy){setFlowCallback("close",pane,force);return;}if(!isShowing&&false===execUserCallback(pane,o.onclose_start))return;c[pane].isMoving=true;c.isLayoutBusy=true;s.isClosed=true;if(isHiding)s.isHidden=true;else if(isShowing)s.isHidden=false;syncPinBtns(pane,false);if(!s.isSliding)sizeMidPanes(c[pane].dir=="horz"?"all":"center");if($R){$R.css(edge,cDims[edge]).removeClass(rClass+_open+" "+rClass+_pane+_open).removeClass(rClass+_sliding+" "+rClass+_pane+_sliding).addClass(rClass+_closed+" "+rClass+_pane+_closed);if(o.resizable)$R.draggable("disable").css("cursor","default").attr("title","");if($T){$T.removeClass(tClass+_open+" "+tClass+_pane+_open).addClass(tClass+_closed+" "+tClass+_pane+_closed).attr("title",o.togglerTip_closed);}sizeHandles();}if(doFX){lockPaneForFX(pane,true);$P.hide(o.fxName_close,o.fxSettings_close,o.fxSpeed_close,function(){lockPaneForFX(pane,false);if(!s.isClosed)return;close_2();});}else{$P.hide();close_2();}function close_2(){bindStartSlidingEvent(pane,true);if(!isShowing)execUserCallback(pane,o.onclose_end||o.onclose);if(isShowing)execUserCallback(pane,o.onshow_end||o.onshow);if(isHiding)execUserCallback(pane,o.onhide_end||o.onhide);execFlowCallback(pane);}};var open=function(pane,slide,noAnimation){var
$P=$Ps[pane],$R=$Rs[pane],$T=$Ts[pane],o=options[pane],s=state[pane],doFX=!noAnimation&&s.isClosed&&(o.fxName_open!="none"),edge=c[pane].edge,rClass=o.resizerClass,tClass=o.togglerClass,_pane="-"+pane,_open="-open",_closed="-closed",_sliding="-sliding",isShowing=s.isShowing;delete s.isShowing;if(!$P||(!o.resizable&&!o.closable))return;else if(!s.isClosed&&!s.isSliding)return;if(s.isHidden&&!isShowing){show(pane,true);return;}if(c.isLayoutBusy){setFlowCallback("open",pane,slide);return;}if(false===execUserCallback(pane,o.onopen_start))return;c[pane].isMoving=true;c.isLayoutBusy=true;if(s.isSliding&&!slide)bindStopSlidingEvents(pane,false);s.isClosed=false;if(isShowing)s.isHidden=false;setPaneMinMaxSizes(pane);if(s.size>s.maxSize)$P.css(c[pane].sizeType,max(1,cssSize(pane,s.maxSize)));bindStartSlidingEvent(pane,false);if(doFX){lockPaneForFX(pane,true);$P.show(o.fxName_open,o.fxSettings_open,o.fxSpeed_open,function(){lockPaneForFX(pane,false);if(s.isClosed)return;open_2();});}else{$P.show();open_2();}function open_2(){if(!s.isSliding)sizeMidPanes(c[pane].dir=="vert"?"center":"all");if($R){$R.css(edge,cDims[edge]+getPaneSize(pane)).removeClass(rClass+_closed+" "+rClass+_pane+_closed).addClass(rClass+_open+" "+rClass+_pane+_open).addClass(!s.isSliding?"":rClass+_sliding+" "+rClass+_pane+_sliding);if(o.resizable)$R.draggable("enable").css("cursor",o.resizerCursor).attr("title",o.resizerTip);else
$R.css("cursor","default");if($T){$T.removeClass(tClass+_closed+" "+tClass+_pane+_closed).addClass(tClass+_open+" "+tClass+_pane+_open).attr("title",o.togglerTip_open);}sizeHandles("all");}sizeContent(pane);syncPinBtns(pane,!s.isSliding);execUserCallback(pane,o.onopen_end||o.onopen);if(isShowing)execUserCallback(pane,o.onshow_end||o.onshow);execFlowCallback(pane);}};var lockPaneForFX=function(pane,doLock){var $P=$Ps[pane];if(doLock){$P.css({zIndex:c.zIndex.animation});if(pane=="south")$P.css({top:cDims.top+cDims.innerHeight-$P.outerHeight()});else if(pane=="east")$P.css({left:cDims.left+cDims.innerWidth-$P.outerWidth()});}else{if(!state[pane].isSliding)$P.css({zIndex:c.zIndex.pane_normal});if(pane=="south")$P.css({top:"auto"});else if(pane=="east")$P.css({left:"auto"});}};var bindStartSlidingEvent=function(pane,enable){var
o=options[pane],$R=$Rs[pane],trigger=o.slideTrigger_open;if(!$R||!o.slidable)return;if(trigger!="click"&&trigger!="dblclick"&&trigger!="mouseover")trigger="click";$R
[enable?"bind":"unbind"](trigger,slideOpen).css("cursor",(enable?o.sliderCursor:"default")).attr("title",(enable?o.sliderTip:""));};var bindStopSlidingEvents=function(pane,enable){var
o=options[pane],s=state[pane],trigger=o.slideTrigger_close,action=(enable?"bind":"unbind"),$P=$Ps[pane],$R=$Rs[pane];s.isSliding=enable;clearTimer(pane,"closeSlider");$P.css({zIndex:(enable?c.zIndex.sliding:c.zIndex.pane_normal)});$R.css({zIndex:(enable?c.zIndex.sliding:c.zIndex.resizer_normal)});if(trigger!="click"&&trigger!="mouseout")trigger="mouseout";if(enable){$P.bind(trigger,slideClosed);$R.bind(trigger,slideClosed);if(trigger="mouseout"){$P.bind("mouseover",cancelMouseOut);$R.bind("mouseover",cancelMouseOut);}}else{$P.unbind(trigger);$R.unbind(trigger);if(trigger="mouseout"){$P.unbind("mouseover");$R.unbind("mouseover");clearTimer(pane,"closeSlider");}}function cancelMouseOut(evt){clearTimer(pane,"closeSlider");evt.stopPropagation();}};var slideOpen=function(){var pane=$(this).attr("resizer");if(state[pane].isClosed){bindStopSlidingEvents(pane,true);open(pane,true);}};var slideClosed=function(){var
$E=$(this),pane=$E.attr("pane")||$E.attr("resizer"),o=options[pane],s=state[pane];if(s.isClosed||s.isResizing)return;else if(o.slideTrigger_close=="click")close_NOW();else
setTimer(pane,"closeSlider",close_NOW,300);function close_NOW(){bindStopSlidingEvents(pane,false);if(!s.isClosed)close(pane);}};var sizePane=function(pane,size){var
edge=c[pane].edge,dir=c[pane].dir,o=options[pane],s=state[pane],$P=$Ps[pane],$R=$Rs[pane];setPaneMinMaxSizes(pane);s.minSize=max(s.minSize,o.minSize);if(o.maxSize>0)s.maxSize=min(s.maxSize,o.maxSize);size=max(size,s.minSize);size=min(size,s.maxSize);s.size=size;$R.css(edge,size+cDims[edge]);$P.css(c[pane].sizeType,max(1,cssSize(pane,size)));if(!s.isSliding)sizeMidPanes(dir=="horz"?"all":"center");sizeHandles();sizeContent(pane);execUserCallback(pane,o.onresize_end||o.onresize);};var sizeMidPanes=function(panes,overrideDims,onInit){if(!panes||panes=="all")panes="east,west,center";var d=getPaneDims();if(overrideDims)$.extend(d,overrideDims);$.each(panes.split(","),function(){if(!$Ps[this])return;var
pane=str(this),o=options[pane],s=state[pane],$P=$Ps[pane],$R=$Rs[pane],hasRoom=true,CSS={};if(pane=="center"){d=getPaneDims();CSS=$.extend({},d);CSS.width=max(1,cssW(pane,CSS.width));CSS.height=max(1,cssH(pane,CSS.height));hasRoom=(CSS.width>1&&CSS.height>1);if($.browser.msie&&(!$.boxModel||$.browser.version<7)){if($Ps.north)$Ps.north.css({width:cssW($Ps.north,cDims.innerWidth)});if($Ps.south)$Ps.south.css({width:cssW($Ps.south,cDims.innerWidth)});}}else{CSS.top=d.top;CSS.bottom=d.bottom;CSS.height=max(1,cssH(pane,d.height));hasRoom=(CSS.height>1);}if(hasRoom){$P.css(CSS);if(s.noRoom){s.noRoom=false;if(s.isHidden)return;else show(pane,!s.isClosed);}if(!onInit){sizeContent(pane);execUserCallback(pane,o.onresize_end||o.onresize);}}else if(!s.noRoom){s.noRoom=true;if(s.isHidden)return;if(onInit){$P.hide();if($R)$R.hide();}else hide(pane);}});};var sizeContent=function(panes){if(!panes||panes=="all")panes=c.allPanes;$.each(panes.split(","),function(){if(!$Cs[this])return;var
pane=str(this),ignore=options[pane].contentIgnoreSelector,$P=$Ps[pane],$C=$Cs[pane],e_C=$C[0],height=cssH($P);;$P.children().each(function(){if(this==e_C)return;var $E=$(this);if(!ignore||!$E.is(ignore))height-=$E.outerHeight();});if(height>0)height=cssH($C,height);if(height<1)$C.hide();else
$C.css({height:height}).show();});};var sizeHandles=function(panes,onInit){if(!panes||panes=="all")panes=c.borderPanes;$.each(panes.split(","),function(){var
pane=str(this),o=options[pane],s=state[pane],$P=$Ps[pane],$R=$Rs[pane],$T=$Ts[pane];if(!$P||!$R||(!o.resizable&&!o.closable))return;var
dir=c[pane].dir,_state=(s.isClosed?"_closed":"_open"),spacing=o["spacing"+_state],togAlign=o["togglerAlign"+_state],togLen=o["togglerLength"+_state],paneLen,offset,CSS={};if(spacing==0){$R.hide();return;}else if(!s.noRoom&&!s.isHidden)$R.show();if(dir=="horz"){paneLen=$P.outerWidth();$R.css({width:max(1,cssW($R,paneLen)),height:max(1,cssH($R,spacing)),left:cssNum($P,"left")});}else{paneLen=$P.outerHeight();$R.css({height:max(1,cssH($R,paneLen)),width:max(1,cssW($R,spacing)),top:cDims.top+getPaneSize("north",true)});}if($T){if(togLen==0||(s.isSliding&&o.hideTogglerOnSlide)){$T.hide();return;}else
$T.show();if(!(togLen>0)||togLen=="100%"||togLen>paneLen){togLen=paneLen;offset=0;}else{if(typeof togAlign=="string"){switch(togAlign){case"top":case"left":offset=0;break;case"bottom":case"right":offset=paneLen-togLen;break;case"middle":case"center":default:offset=Math.floor((paneLen-togLen)/2);}}else{var x=parseInt(togAlign);if(togAlign>=0)offset=x;else offset=paneLen-togLen+x;}}var
$TC_o=(o.togglerContent_open?$T.children(".content-open"):false),$TC_c=(o.togglerContent_closed?$T.children(".content-closed"):false),$TC=(s.isClosed?$TC_c:$TC_o);if($TC_o)$TC_o.css("display",s.isClosed?"none":"block");if($TC_c)$TC_c.css("display",s.isClosed?"block":"none");if(dir=="horz"){var width=cssW($T,togLen);$T.css({width:max(0,width),height:max(1,cssH($T,spacing)),left:offset});if($TC)$TC.css("marginLeft",Math.floor((width-$TC.outerWidth())/2));}else{var height=cssH($T,togLen);$T.css({height:max(0,height),width:max(1,cssW($T,spacing)),top:offset});if($TC)$TC.css("marginTop",Math.floor((height-$TC.outerHeight())/2));}}if(onInit&&o.initHidden){$R.hide();if($T)$T.hide();}});};var resizeAll=function(){var
oldW=cDims.innerWidth,oldH=cDims.innerHeight;cDims=state.container=getElemDims($Container);var
checkH=(cDims.innerHeight<oldH),checkW=(cDims.innerWidth<oldW),s,dir;if(checkH||checkW)$.each(["south","north","east","west"],function(i,pane){s=state[pane];dir=c[pane].dir;if(!s.isClosed&&((checkH&&dir=="horz")||(checkW&&dir=="vert"))){setPaneMinMaxSizes(pane);if(s.size>s.maxSize)sizePane(pane,s.maxSize);}});sizeMidPanes("all");sizeHandles("all");};function keyDown(evt){if(!evt)return true;var code=evt.keyCode;if(code<33)return true;var
PANE={38:"north",40:"south",37:"west",39:"east"},isCursorKey=(code>=37&&code<=40),ALT=evt.altKey,SHIFT=evt.shiftKey,CTRL=evt.ctrlKey,pane=false,s,o,k,m,el;if(!CTRL&&!SHIFT)return true;else if(isCursorKey&&options[PANE[code]].enableCursorHotkey)pane=PANE[code];else
$.each(c.borderPanes.split(","),function(i,p){o=options[p];k=o.customHotkey;m=o.customHotkeyModifier;if((SHIFT&&m=="SHIFT")||(CTRL&&m=="CTRL")||(CTRL&&SHIFT)){if(k&&code==(isNaN(k)||k<=9?k.toUpperCase().charCodeAt(0):k)){pane=p;return false;}}});if(!pane)return true;o=options[pane];s=state[pane];if(!o.enableCursorHotkey||s.isHidden||!$Ps[pane])return true;el=evt.target||evt.srcElement;if(el&&SHIFT&&isCursorKey&&(el.tagName=="TEXTAREA"||(el.tagName=="INPUT"&&(code==37||code==39))))return true;toggle(pane);evt.stopPropagation();evt.returnValue=false;return false;};function allowOverflow(elem){if(this&&this.tagName)elem=this;var $P;if(typeof elem=="string")$P=$Ps[elem];else{if($(elem).attr("pane"))$P=$(elem);else $P=$(elem).parents("div[pane]:first");}if(!$P.length)return;var
pane=$P.attr("pane"),s=state[pane];if(s.cssSaved)resetOverflow(pane);if(s.isSliding||s.isResizing||s.isClosed){s.cssSaved=false;return;}var
newCSS={zIndex:(c.zIndex.pane_normal+1)},curCSS={},of=$P.css("overflow"),ofX=$P.css("overflowX"),ofY=$P.css("overflowY");if(of!="visible"){curCSS.overflow=of;newCSS.overflow="visible";}if(ofX&&ofX!="visible"&&ofX!="auto"){curCSS.overflowX=ofX;newCSS.overflowX="visible";}if(ofY&&ofY!="visible"&&ofY!="auto"){curCSS.overflowY=ofX;newCSS.overflowY="visible";}s.cssSaved=curCSS;$P.css(newCSS);$.each(c.allPanes.split(","),function(i,p){if(p!=pane)resetOverflow(p);});};function resetOverflow(elem){if(this&&this.tagName)elem=this;var $P;if(typeof elem=="string")$P=$Ps[elem];else{if($(elem).hasClass("ui-layout-pane"))$P=$(elem);else $P=$(elem).parents("div[pane]:first");}if(!$P.length)return;var
pane=$P.attr("pane"),s=state[pane],CSS=s.cssSaved||{};if(!s.isSliding&&!s.isResizing)$P.css("zIndex",c.zIndex.pane_normal);$P.css(CSS);s.cssSaved=false;};function getBtn(selector,pane,action){var
$E=$(selector),err="Error Adding Button \n\nInvalid ";if(!$E.length)alert(err+"selector: "+selector);else if(c.borderPanes.indexOf(pane)==-1)alert(err+"pane: "+pane);else{var btn=options[pane].buttonClass+"-"+action;$E.addClass(btn+" "+btn+"-"+pane);return $E;}return false;};function addToggleBtn(selector,pane){var $E=getBtn(selector,pane,"toggle");if($E)$E.attr("title",state[pane].isClosed?"Open":"Close").click(function(evt){toggle(pane);evt.stopPropagation();});};function addOpenBtn(selector,pane){var $E=getBtn(selector,pane,"open");if($E)$E.attr("title","Open").click(function(evt){open(pane);evt.stopPropagation();});};function addCloseBtn(selector,pane){var $E=getBtn(selector,pane,"close");if($E)$E.attr("title","Close").click(function(evt){close(pane);evt.stopPropagation();});};function addPinBtn(selector,pane){var $E=getBtn(selector,pane,"pin");if($E){var s=state[pane];$E.click(function(evt){setPinState($(this),pane,(s.isSliding||s.isClosed));if(s.isSliding||s.isClosed)open(pane);else close(pane);evt.stopPropagation();});setPinState($E,pane,(!s.isClosed&&!s.isSliding));c[pane].pins.push(selector);}};function syncPinBtns(pane,doPin){$.each(c[pane].pins,function(i,selector){setPinState($(selector),pane,doPin);});};function setPinState($Pin,pane,doPin){var updown=$Pin.attr("pin");if(updown&&doPin==(updown=="down"))return;var
root=options[pane].buttonClass,class1=root+"-pin",class2=class1+"-"+pane,UP1=class1+"-up",UP2=class2+"-up",DN1=class1+"-down",DN2=class2+"-down";$Pin.attr("pin",doPin?"down":"up").attr("title",doPin?"Un-Pin":"Pin").removeClass(doPin?UP1:DN1).removeClass(doPin?UP2:DN2).addClass(doPin?DN1:UP1).addClass(doPin?DN2:UP2);};var
$Container=$(this).css({overflow:"hidden"}),$Ps={},$Cs={},$Rs={},$Ts={},c=config,cDims=state.container;create();return{options:options,state:state,panes:$Ps,toggle:toggle,open:open,close:close,hide:hide,show:show,resizeContent:sizeContent,sizePane:sizePane,resizeAll:resizeAll,addToggleBtn:addToggleBtn,addOpenBtn:addOpenBtn,addCloseBtn:addCloseBtn,addPinBtn:addPinBtn,allowOverflow:allowOverflow,resetOverflow:resetOverflow,cssWidth:cssW,cssHeight:cssH};}})(jQuery);jQuery.tableDnD={currentTable:null,dragObject:null,mouseOffset:null,oldY:0,build:function(options){this.each(function(){this.tableDnDConfig=jQuery.extend({onDragStyle:null,onDropStyle:null,onDragClass:"tDnD_whileDrag",onDrop:null,onDragStart:null,scrollAmount:5,serializeRegexp:/[^\-]*$/,serializeParamName:null,dragHandle:null},options||{});jQuery.tableDnD.makeDraggable(this);});jQuery(document).bind('mousemove',jQuery.tableDnD.mousemove).bind('mouseup',jQuery.tableDnD.mouseup);return this;},makeDraggable:function(table){var config=table.tableDnDConfig;if(table.tableDnDConfig.dragHandle){var cells=jQuery("td."+table.tableDnDConfig.dragHandle,table);cells.each(function(){jQuery(this).mousedown(function(ev){jQuery.tableDnD.dragObject=this.parentNode;jQuery.tableDnD.currentTable=table;jQuery.tableDnD.mouseOffset=jQuery.tableDnD.getMouseOffset(this,ev);if(config.onDragStart){config.onDragStart(table,this);}
return false;});})}else{var rows=jQuery("tr",table);rows.each(function(){var row=jQuery(this);if(!row.hasClass("nodrag")){row.mousedown(function(ev){if(ev.target.tagName=="TD"){jQuery.tableDnD.dragObject=this;jQuery.tableDnD.currentTable=table;jQuery.tableDnD.mouseOffset=jQuery.tableDnD.getMouseOffset(this,ev);if(config.onDragStart){config.onDragStart(table,this);}
return false;}}).css("cursor","move");}});}},updateTables:function(){this.each(function(){if(this.tableDnDConfig){jQuery.tableDnD.makeDraggable(this);}})},mouseCoords:function(ev){if(ev.pageX||ev.pageY){return{x:ev.pageX,y:ev.pageY};}
return{x:ev.clientX+document.body.scrollLeft-document.body.clientLeft,y:ev.clientY+document.body.scrollTop-document.body.clientTop};},getMouseOffset:function(target,ev){ev=ev||window.event;var docPos=this.getPosition(target);var mousePos=this.mouseCoords(ev);return{x:mousePos.x-docPos.x,y:mousePos.y-docPos.y};},getPosition:function(e){var left=0;var top=0;if(e.offsetHeight==0){e=e.firstChild;}
if(e&&e.offsetParent){while(e.offsetParent){left+=e.offsetLeft;top+=e.offsetTop;e=e.offsetParent;}
left+=e.offsetLeft;top+=e.offsetTop;}
return{x:left,y:top};},mousemove:function(ev){if(jQuery.tableDnD.dragObject==null){return;}
var dragObj=jQuery(jQuery.tableDnD.dragObject);var config=jQuery.tableDnD.currentTable.tableDnDConfig;var mousePos=jQuery.tableDnD.mouseCoords(ev);var y=mousePos.y-jQuery.tableDnD.mouseOffset.y;var yOffset=window.pageYOffset;if(document.all){if(typeof document.compatMode!='undefined'&&document.compatMode!='BackCompat'){yOffset=document.documentElement.scrollTop;}
else if(typeof document.body!='undefined'){yOffset=document.body.scrollTop;}}
if(mousePos.y-yOffset<config.scrollAmount){window.scrollBy(0,-config.scrollAmount);}else{var windowHeight=window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:document.body.clientHeight;if(windowHeight-(mousePos.y-yOffset)<config.scrollAmount){window.scrollBy(0,config.scrollAmount);}}
if(y!=jQuery.tableDnD.oldY){var movingDown=y>jQuery.tableDnD.oldY;jQuery.tableDnD.oldY=y;if(config.onDragClass){dragObj.addClass(config.onDragClass);}else{dragObj.css(config.onDragStyle);}
var currentRow=jQuery.tableDnD.findDropTargetRow(dragObj,y);if(currentRow){if(movingDown&&jQuery.tableDnD.dragObject!=currentRow){jQuery.tableDnD.dragObject.parentNode.insertBefore(jQuery.tableDnD.dragObject,currentRow.nextSibling);}else if(!movingDown&&jQuery.tableDnD.dragObject!=currentRow){jQuery.tableDnD.dragObject.parentNode.insertBefore(jQuery.tableDnD.dragObject,currentRow);}}}
return false;},findDropTargetRow:function(draggedRow,y){var rows=jQuery.tableDnD.currentTable.rows;for(var i=0;i<rows.length;i++){var row=rows[i];var rowY=this.getPosition(row).y;var rowHeight=parseInt(row.offsetHeight)/2;if(row.offsetHeight==0){rowY=this.getPosition(row.firstChild).y;rowHeight=parseInt(row.firstChild.offsetHeight)/2;}
if((y>rowY-rowHeight)&&(y<(rowY+rowHeight))){if(row==draggedRow){return null;}
var config=jQuery.tableDnD.currentTable.tableDnDConfig;if(config.onAllowDrop){if(config.onAllowDrop(draggedRow,row)){return row;}else{return null;}}else{var nodrop=jQuery(row).hasClass("nodrop");if(!nodrop){return row;}else{return null;}}
return row;}}
return null;},mouseup:function(e){if(jQuery.tableDnD.currentTable&&jQuery.tableDnD.dragObject){var droppedRow=jQuery.tableDnD.dragObject;var config=jQuery.tableDnD.currentTable.tableDnDConfig;if(config.onDragClass){jQuery(droppedRow).removeClass(config.onDragClass);}else{jQuery(droppedRow).css(config.onDropStyle);}
jQuery.tableDnD.dragObject=null;if(config.onDrop){config.onDrop(jQuery.tableDnD.currentTable,droppedRow);}
jQuery.tableDnD.currentTable=null;}},serialize:function(){if(jQuery.tableDnD.currentTable){return jQuery.tableDnD.serializeTable(jQuery.tableDnD.currentTable);}else{return"Error: No Table id set, you need to set an id on your table and every row";}},serializeTable:function(table){var result="";var tableId=table.id;var rows=table.rows;for(var i=0;i<rows.length;i++){if(result.length>0)result+="&";var rowId=rows[i].id;if(rowId&&rowId&&table.tableDnDConfig&&table.tableDnDConfig.serializeRegexp){rowId=rowId.match(table.tableDnDConfig.serializeRegexp)[0];}
result+=tableId+'[]='+rowId;}
return result;},serializeTables:function(){var result="";this.each(function(){result+=jQuery.tableDnD.serializeTable(this);});return result;}}
jQuery.fn.extend({tableDnD:jQuery.tableDnD.build,tableDnDUpdate:jQuery.tableDnD.updateTables,tableDnDSerialize:jQuery.tableDnD.serializeTables});(function($){var menu,shadow,trigger,content,hash,currentTarget;var defaults={menuStyle:{listStyle:'none',padding:'1px',margin:'0px',backgroundColor:'#fff',border:'1px solid #999',width:'100px'},itemStyle:{margin:'0px',color:'#000',display:'block',cursor:'default',padding:'3px',border:'1px solid #fff',backgroundColor:'transparent'},itemHoverStyle:{border:'1px solid #0a246a',backgroundColor:'#b6bdd2'},eventPosX:'pageX',eventPosY:'pageY',shadow:true,onContextMenu:null,onShowMenu:null};$.fn.contextMenu=function(id,options){if(!menu){menu=$('<div id="jqContextMenu"></div>').hide().css({position:'absolute',zIndex:'500'}).appendTo('body').bind('click',function(e){e.stopPropagation();});}
if(!shadow){shadow=$('<div></div>').css({backgroundColor:'#000',position:'absolute',opacity:0.2,zIndex:499}).appendTo('body').hide();}
hash=hash||[];hash.push({id:id,menuStyle:$.extend({},defaults.menuStyle,options.menuStyle||{}),itemStyle:$.extend({},defaults.itemStyle,options.itemStyle||{}),itemHoverStyle:$.extend({},defaults.itemHoverStyle,options.itemHoverStyle||{}),bindings:options.bindings||{},shadow:options.shadow||options.shadow===false?options.shadow:defaults.shadow,onContextMenu:options.onContextMenu||defaults.onContextMenu,onShowMenu:options.onShowMenu||defaults.onShowMenu,eventPosX:options.eventPosX||defaults.eventPosX,eventPosY:options.eventPosY||defaults.eventPosY});var index=hash.length-1;$(this).bind('contextmenu',function(e){var bShowContext=(!!hash[index].onContextMenu)?hash[index].onContextMenu(e):true;if(bShowContext)display(index,this,e,options);return false;});return this;};function display(index,trigger,e,options){var cur=hash[index];content=$('#'+cur.id).find('ul:first').clone(true);content.css(cur.menuStyle).find('li').css(cur.itemStyle).hover(function(){$(this).css(cur.itemHoverStyle);},function(){$(this).css(cur.itemStyle);}).find('img').css({verticalAlign:'middle',paddingRight:'2px'});menu.html(content);if(!!cur.onShowMenu)menu=cur.onShowMenu(e,menu);$.each(cur.bindings,function(id,func){$('#'+id,menu).bind('click',function(e){hide();func(trigger,currentTarget);});});menu.css({'left':e[cur.eventPosX],'top':e[cur.eventPosY]}).show();if(cur.shadow)shadow.css({width:menu.width(),height:menu.height(),left:e.pageX+2,top:e.pageY+2}).show();$(document).one('click',hide);}
function hide(){menu.hide();shadow.hide();}
$.contextMenu={defaults:function(userDefaults){$.each(userDefaults,function(i,val){if(typeof val=='object'&&defaults[i]){$.extend(defaults[i],val);}
else defaults[i]=val;});}};})(jQuery);$(function(){$('div.contextMenu').hide();});;(function($){$.jgrid=$.jgrid||{};$.extend($.jgrid,{htmlDecode:function(value){if(value=='&nbsp;'||value=='&#160;'||(value.length==1&&value.charCodeAt(0)==160)){return"";}
return!value?value:String(value).replace(/&amp;/g,"&").replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,'"');},htmlEncode:function(value){return!value?value:String(value).replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/\"/g,"&quot;");},format:function(format){var args=$.makeArray(arguments).slice(1);if(format===undefined)format="";return format.replace(/\{(\d+)\}/g,function(m,i){return args[i];});},getCellIndex:function(cell){cell=$(cell);cell=(!cell.is('td')&&!cell.is('th')?cell.closest("td,th"):cell)[0];if($.browser.msie)return $.inArray(cell,cell.parentNode.cells);return cell.cellIndex;},stripHtml:function(v){v=v+"";var regexp=/<("[^"]*"|'[^']*'|[^'">])*>/gi;if(v){v=v.replace(regexp,"");return(v&&v!=='&nbsp;'&&v!=='&#160;')?v:"";}else{return v;}},stringToDoc:function(xmlString){var xmlDoc;if(typeof xmlString!=='string')return xmlString;try{var parser=new DOMParser();xmlDoc=parser.parseFromString(xmlString,"text/xml");}
catch(e){xmlDoc=new ActiveXObject("Microsoft.XMLDOM");xmlDoc.async=false;xmlDoc["loadXM"+"L"](xmlString);}
return(xmlDoc&&xmlDoc.documentElement&&xmlDoc.documentElement.tagName!='parsererror')?xmlDoc:null;},parse:function(jsonString){var js=jsonString,msg;if(js.substr(0,9)=="while(1);"){js=js.substr(9);}
if(js.substr(0,2)=="/*"){js=js.substr(2,js.length-4);}
if(!js){js="{}";}
msg=($.jgrid.useJSON===true&&typeof(JSON)==='object'&&typeof(JSON.parse)==='function')?JSON.parse(js):eval('('+js+')');return msg.hasOwnProperty('d')?msg.d:msg;},empty:function(){while(this.firstChild)this.removeChild(this.firstChild);},jqID:function(sid){sid=sid+"";return sid.replace(/([\.\:\[\]])/g,"\\$1");},ajaxOptions:{},extend:function(methods){$.extend($.fn.jqGrid,methods);if(!this.no_legacy_api){$.fn.extend(methods);}}});$.fn.jqGrid=function(pin){if(typeof pin=='string'){var fn=$.fn.jqGrid[pin];if(!fn){throw("jqGrid - No such method: "+pin);}
var args=$.makeArray(arguments).slice(1);return fn.apply(this,args);}
return this.each(function(){if(this.grid){return;}
var p=$.extend(true,{url:"",height:150,page:1,rowNum:20,records:0,pager:"",pgbuttons:true,pginput:true,colModel:[],rowList:[],colNames:[],sortorder:"asc",sortname:"",datatype:"xml",mtype:"GET",altRows:false,selarrrow:[],savedRow:[],shrinkToFit:true,xmlReader:{},jsonReader:{},subGrid:false,subGridModel:[],reccount:0,lastpage:0,lastsort:0,selrow:null,beforeSelectRow:null,onSelectRow:null,onSortCol:null,ondblClickRow:null,onRightClickRow:null,onPaging:null,onSelectAll:null,loadComplete:null,gridComplete:null,loadError:null,loadBeforeSend:null,afterInsertRow:null,beforeRequest:null,onHeaderClick:null,viewrecords:false,loadonce:false,multiselect:false,multikey:false,editurl:null,search:false,caption:"",hidegrid:true,hiddengrid:false,postData:{},userData:{},treeGrid:false,treeGridModel:'nested',treeReader:{},treeANode:-1,ExpandColumn:null,tree_root_level:0,prmNames:{page:"page",rows:"rows",sort:"sidx",order:"sord",search:"_search",nd:"nd",id:"id",oper:"oper",editoper:"edit",addoper:"add",deloper:"del"},forceFit:false,gridstate:"visible",cellEdit:false,cellsubmit:"remote",nv:0,loadui:"enable",toolbar:[false,""],scroll:false,multiboxonly:false,deselectAfterSort:true,scrollrows:false,autowidth:false,scrollOffset:18,cellLayout:5,subGridWidth:20,multiselectWidth:20,gridview:false,rownumWidth:25,rownumbers:false,pagerpos:'center',recordpos:'right',footerrow:false,userDataOnFooter:false,hoverrows:true,altclass:'ui-priority-secondary',viewsortcols:[false,'vertical',true],resizeclass:'',autoencode:false,remapColumns:[],ajaxGridOptions:{},direction:"ltr",toppager:false},$.jgrid.defaults,pin||{});var grid={headers:[],cols:[],footers:[],dragStart:function(i,x,y){this.resizing={idx:i,startX:x.clientX,sOL:y[0]};this.hDiv.style.cursor="col-resize";this.curGbox=$("#rs_m"+p.id,"#gbox_"+p.id);this.curGbox.css({display:"block",left:y[0],top:y[1],height:y[2]});if($.isFunction(p.resizeStart))p.resizeStart.call(this,x,i);document.onselectstart=new Function("return false");},dragMove:function(x){if(this.resizing){var diff=x.clientX-this.resizing.startX,h=this.headers[this.resizing.idx],newWidth=p.direction==="ltr"?h.width+diff:h.width-diff,hn,nWn;if(newWidth>33){this.curGbox.css({left:this.resizing.sOL+diff});if(p.forceFit===true){hn=this.headers[this.resizing.idx+p.nv];nWn=p.direction==="ltr"?hn.width-diff:hn.width+diff;if(nWn>33){h.newWidth=newWidth;hn.newWidth=nWn;}}else{this.newWidth=p.direction==="ltr"?p.tblwidth+diff:p.tblwidth-diff;h.newWidth=newWidth;}}}},dragEnd:function(){this.hDiv.style.cursor="default";if(this.resizing){var idx=this.resizing.idx,nw=this.headers[idx].newWidth||this.headers[idx].width;nw=parseInt(nw,10);this.resizing=false;$("#rs_m"+p.id).css("display","none");p.colModel[idx].width=nw;this.headers[idx].width=nw;this.headers[idx].el.style.width=nw+"px";if(this.cols.length>0){this.cols[idx].style.width=nw+"px";}
if(this.footers.length>0){this.footers[idx].style.width=nw+"px";}
if(p.forceFit===true){nw=this.headers[idx+p.nv].newWidth||this.headers[idx+p.nv].width;this.headers[idx+p.nv].width=nw;this.headers[idx+p.nv].el.style.width=nw+"px";if(this.cols.length>0)this.cols[idx+p.nv].style.width=nw+"px";if(this.footers.length>0){this.footers[idx+p.nv].style.width=nw+"px";}
p.colModel[idx+p.nv].width=nw;}else{p.tblwidth=this.newWidth||p.tblwidth;$('table:first',this.bDiv).css("width",p.tblwidth+"px");$('table:first',this.hDiv).css("width",p.tblwidth+"px");this.hDiv.scrollLeft=this.bDiv.scrollLeft;if(p.footerrow){$('table:first',this.sDiv).css("width",p.tblwidth+"px");this.sDiv.scrollLeft=this.bDiv.scrollLeft;}}
if($.isFunction(p.resizeStop))p.resizeStop.call(this,nw,idx);}
this.curGbox=null;document.onselectstart=new Function("return true");},populateVisible:function(){if(grid.timer)clearTimeout(grid.timer);grid.timer=null;var dh=$(grid.bDiv).height();if(!dh)return;var table=$("table:first",grid.bDiv);var rows=$("> tbody > tr:visible:first",table);var rh=rows.outerHeight()||grid.prevRowHeight;if(!rh)return;grid.prevRowHeight=rh;var rn=p.rowNum;var scrollTop=grid.scrollTop=grid.bDiv.scrollTop;var ttop=Math.round(table.position().top)-scrollTop;var tbot=ttop+table.height();var div=rh*rn;var page,npage,empty;if(ttop<=0&&tbot<dh&&(p.lastpage==null||parseInt((tbot+scrollTop+div-1)/div,10)<p.lastpage))
{npage=parseInt((dh-tbot+div-1)/div,10);if(tbot>=0||npage<2||p.scroll===true){page=Math.round((tbot+scrollTop)/div)+1;ttop=-1;}else{ttop=1;}}
if(ttop>0){page=parseInt(scrollTop/div,10)+1;npage=parseInt((scrollTop+dh)/div,10)+2-page;empty=true;}
if(npage){if(p.lastpage&&page>p.lastpage){return;}
if(grid.hDiv.loading){grid.timer=setTimeout(grid.populateVisible,200);}else{p.page=page;if(empty){grid.selectionPreserver(table[0]);grid.emptyRows(grid.bDiv);}
grid.populate(npage);}}},scrollGrid:function(){if(p.scroll){var scrollTop=grid.bDiv.scrollTop;if(scrollTop!=grid.scrollTop){grid.scrollTop=scrollTop;if(grid.timer)clearTimeout(grid.timer);grid.timer=setTimeout(grid.populateVisible,200);}}
grid.hDiv.scrollLeft=grid.bDiv.scrollLeft;if(p.footerrow){grid.sDiv.scrollLeft=grid.bDiv.scrollLeft;}},selectionPreserver:function(ts){var p=ts.p;var sr=p.selrow,sra=p.selarrrow?$.makeArray(p.selarrrow):null;var left=ts.grid.bDiv.scrollLeft;var complete=p.gridComplete;p.gridComplete=function(){p.selrow=null;p.selarrrow=[];if(p.multiselect&&sra&&sra.length>0){for(var i=0;i<sra.length;i++){if(sra[i]!=sr)
$(ts).jqGrid("setSelection",sra[i],false);}}
if(sr){$(ts).jqGrid("setSelection",sr,false);}
ts.grid.bDiv.scrollLeft=left;if(p.gridComplete=complete){complete();}}}};this.p=p;var i,dir,ts;if(this.p.colNames.length===0){for(i=0;i<this.p.colModel.length;i++){this.p.colNames[i]=this.p.colModel[i].label||this.p.colModel[i].name;}}
if(this.p.colNames.length!==this.p.colModel.length){alert($.jgrid.errors.model);return;}
var gv=$("<div class='ui-jqgrid-view'></div>"),ii,isMSIE=$.browser.msie?true:false,isSafari=$.browser.safari?true:false;ts=this;ts.p.direction=$.trim(ts.p.direction.toLowerCase());if($.inArray(ts.p.direction,["ltr","rtl"])==-1)ts.p.direction="ltr";dir=ts.p.direction;$(gv).insertBefore(this);$(this).appendTo(gv).removeClass("scroll");var eg=$("<div class='ui-jqgrid ui-widget ui-widget-content ui-corner-all'></div>");$(eg).insertBefore(gv).attr({"id":"gbox_"+this.id,"dir":dir});$(gv).appendTo(eg).attr("id","gview_"+this.id);if(isMSIE&&$.browser.version<=6){ii='<iframe style="display:block;position:absolute;z-index:-1;filter:Alpha(Opacity=\'0\');" src="javascript:false;"></iframe>';}else{ii="";}
$("<div class='ui-widget-overlay jqgrid-overlay' id='lui_"+this.id+"'></div>").append(ii).insertBefore(gv);$("<div class='loading ui-state-default ui-state-active' id='load_"+this.id+"'>"+this.p.loadtext+"</div>").insertBefore(gv);$(this).attr({cellSpacing:"0",cellPadding:"0",border:"0","role":"grid","aria-multiselectable":!!this.p.multiselect,"aria-labelledby":"gbox_"+this.id});var sortkeys=["shiftKey","altKey","ctrlKey"],IntNum=function(val,defval){val=parseInt(val,10);if(isNaN(val)){return defval?defval:0;}
else{return val;}},formatCol=function(pos,rowInd){var ral=ts.p.colModel[pos].align,result="style=\"",clas=ts.p.colModel[pos].classes;if(ral)result+="text-align:"+ral+";";if(ts.p.colModel[pos].hidden===true)result+="display:none;";if(rowInd===0){result+="width: "+grid.headers[pos].width+"px;"}
return result+"\""+(clas!==undefined?(" class=\""+clas+"\""):"");},addCell=function(rowId,cell,pos,irow,srvr){var v,prp;v=formatter(rowId,cell,pos,srvr,'add');prp=formatCol(pos,irow);return"<td role=\"gridcell\" "+prp+" title=\""+$.jgrid.stripHtml(v)+"\">"+v+"</td>";},formatter=function(rowId,cellval,colpos,rwdat,_act){var cm=ts.p.colModel[colpos],v;if(typeof cm.formatter!=='undefined'){var opts={rowId:rowId,colModel:cm,gid:ts.p.id};if($.isFunction(cm.formatter)){v=cm.formatter.call(ts,cellval,opts,rwdat,_act);}else if($.fmatter){v=$.fn.fmatter(cm.formatter,cellval,opts,rwdat,_act);}else{v=cellVal(cellval);}}else{v=cellVal(cellval);}
return v;},cellVal=function(val){return val===undefined||val===null||val===""?"&#160;":(ts.p.autoencode?$.jgrid.htmlEncode(val):val+"");},addMulti=function(rowid,pos,irow){var v="<input type=\"checkbox\""+" id=\"jqg_"+rowid+"\" class=\"cbox\" name=\"jqg_"+rowid+"\"/>",prp=formatCol(pos,irow);return"<td role='gridcell' "+prp+">"+v+"</td>";},addRowNum=function(pos,irow,pG,rN){var v=(parseInt(pG,10)-1)*parseInt(rN,10)+1+irow,prp=formatCol(pos,irow);return"<td role=\"gridcell\" class=\"ui-state-default jqgrid-rownum\" "+prp+">"+v+"</td>";},reader=function(datatype){var field,f=[],j=0,i;for(i=0;i<ts.p.colModel.length;i++){field=ts.p.colModel[i];if(field.name!=='cb'&&field.name!=='subgrid'&&field.name!=='rn'){f[j]=(datatype=="xml")?field.xmlmap||field.name:field.jsonmap||field.name;j++;}}
return f;},orderedCols=function(offset){var order=ts.p.remapColumns;if(!order||!order.length)
order=$.map(ts.p.colModel,function(v,i){return i;});if(offset)
order=$.map(order,function(v){return v<offset?null:v-offset});return order;},emptyRows=function(parent,scroll){var tBody=$("tbody:first",parent);if(!ts.p.gridview||ts.p.jqgdnd)$("*",tBody).children().unbind();if(isMSIE)$.jgrid.empty.apply(tBody[0]);else tBody[0].innerHTML="";if(scroll&&ts.p.scroll){$(">div:first",parent).css({height:"auto"}).children("div:first").css({height:0,display:"none"});parent.scrollTop=0;}
tBody=null;},getAccessor=function(obj,expr){var ret,p,prm;ret=obj[expr];if(ret===undefined){if(typeof expr==='string'){prm=expr.split('.');}
try{if(prm.length){ret=obj;while(ret&&prm.length){p=prm.shift();ret=ret[p];}}}catch(e){}}
return ret;},addXmlData=function(xml,t,rcnt,more,adjust){var startReq=new Date();ts.p.reccount=0;if($.isXMLDoc(xml)){if(ts.p.treeANode===-1&&!ts.p.scroll){emptyRows(t);rcnt=0;}else{rcnt=rcnt>0?rcnt:0;}}else{return;}
var i,fpos,ir=0,v,row,gi=0,si=0,ni=0,idn,getId,f=[],F,rd={},rl=ts.rows.length,xmlr,rid,rowData=[],ari=0,cn=(ts.p.altRows===true)?" "+ts.p.altclass:"",cn1;if(!ts.p.xmlReader.repeatitems){f=reader("xml");}
if(ts.p.keyIndex===false){idn=ts.p.xmlReader.id;}else{idn=ts.p.keyIndex;}
if(f.length>0&&!isNaN(idn)){if(ts.p.remapColumns&&ts.p.remapColumns.length){idn=$.inArray(idn,ts.p.remapColumns);}
idn=f[idn];}
if((idn+"").indexOf("[")===-1){if(f.length){getId=function(trow,k){return $(idn,trow).text()||k;};}else{getId=function(trow,k){return $(ts.p.xmlReader.cell,trow).eq(idn).text()||k;};}}
else{getId=function(trow,k){return trow.getAttribute(idn.replace(/[\[\]]/g,""))||k;};}
$(ts.p.xmlReader.page,xml).each(function(){ts.p.page=this.textContent||this.text||1;});$(ts.p.xmlReader.total,xml).each(function(){ts.p.lastpage=this.textContent||this.text;if(ts.p.lastpage===undefined)ts.p.lastpage=1;});$(ts.p.xmlReader.records,xml).each(function(){ts.p.records=this.textContent||this.text||0;});$(ts.p.xmlReader.userdata,xml).each(function(){ts.p.userData[this.getAttribute("name")]=this.textContent||this.text;});var gxml=$(ts.p.xmlReader.root+" "+ts.p.xmlReader.row,xml),gl=gxml.length,j=0;if(gxml&&gl){var rn=parseInt(ts.p.rowNum,10),br=ts.p.scroll?(parseInt(ts.p.page,10)-1)*rn+1:1,altr;if(adjust)rn*=adjust+1;var afterInsRow=$.isFunction(ts.p.afterInsertRow);while(j<gl){xmlr=gxml[j];rid=getId(xmlr,br+j);altr=rcnt==0?0:rcnt+1;cn1=(altr+j)%2==1?cn:'';rowData[ari++]="<tr id=\""+rid+"\" role=\"row\" class =\"ui-widget-content jqgrow ui-row-"+ts.p.direction+""+cn1+"\">";if(ts.p.rownumbers===true){rowData[ari++]=addRowNum(0,j,ts.p.page,ts.p.rowNum);ni=1;}
if(ts.p.multiselect===true){rowData[ari++]=addMulti(rid,ni,j);gi=1;}
if(ts.p.subGrid===true){rowData[ari++]=$(ts).jqGrid("addSubGridCell",gi+ni,j+rcnt);si=1;}
if(ts.p.xmlReader.repeatitems){if(!F)F=orderedCols(gi+si+ni);var cells=$(ts.p.xmlReader.cell,xmlr);$.each(F,function(k){var cell=cells[this];if(!cell)return false;v=cell.textContent||cell.text;rd[ts.p.colModel[k+gi+si+ni].name]=v;rowData[ari++]=addCell(rid,v,k+gi+si+ni,j+rcnt,xmlr);});}else{for(i=0;i<f.length;i++){v=$(f[i],xmlr).text();rd[ts.p.colModel[i+gi+si+ni].name]=v;rowData[ari++]=addCell(rid,v,i+gi+si+ni,j+rcnt,xmlr);}}
rowData[ari++]="</tr>";if(ts.p.gridview===false){if(ts.p.treeGrid===true){fpos=ts.p.treeANode>=-1?ts.p.treeANode:0;row=$(rowData.join(''))[0];try{$(ts).jqGrid("setTreeNode",rd,row);}catch(e){}
rl===0?$("tbody:first",t).append(row):$(ts.rows[j+fpos+rcnt]).after(row);}else{$("tbody:first",t).append(rowData.join(''));}
if(ts.p.subGrid===true){try{$(ts).jqGrid("addSubGrid",ts.rows[ts.rows.length-1],gi+ni);}catch(e){}}
if(afterInsRow){ts.p.afterInsertRow.call(ts,rid,rd,xmlr);}
rowData=[];ari=0;}
rd={};ir++;j++;if(ir==rn){break;}}}
if(ts.p.gridview===true){$("tbody:first",t).append(rowData.join(''));}
ts.p.totaltime=new Date()-startReq;if(ir>0){ts.grid.cols=ts.rows[0].cells;if(ts.p.records===0)ts.p.records=gl;}
rowData=null;if(!ts.p.treeGrid&&!ts.p.scroll){ts.grid.bDiv.scrollTop=0;}
ts.p.reccount=ir;ts.p.treeANode=-1;if(ts.p.userDataOnFooter)$(ts).jqGrid("footerData","set",ts.p.userData,true);if(!more)updatepager(false,true);},addJSONData=function(data,t,rcnt,more,adjust){var startReq=new Date();ts.p.reccount=0;if(data){if(ts.p.treeANode===-1&&!ts.p.scroll){emptyRows(t);rcnt=0;}else{rcnt=rcnt>0?rcnt:0;}}else{return;}
var ir=0,v,i,j,row,f=[],F,cur,gi=0,si=0,ni=0,len,drows,idn,rd={},fpos,rl=ts.rows.length,idr,rowData=[],ari=0,cn=(ts.p.altRows===true)?" "+ts.p.altclass:"",cn1,lp;ts.p.page=getAccessor(data,ts.p.jsonReader.page)||1;lp=getAccessor(data,ts.p.jsonReader.total);ts.p.lastpage=lp===undefined?1:lp;ts.p.records=getAccessor(data,ts.p.jsonReader.records)||0;ts.p.userData=getAccessor(data,ts.p.jsonReader.userdata)||{};if(!ts.p.jsonReader.repeatitems){F=f=reader("json");}
if(ts.p.keyIndex===false){idn=ts.p.jsonReader.id;}else{idn=ts.p.keyIndex;}
if(f.length>0&&!isNaN(idn)){if(ts.p.remapColumns&&ts.p.remapColumns.length){idn=$.inArray(idn,ts.p.remapColumns);}
idn=f[idn];}
drows=getAccessor(data,ts.p.jsonReader.root);if(drows){len=drows.length,i=0;var rn=parseInt(ts.p.rowNum,10),br=ts.p.scroll?(parseInt(ts.p.page,10)-1)*rn+1:1,altr;if(adjust)rn*=adjust+1;var afterInsRow=$.isFunction(ts.p.afterInsertRow);while(i<len){cur=drows[i];idr=cur[idn];if(idr===undefined){idr=br+i;if(f.length===0){if(ts.p.jsonReader.cell){var ccur=cur[ts.p.jsonReader.cell];idr=ccur[idn]||idr;ccur=null;}}}
altr=rcnt==0?0:rcnt+1;cn1=(altr+i)%2==1?cn:'';rowData[ari++]="<tr id=\""+idr+"\" role=\"row\" class= \"ui-widget-content jqgrow ui-row-"+ts.p.direction+""+cn1+"\">";if(ts.p.rownumbers===true){rowData[ari++]=addRowNum(0,i,ts.p.page,ts.p.rowNum);ni=1;}
if(ts.p.multiselect){rowData[ari++]=addMulti(idr,ni,i);gi=1;}
if(ts.p.subGrid){rowData[ari++]=$(ts).jqGrid("addSubGridCell",gi+ni,i+rcnt);si=1;}
if(ts.p.jsonReader.repeatitems){if(ts.p.jsonReader.cell){cur=getAccessor(cur,ts.p.jsonReader.cell);}
if(!F)F=orderedCols(gi+si+ni);}
for(j=0;j<F.length;j++){v=getAccessor(cur,F[j]);rowData[ari++]=addCell(idr,v,j+gi+si+ni,i+rcnt,cur);rd[ts.p.colModel[j+gi+si+ni].name]=v;}
rowData[ari++]="</tr>";if(ts.p.gridview===false){if(ts.p.treeGrid===true){fpos=ts.p.treeANode>=-1?ts.p.treeANode:0;row=$(rowData.join(''))[0];try{$(ts).jqGrid("setTreeNode",rd,row);}catch(e){}
rl===0?$("tbody:first",t).append(row):$(ts.rows[i+fpos+rcnt]).after(row);}else{$("tbody:first",t).append(rowData.join(''));}
if(ts.p.subGrid===true){try{$(ts).jqGrid("addSubGrid",ts.rows[ts.rows.length-1],gi+ni);}catch(e){}}
if(afterInsRow){ts.p.afterInsertRow.call(ts,idr,rd,cur);}
rowData=[];ari=0;}
rd={};ir++;i++;if(ir==rn)break;}
if(ts.p.gridview===true){$("tbody:first",t).append(rowData.join(''));}
ts.p.totaltime=new Date()-startReq;if(ir>0){ts.grid.cols=ts.rows[0].cells;if(ts.p.records===0)ts.p.records=len;}}
if(!ts.p.treeGrid&&!ts.p.scroll){ts.grid.bDiv.scrollTop=0;}
ts.p.reccount=ir;ts.p.treeANode=-1;if(ts.p.userDataOnFooter)$(ts).jqGrid("footerData","set",ts.p.userData,true);if(!more)updatepager(false,true);},updatepager=function(rn,dnd){var cp,last,base,bs,from,to,tot,fmt,pgboxes="";base=(parseInt(ts.p.page,10)-1)*parseInt(ts.p.rowNum,10);to=base+ts.p.reccount;if(ts.p.scroll){var rows=$("tbody:first > tr",ts.grid.bDiv);base=to-rows.length
var rh=rows.outerHeight();if(rh){var top=base*rh;var height=parseInt(ts.p.records,10)*rh;$(">div:first",ts.grid.bDiv).css({height:height}).children("div:first").css({height:top,display:top?"":"none"});}}
pgboxes=ts.p.pager?ts.p.pager:"";pgboxes+=ts.p.toppager?(pgboxes?","+ts.p.toppager:ts.p.toppager):"";if(pgboxes){fmt=$.jgrid.formatter.integer||{};if(ts.p.loadonce){cp=last=1;ts.p.lastpage=ts.page=1;$(".selbox",pgboxes).attr("disabled",true);}else{cp=IntNum(ts.p.page,1);last=IntNum(ts.p.lastpage,1);$(".selbox",pgboxes).attr("disabled",false);}
if(ts.p.pginput===true){$('.ui-pg-input',pgboxes).val(ts.p.page);$('#sp_1',pgboxes).html($.fmatter?$.fmatter.util.NumberFormat(ts.p.lastpage,fmt):ts.p.lastpage);}
if(ts.p.viewrecords){if(ts.p.reccount===0)
$(".ui-paging-info",pgboxes).html(ts.p.emptyrecords);else{from=base+1;tot=ts.p.records;if($.fmatter){from=$.fmatter.util.NumberFormat(from,fmt);to=$.fmatter.util.NumberFormat(to,fmt);tot=$.fmatter.util.NumberFormat(tot,fmt);}
$(".ui-paging-info",pgboxes).html($.jgrid.format(ts.p.recordtext,from,to,tot));}}
if(ts.p.pgbuttons===true){if(cp<=0){cp=last=1;}
if(cp==1){$("#first, #prev",ts.p.pager).addClass('ui-state-disabled').removeClass('ui-state-hover');if(ts.p.toppager)$("#first_t, #prev_t",ts.p.toppager).addClass('ui-state-disabled').removeClass('ui-state-hover');}else{$("#first, #prev",ts.p.pager).removeClass('ui-state-disabled');if(ts.p.toppager)$("#first_t, #prev_t",ts.p.toppager).removeClass('ui-state-disabled');}
if(cp==last){$("#next, #last",ts.p.pager).addClass('ui-state-disabled').removeClass('ui-state-hover');if(ts.p.toppager)$("#next_t, #last_t",ts.p.toppager).addClass('ui-state-disabled').removeClass('ui-state-hover');}else{$("#next, #last",ts.p.pager).removeClass('ui-state-disabled');if(ts.p.toppager)$("#next_t, #last_t",ts.p.toppager).removeClass('ui-state-disabled');}}}
if(rn===true&&ts.p.rownumbers===true){$("td.jqgrid-rownum",ts.rows).each(function(i){$(this).html(base+1+i);});}
if(dnd&&ts.p.jqgdnd){$(ts).jqGrid('gridDnD','updateDnD');}
if($.isFunction(ts.p.gridComplete)){ts.p.gridComplete.call(ts);}},populate=function(npage){if(!ts.grid.hDiv.loading){var pvis=ts.p.scroll&&npage==false;var prm={},dt,dstr,pN=ts.p.prmNames;if(pN.search!==null)prm[pN.search]=ts.p.search;if(pN.nd!=null)prm[pN.nd]=new Date().getTime();if(pN.rows!==null)prm[pN.rows]=ts.p.rowNum;if(pN.page!==null)prm[pN.page]=ts.p.page;if(pN.sort!==null)prm[pN.sort]=ts.p.sortname;if(pN.order!==null)prm[pN.order]=ts.p.sortorder;var lc=ts.p.loadComplete;var lcf=$.isFunction(lc);if(!lcf)lc=null;var adjust=0;npage=npage||1;if(npage>1){if(pN.npage!=null){prm[pN.npage]=npage;adjust=npage-1;npage=1;}else{lc=function(req){if(lcf){ts.p.loadComplete.call(ts,req);}
ts.grid.hDiv.loading=false;ts.p.page++;populate(npage-1);}}}else if(pN.npage!=null){delete ts.p.postData[pN.npage];}
$.extend(ts.p.postData,prm);var rcnt=!ts.p.scroll?0:ts.rows.length-1;if($.isFunction(ts.p.datatype)){ts.p.datatype.call(ts,ts.p.postData,"load_"+ts.p.id);return;}
else if($.isFunction(ts.p.beforeRequest)){ts.p.beforeRequest.call(ts);}
dt=ts.p.datatype.toLowerCase();switch(dt)
{case"json":case"jsonp":case"xml":case"script":$.ajax($.extend({url:ts.p.url,type:ts.p.mtype,dataType:dt,data:$.isFunction(ts.p.serializeGridData)?ts.p.serializeGridData.call(ts,ts.p.postData):ts.p.postData,complete:function(req,st){if(st=="success"||(req.statusText=="OK"&&req.status=="200")){if(dt==="xml")addXmlData(req.responseXML,ts.grid.bDiv,rcnt,npage>1,adjust);else addJSONData($.jgrid.parse(req.responseText),ts.grid.bDiv,rcnt,npage>1,adjust);if(lc)lc.call(ts,req);if(pvis)ts.grid.populateVisible();}
req=null;endReq();},error:function(xhr,st,err){if($.isFunction(ts.p.loadError))ts.p.loadError.call(ts,xhr,st,err);endReq();xhr=null;},beforeSend:function(xhr){beginReq();if($.isFunction(ts.p.loadBeforeSend))ts.p.loadBeforeSend.call(ts,xhr);}},$.jgrid.ajaxOptions,ts.p.ajaxGridOptions));if(ts.p.loadonce||ts.p.treeGrid){ts.p.datatype="local";}
break;case"xmlstring":beginReq();dstr=$.jgrid.stringToDoc(ts.p.datastr)
if(lcf){ts.p.loadComplete.call(ts,dstr);}
addXmlData(dstr,ts.grid.bDiv);ts.p.datatype="local";ts.p.datastr=null;endReq();break;case"jsonstring":beginReq();if(typeof ts.p.datastr=='string')dstr=$.jgrid.parse(ts.p.datastr);else dstr=ts.p.datastr;if(lcf){ts.p.loadComplete.call(ts,dstr);}
addJSONData(dstr,ts.grid.bDiv);ts.p.datatype="local";ts.p.datastr=null;endReq();break;case"local":case"clientside":beginReq();ts.p.datatype="local";if(lcf){ts.p.loadComplete.call(ts,"");}
sortArrayData();updatepager(true,true);endReq();break;}}},beginReq=function(){ts.grid.hDiv.loading=true;if(ts.p.hiddengrid){return;}
switch(ts.p.loadui){case"disable":break;case"enable":$("#load_"+ts.p.id).show();break;case"block":$("#lui_"+ts.p.id).show();$("#load_"+ts.p.id).show();break;}},endReq=function(){ts.grid.hDiv.loading=false;switch(ts.p.loadui){case"disable":break;case"enable":$("#load_"+ts.p.id).hide();break;case"block":$("#lui_"+ts.p.id).hide();$("#load_"+ts.p.id).hide();break;}},sortArrayData=function(){var stripNum=/[\$,%]/g;var rows=[],col=0,st,sv,findSortKey,newDir=(ts.p.sortorder=="asc")?1:-1;$.each(ts.p.colModel,function(i,v){if(this.index==ts.p.sortname||this.name==ts.p.sortname){col=ts.p.lastsort=i;st=this.sorttype;return false;}});if(st=='float'||st=='number'||st=='currency'){findSortKey=function($cell){var key=parseFloat($cell.replace(stripNum,''));return isNaN(key)?0:key;};}else if(st=='int'||st=='integer'){findSortKey=function($cell){return IntNum($cell.replace(stripNum,''),0);};}else if(st=='date'||st=='datetime'){findSortKey=function($cell){var fd=ts.p.colModel[col].datefmt||"Y-m-d";return parseDate(fd,$cell).getTime();};}else{findSortKey=function($cell){return $.trim($cell.toUpperCase());};}
$.each(ts.rows,function(index,row){try{sv=$.unformat($(row).children('td').eq(col),{rowId:row.id,colModel:ts.p.colModel[col]},col,true);}
catch(_){sv=$(row).children('td').eq(col).text();}
row.sortKey=findSortKey(sv);rows[index]=this;});if(ts.p.treeGrid){$(ts).jqGrid("SortTree",newDir);}else{rows.sort(function(a,b){if(a.sortKey<b.sortKey){return-newDir;}
if(a.sortKey>b.sortKey){return newDir;}
return 0;});if(rows[0]){$("td",rows[0]).each(function(k){$(this).css("width",grid.headers[k].width+"px");});ts.grid.cols=rows[0].cells;}
var cn="";if(ts.p.altRows)cn=ts.p.altclass;$.each(rows,function(i,row){if(cn){if(i%2==1)$(row).addClass(cn);else $(row).removeClass(cn);}
$('tbody',ts.grid.bDiv).append(row);row.sortKey=null;});}
ts.grid.bDiv.scrollTop=0;},parseDate=function(format,date){var tsp={m:1,d:1,y:1970,h:0,i:0,s:0},k,hl,dM;date=date.split(/[\\\/:_;.\t\T\s-]/);format=format.split(/[\\\/:_;.\t\T\s-]/);var dfmt=$.jgrid.formatter.date.monthNames;for(k=0,hl=format.length;k<hl;k++){if(format[k]=='M'){dM=$.inArray(date[k],dfmt);if(dM!==-1&&dM<12){date[k]=dM+1;}}
if(format[k]=='F'){dM=$.inArray(date[k],dfmt);if(dM!==-1&&dM>11){date[k]=dM+1-12;}}
tsp[format[k].toLowerCase()]=parseInt(date[k],10);}
tsp.m=parseInt(tsp.m,10)-1;var ty=tsp.y;if(ty>=70&&ty<=99){tsp.y=1900+tsp.y;}
else if(ty>=0&&ty<=69){tsp.y=2000+tsp.y;}
return new Date(tsp.y,tsp.m,tsp.d,tsp.h,tsp.i,tsp.s,0);},setPager=function(pgid,tp){var sep="<td class='ui-pg-button ui-state-disabled' style='width:4px;'><span class='ui-separator'></span></td>",pginp="",pgl="<table cellspacing='0' cellpadding='0' border='0' style='table-layout:auto;' class='ui-pg-table'><tbody><tr>",str="",pgcnt,lft,cent,rgt,twd,tdw,i,clearVals=function(onpaging){ts.p.selrow=null;if(ts.p.multiselect){ts.p.selarrrow=[];$('#cb_'+$.jgrid.jqID(ts.p.id),ts.grid.hDiv).attr("checked",false);}
ts.p.savedRow=[];if($.isFunction(ts.p.onPaging)){if(ts.p.onPaging.call(ts,onpaging)=='stop')return false;}
return true;};pgid=pgid.substr(1);pgcnt="pg_"+pgid;lft=pgid+"_left";cent=pgid+"_center";rgt=pgid+"_right";$("#"+pgid).append("<div id='"+pgcnt+"' class='ui-pager-control' role='group'><table cellspacing='0' cellpadding='0' border='0' class='ui-pg-table' style='width:100%;table-layout:fixed;' role='row'><tbody><tr><td id='"+lft+"' align='left'></td><td id='"+cent+"' align='center' style='white-space:pre;'></td><td id='"+rgt+"' align='right'></td></tr></tbody></table></div>").attr("dir","ltr");if(ts.p.rowList.length>0){str="<td dir='"+dir+"'>";str+="<select class='ui-pg-selbox' role='listbox'>";for(i=0;i<ts.p.rowList.length;i++){str+="<option role='option' value='"+ts.p.rowList[i]+"'"+((ts.p.rowNum==ts.p.rowList[i])?' selected':'')+">"+ts.p.rowList[i]+"</option>";}
str+="</select></td>";}
if(dir=="rtl")pgl+=str;if(ts.p.pginput===true)pginp="<td dir='"+dir+"'>"+$.jgrid.format(ts.p.pgtext||"","<input class='ui-pg-input' type='text' size='2' maxlength='7' value='0' role='textbox'/>","<span id='sp_1'></span>")+"</td>";if(ts.p.pgbuttons===true){var po=["first"+tp,"prev"+tp,"next"+tp,"last"+tp];if(dir=="rtl")po.reverse();pgl+="<td id='"+po[0]+"' class='ui-pg-button ui-corner-all'><span class='ui-icon ui-icon-seek-first'></span></td>";pgl+="<td id='"+po[1]+"' class='ui-pg-button ui-corner-all'><span class='ui-icon ui-icon-seek-prev'></span></td>";pgl+=pginp!=""?sep+pginp+sep:"";pgl+="<td id='"+po[2]+"' class='ui-pg-button ui-corner-all'><span class='ui-icon ui-icon-seek-next'></span></td>";pgl+="<td id='"+po[3]+"' class='ui-pg-button ui-corner-all'><span class='ui-icon ui-icon-seek-end'></span></td>";}else if(pginp!=""){pgl+=pginp;}
if(dir=="ltr")pgl+=str;pgl+="</tr></tbody></table>";if(ts.p.viewrecords===true){$("td#"+pgid+"_"+ts.p.recordpos,"#"+pgcnt).append("<div dir='"+dir+"' style='text-align:"+ts.p.recordpos+"' class='ui-paging-info'></div>");}
$("td#"+pgid+"_"+ts.p.pagerpos,"#"+pgcnt).append(pgl);tdw=$(".ui-jqgrid").css("font-size")||"11px";$('body').append("<div id='testpg' class='ui-jqgrid ui-widget ui-widget-content' style='font-size:"+tdw+";visibility:hidden;' ></div>");twd=$(pgl).clone().appendTo("#testpg").width();$("#testpg").remove();if(twd>0){if(pginp!="")twd+=50;$("td#"+pgid+"_"+ts.p.pagerpos,"#"+pgcnt).width(twd);}
ts.p._nvtd=[];ts.p._nvtd[0]=twd?Math.floor((ts.p.width-twd)/2):Math.floor(ts.p.width/3);ts.p._nvtd[1]=0;pgl=null;$('.ui-pg-selbox',"#"+pgcnt).bind('change',function(){ts.p.page=Math.round(ts.p.rowNum*(ts.p.page-1)/this.value-0.5)+1;ts.p.rowNum=this.value;if(tp)$('.ui-pg-selbox',ts.p.pager).val(this.value);else if(ts.p.toppager)$('.ui-pg-selbox',ts.p.toppager).val(this.value);if(!clearVals('records'))return false;populate();return false;});if(ts.p.pgbuttons===true){$(".ui-pg-button","#"+pgcnt).hover(function(e){if($(this).hasClass('ui-state-disabled')){this.style.cursor='default';}else{$(this).addClass('ui-state-hover');this.style.cursor='pointer';}},function(e){if($(this).hasClass('ui-state-disabled')){}else{$(this).removeClass('ui-state-hover');this.style.cursor="default";}});$("#first"+tp+", #prev"+tp+", #next"+tp+", #last"+tp,"#"+pgid).click(function(e){var cp=IntNum(ts.p.page,1),last=IntNum(ts.p.lastpage,1),selclick=false,fp=true,pp=true,np=true,lp=true;if(last===0||last===1){fp=false;pp=false;np=false;lp=false;}
else if(last>1&&cp>=1){if(cp===1){fp=false;pp=false;}
else if(cp>1&&cp<last){}
else if(cp===last){np=false;lp=false;}}else if(last>1&&cp===0){np=false;lp=false;cp=last-1;}
if(this.id==='first'+tp&&fp){ts.p.page=1;selclick=true;}
if(this.id==='prev'+tp&&pp){ts.p.page=(cp-1);selclick=true;}
if(this.id==='next'+tp&&np){ts.p.page=(cp+1);selclick=true;}
if(this.id==='last'+tp&&lp){ts.p.page=last;selclick=true;}
if(selclick){if(!clearVals(this.id))return false;populate();}
return false;});}
if(ts.p.pginput===true){$('input.ui-pg-input',"#"+pgcnt).keypress(function(e){var key=e.charCode?e.charCode:e.keyCode?e.keyCode:0;if(key==13){ts.p.page=($(this).val()>0)?$(this).val():ts.p.page;if(!clearVals('user'))return false;populate();return false;}
return this;});}},sortData=function(index,idxcol,reload,sor){if(!ts.p.colModel[idxcol].sortable)return;var imgs,so;if(ts.p.savedRow.length>0){return;}
if(!reload){if(ts.p.lastsort==idxcol){if(ts.p.sortorder=='asc'){ts.p.sortorder='desc';}else if(ts.p.sortorder=='desc'){ts.p.sortorder='asc';}}else{ts.p.sortorder='asc';}
ts.p.page=1;}
if(sor){if(ts.p.lastsort==idxcol&&ts.p.sortorder==sor)return;else ts.p.sortorder=sor;}
var thd=$("thead:first",ts.grid.hDiv).get(0);$("tr th:eq("+ts.p.lastsort+") span.ui-grid-ico-sort",thd).addClass('ui-state-disabled');$("tr th:eq("+ts.p.lastsort+")",thd).attr("aria-selected","false");$("tr th:eq("+idxcol+") span.ui-icon-"+ts.p.sortorder,thd).removeClass('ui-state-disabled');$("tr th:eq("+idxcol+")",thd).attr("aria-selected","true");if(!ts.p.viewsortcols[0]){if(ts.p.lastsort!=idxcol){$("tr th:eq("+ts.p.lastsort+") span.s-ico",thd).hide();$("tr th:eq("+idxcol+") span.s-ico",thd).show();}}
ts.p.lastsort=idxcol;index=index.substring(5);ts.p.sortname=ts.p.colModel[idxcol].index||index;so=ts.p.sortorder;if($.isFunction(ts.p.onSortCol)){if(ts.p.onSortCol.call(ts,index,idxcol,so)=='stop'){return;}}
if(ts.p.datatype=="local"){if(ts.p.deselectAfterSort){$(ts).jqGrid("resetSelection");}}else{ts.p.selrow=null;if(ts.p.multiselect){$("#cb_"+$.jgrid.jqID(ts.p.id),ts.grid.hDiv).attr("checked",false);}
ts.p.selarrrow=[];ts.p.savedRow=[];if(ts.p.scroll){emptyRows(ts.grid.bDiv,true);}}
if(ts.p.subGrid&&ts.p.datatype=='local'){$("td.sgexpanded","#"+ts.p.id).each(function(){$(this).trigger("click");});}
populate();if(ts.p.sortname!=index&&idxcol){ts.p.lastsort=idxcol;}},setColWidth=function(){var initwidth=0,brd=ts.p.cellLayout,vc=0,lvc,scw=ts.p.scrollOffset,cw,hs=false,aw,tw=0,gw=0,cl=0,cr;if(isSafari){brd=0;}
$.each(ts.p.colModel,function(i){if(typeof this.hidden==='undefined'){this.hidden=false;}
if(this.hidden===false){initwidth+=IntNum(this.width,0);if(this.fixed){tw+=this.width;gw+=this.width+brd;}else{vc++;}
cl++;}});if(isNaN(ts.p.width)){ts.p.width=grid.width=initwidth;}
else{grid.width=ts.p.width}
ts.p.tblwidth=initwidth;if(ts.p.shrinkToFit===false&&ts.p.forceFit===true){ts.p.forceFit=false;}
if(ts.p.shrinkToFit===true&&vc>0){aw=grid.width-brd*vc-gw;if(isNaN(ts.p.height)){}else{aw-=scw;hs=true;}
initwidth=0;$.each(ts.p.colModel,function(i){if(this.hidden===false&&!this.fixed){cw=Math.floor(aw/(ts.p.tblwidth-tw)*this.width);this.width=cw;initwidth+=cw;lvc=i;}});cr=0;if(hs){if(grid.width-gw-(initwidth+brd*vc)!==scw)
cr=grid.width-gw-(initwidth+brd*vc)-scw;}else if(!hs&&Math.abs(grid.width-gw-(initwidth+brd*vc))!==1){cr=grid.width-gw-(initwidth+brd*vc);}
ts.p.colModel[lvc].width+=cr;ts.p.tblwidth=initwidth+cr+tw+cl*brd;}},nextVisible=function(iCol){var ret=iCol,j=iCol,i;for(i=iCol+1;i<ts.p.colModel.length;i++){if(ts.p.colModel[i].hidden!==true){j=i;break;}}
return j-ret;},getOffset=function(iCol){var i,ret={},brd1=isSafari?0:ts.p.cellLayout;ret[0]=ret[1]=ret[2]=0;for(i=0;i<=iCol;i++){if(ts.p.colModel[i].hidden===false){ret[0]+=ts.p.colModel[i].width+brd1;}}
if(ts.p.direction=="rtl")ret[0]=ts.p.width-ret[0];ret[0]=ret[0]-ts.grid.bDiv.scrollLeft;if($(ts.grid.cDiv).is(":visible")){ret[1]+=$(ts.grid.cDiv).height()+parseInt($(ts.grid.cDiv).css("padding-top"),10)+parseInt($(ts.grid.cDiv).css("padding-bottom"),10);}
if(ts.p.toolbar[0]==true&&(ts.p.toolbar[1]=='top'||ts.p.toolbar[1]=='both')){ret[1]+=$(ts.grid.uDiv).height()+parseInt($(ts.grid.uDiv).css("border-top-width"),10)+parseInt($(ts.grid.uDiv).css("border-bottom-width"),10);}
if(ts.p.toppager){ret[1]+=$(ts.grid.topDiv).height()+parseInt($(ts.grid.topDiv).css("border-bottom-width"),10);}
ret[2]+=$(ts.grid.bDiv).height()+$(ts.grid.hDiv).height();return ret;};this.p.id=this.id;if($.inArray(ts.p.multikey,sortkeys)==-1){ts.p.multikey=false;}
ts.p.keyIndex=false;for(i=0;i<ts.p.colModel.length;i++){if(ts.p.colModel[i].key===true){ts.p.keyIndex=i;break;}}
ts.p.sortorder=ts.p.sortorder.toLowerCase();if(this.p.treeGrid===true){try{$(this).jqGrid("setTreeGrid");}catch(_){}}
if(this.p.subGrid){try{$(ts).jqGrid("setSubGrid");}catch(_){}}
if(this.p.multiselect){this.p.colNames.unshift("<input id='cb_"+this.p.id+"' class='cbox' type='checkbox'/>");this.p.colModel.unshift({name:'cb',width:isSafari?ts.p.multiselectWidth+ts.p.cellLayout:ts.p.multiselectWidth,sortable:false,resizable:false,hidedlg:true,search:false,align:'center',fixed:true});}
if(this.p.rownumbers){this.p.colNames.unshift("");this.p.colModel.unshift({name:'rn',width:ts.p.rownumWidth,sortable:false,resizable:false,hidedlg:true,search:false,align:'center',fixed:true});}
ts.p.xmlReader=$.extend(true,{root:"rows",row:"row",page:"rows>page",total:"rows>total",records:"rows>records",repeatitems:true,cell:"cell",id:"[id]",userdata:"userdata",subgrid:{root:"rows",row:"row",repeatitems:true,cell:"cell"}},ts.p.xmlReader);ts.p.jsonReader=$.extend(true,{root:"rows",page:"page",total:"total",records:"records",repeatitems:true,cell:"cell",id:"id",userdata:"userdata",subgrid:{root:"rows",repeatitems:true,cell:"cell"}},ts.p.jsonReader);if(ts.p.scroll){ts.p.pgbuttons=false;ts.p.pginput=false;ts.p.rowList=[];}
var thead="<thead><tr class='ui-jqgrid-labels' role='rowheader'>",tdc,idn,w,res,sort,td,ptr,tbody,imgs,iac="",idc="";if(ts.p.shrinkToFit===true&&ts.p.forceFit===true){for(i=ts.p.colModel.length-1;i>=0;i--){if(!ts.p.colModel[i].hidden){ts.p.colModel[i].resizable=false;break;}}}
if(ts.p.viewsortcols[1]=='horizontal'){iac=" ui-i-asc";idc=" ui-i-desc";}
tdc=isMSIE?"class='ui-th-div-ie'":"";imgs="<span class='s-ico' style='display:none'><span sort='asc' class='ui-grid-ico-sort ui-icon-asc"+iac+" ui-state-disabled ui-icon ui-icon-triangle-1-n ui-sort-"+dir+"'></span>";imgs+="<span sort='desc' class='ui-grid-ico-sort ui-icon-desc"+idc+" ui-state-disabled ui-icon ui-icon-triangle-1-s ui-sort-"+dir+"'></span></span>";for(i=0;i<this.p.colNames.length;i++){thead+="<th role='columnheader' class='ui-state-default ui-th-column ui-th-"+dir+"'>";idn=ts.p.colModel[i].index||ts.p.colModel[i].name;thead+="<div id='jqgh_"+ts.p.colModel[i].name+"' "+tdc+">"+ts.p.colNames[i];if(idn==ts.p.sortname){ts.p.lastsort=i;}
thead+=imgs+"</div></th>";}
thead+="</tr></thead>";$(this).append(thead);$("thead tr:first th",this).hover(function(){$(this).addClass('ui-state-hover');},function(){$(this).removeClass('ui-state-hover');});if(this.p.multiselect){var onSA=true,emp=[],chk;if(typeof ts.p.onSelectAll!=='function'){onSA=false;}
$('#cb_'+$.jgrid.jqID(ts.p.id),this).bind('click',function(){if(this.checked){$("[id^=jqg_]",ts.rows).attr("checked",true);$(ts.rows).each(function(i){if(!$(this).hasClass("subgrid")){$(this).addClass("ui-state-highlight").attr("aria-selected","true");ts.p.selarrrow[i]=ts.p.selrow=this.id;}});chk=true;emp=[];}
else{$("[id^=jqg_]",ts.rows).attr("checked",false);$(ts.rows).each(function(i){if(!$(this).hasClass("subgrid")){$(this).removeClass("ui-state-highlight").attr("aria-selected","false");emp[i]=this.id;}});ts.p.selarrrow=[];ts.p.selrow=null;chk=false;}
if(onSA){ts.p.onSelectAll.call(ts,chk?ts.p.selarrrow:emp,chk);}});}
$.each(ts.p.colModel,function(i){if(!this.width){this.width=150;}this.width=parseInt(this.width,10);});if(ts.p.autowidth===true){var pw=$(eg).innerWidth();ts.p.width=pw>0?pw:'nw';}
setColWidth();$(eg).css("width",grid.width+"px").append("<div class='ui-jqgrid-resize-mark' id='rs_m"+ts.p.id+"'>&#160;</div>");$(gv).css("width",grid.width+"px");thead=$("thead:first",ts).get(0);var tfoot="<table role='grid' style='width:"+ts.p.tblwidth+"px' class='ui-jqgrid-ftable' cellspacing='0' cellpadding='0' border='0'><tbody><tr role='row' class='ui-widget-content footrow footrow-"+dir+"'>";var thr=$("tr:first",thead);ts.p.disableClick=false;$("th",thr).each(function(j){var ht=$('div',this)[0];w=ts.p.colModel[j].width;if(typeof ts.p.colModel[j].resizable==='undefined'){ts.p.colModel[j].resizable=true;}
if(ts.p.colModel[j].resizable){res=document.createElement("span");$(res).html("&#160;").addClass('ui-jqgrid-resize ui-jqgrid-resize-'+dir);!$.browser.opera?$(res).css("cursor","col-resize"):"";$(this).addClass(ts.p.resizeclass);}else{res="";}
$(this).css("width",w+"px").prepend(res);if(ts.p.colModel[j].hidden)$(this).css("display","none");grid.headers[j]={width:w,el:this};sort=ts.p.colModel[j].sortable;if(typeof sort!=='boolean'){ts.p.colModel[j].sortable=true;sort=true;}
var nm=ts.p.colModel[j].name;if(!(nm=='cb'||nm=='subgrid'||nm=='rn')){if(ts.p.viewsortcols[2])
$("div",this).addClass('ui-jqgrid-sortable');}
if(sort){if(ts.p.viewsortcols[0]){$("div span.s-ico",this).show();if(j==ts.p.lastsort){$("div span.ui-icon-"+ts.p.sortorder,this).removeClass("ui-state-disabled");}}
else if(j==ts.p.lastsort){$("div span.s-ico",this).show();$("div span.ui-icon-"+ts.p.sortorder,this).removeClass("ui-state-disabled");}}
tfoot+="<td role='gridcell' "+formatCol(j,0)+">&#160;</td>";}).mousedown(function(e){if($(e.target).closest("th>span.ui-jqgrid-resize").length!=1)return;var ci=$.jgrid.getCellIndex(this);if(ts.p.forceFit===true){ts.p.nv=nextVisible(ci);}
grid.dragStart(ci,e,getOffset(ci));return false;}).click(function(e){if(ts.p.disableClick){ts.p.disableClick=false;return false;}
var s="th>div.ui-jqgrid-sortable",r,d;if(!ts.p.viewsortcols[2]){s="th>div>span>span.ui-grid-ico-sort"}
var t=$(e.target).closest(s);if(t.length!=1)return;var ci=$.jgrid.getCellIndex(this);if(!ts.p.viewsortcols[2]){r=true,d=t.attr("sort")}
sortData($('div',this)[0].id,ci,r,d);return false;});if(ts.p.sortable&&$.fn.sortable){try{$(ts).jqGrid("sortableColumns",thr);}catch(e){}}
tfoot+="</tr></tbody></table>";tbody=document.createElement("tbody");this.appendChild(tbody);$(this).addClass('ui-jqgrid-btable');var hTable=$("<table class='ui-jqgrid-htable' style='width:"+ts.p.tblwidth+"px' role='grid' aria-labelledby='gbox_"+this.id+"' cellspacing='0' cellpadding='0' border='0'></table>").append(thead),hg=(ts.p.caption&&ts.p.hiddengrid===true)?true:false,hb=$("<div class='ui-jqgrid-hbox"+(dir=="rtl"?"-rtl":"")+"'></div>");grid.hDiv=document.createElement("div");$(grid.hDiv).css({width:grid.width+"px"}).addClass("ui-state-default ui-jqgrid-hdiv").append(hb);$(hb).append(hTable);if(hg)$(grid.hDiv).hide();if(ts.p.pager){if(typeof ts.p.pager=="string"){if(ts.p.pager.substr(0,1)!="#")ts.p.pager="#"+ts.p.pager;}
else{ts.p.pager="#"+$(ts.p.pager).attr("id");}
$(ts.p.pager).css({width:grid.width+"px"}).appendTo(eg).addClass('ui-state-default ui-jqgrid-pager ui-corner-bottom');if(hg){$(ts.p.pager).hide();}
setPager(ts.p.pager,'');}
if(ts.p.cellEdit===false&&ts.p.hoverrows===true){$(ts).bind('mouseover',function(e){ptr=$(e.target).closest("tr.jqgrow");if($(ptr).attr("class")!=="subgrid"){$(ptr).addClass("ui-state-hover");}
return false;}).bind('mouseout',function(e){ptr=$(e.target).closest("tr.jqgrow");$(ptr).removeClass("ui-state-hover");return false;});}
var ri,ci;$(ts).before(grid.hDiv).click(function(e){td=e.target;var scb=$(td).hasClass("cbox");ptr=$(td,ts.rows).closest("tr.jqgrow");if($(ptr).length===0){return this;}
var cSel=true;if($.isFunction(ts.p.beforeSelectRow))cSel=ts.p.beforeSelectRow.call(ts,ptr[0].id,e);if(td.tagName=='A'||((td.tagName=='INPUT'||td.tagName=='TEXTAREA'||td.tagName=='OPTION'||td.tagName=='SELECT')&&!scb)){return true;}
if(cSel===true){if(ts.p.cellEdit===true){if(ts.p.multiselect&&scb){$(ts).jqGrid("setSelection",ptr[0].id,true);}else{ri=ptr[0].rowIndex;ci=$.jgrid.getCellIndex(td);try{$(ts).jqGrid("editCell",ri,ci,true);}catch(_){}}}else if(!ts.p.multikey){if(ts.p.multiselect&&ts.p.multiboxonly){if(scb){$(ts).jqGrid("setSelection",ptr[0].id,true);}
else{$(ts.p.selarrrow).each(function(i,n){var ind=ts.rows.namedItem(n);$(ind).removeClass("ui-state-highlight");$("#jqg_"+$.jgrid.jqID(n),ind).attr("checked",false);});ts.p.selarrrow=[];$("#cb_"+$.jgrid.jqID(ts.p.id),ts.grid.hDiv).attr("checked",false);$(ts).jqGrid("setSelection",ptr[0].id,true);}}else{$(ts).jqGrid("setSelection",ptr[0].id,true);}}else{if(e[ts.p.multikey]){$(ts).jqGrid("setSelection",ptr[0].id,true);}else if(ts.p.multiselect&&scb){scb=$("[id^=jqg_]",ptr).attr("checked");$("[id^=jqg_]",ptr).attr("checked",!scb);}}
if($.isFunction(ts.p.onCellSelect)){ri=ptr[0].id;ci=$.jgrid.getCellIndex(td);ts.p.onCellSelect.call(ts,ri,ci,$(td).html(),e);}}
e.stopPropagation();}).bind('reloadGrid',function(e,opts){if(ts.p.treeGrid===true){ts.p.datatype=ts.p.treedatatype;}
if(opts&&opts.current){ts.grid.selectionPreserver(ts);}
if(ts.p.datatype=="local"){$(ts).jqGrid("resetSelection");}
else if(!ts.p.treeGrid){ts.p.selrow=null;if(ts.p.multiselect){ts.p.selarrrow=[];$('#cb_'+$.jgrid.jqID(ts.p.id),ts.grid.hDiv).attr("checked",false);}
ts.p.savedRow=[];if(ts.p.scroll){emptyRows(ts.grid.bDiv);}}
if(opts&&opts.page){var page=opts.page;if(page>ts.p.lastpage)page=ts.p.lastpage;if(page<1)page=1;ts.p.page=page;if(ts.grid.prevRowHeight){ts.grid.bDiv.scrollTop=(page-1)*ts.grid.prevRowHeight*ts.p.rowNum;}else{ts.grid.bDiv.scrollTop=0;}}
if(ts.grid.prevRowHeight&&ts.p.scroll){delete ts.p.lastpage;ts.grid.populateVisible();}else
ts.grid.populate();return false;});if($.isFunction(this.p.ondblClickRow)){$(this).dblclick(function(e){td=e.target;ptr=$(td,ts.rows).closest("tr.jqgrow");if($(ptr).length===0){return false;}
ri=ptr[0].rowIndex;ci=$.jgrid.getCellIndex(td);ts.p.ondblClickRow.call(ts,$(ptr).attr("id"),ri,ci,e);return false;});}
if($.isFunction(this.p.onRightClickRow)){$(this).bind('contextmenu',function(e){td=e.target;ptr=$(td,ts.rows).closest("tr.jqgrow");if($(ptr).length===0){return false;}
if(!ts.p.multiselect){$(ts).jqGrid("setSelection",ptr[0].id,true);}
ri=ptr[0].rowIndex;ci=$.jgrid.getCellIndex(td);ts.p.onRightClickRow.call(ts,$(ptr).attr("id"),ri,ci,e);return false;});}
grid.bDiv=document.createElement("div");$(grid.bDiv).append($('<div style="position:relative;'+(isMSIE&&$.browser.version<8?"height:0.01%;":"")+'"></div>').append('<div></div>').append(this)).addClass("ui-jqgrid-bdiv").css({height:ts.p.height+(isNaN(ts.p.height)?"":"px"),width:(grid.width)+"px"}).scroll(grid.scrollGrid);$("table:first",grid.bDiv).css({width:ts.p.tblwidth+"px"});if(isMSIE){if($("tbody",this).size()==2){$("tbody:first",this).remove();}
if(ts.p.multikey){$(grid.bDiv).bind("selectstart",function(){return false;});}}else{if(ts.p.multikey){$(grid.bDiv).bind("mousedown",function(){return false;});}}
if(hg){$(grid.bDiv).hide();}
grid.cDiv=document.createElement("div");var arf=ts.p.hidegrid===true?$("<a role='link' href='javascript:void(0)'/>").addClass('ui-jqgrid-titlebar-close HeaderButton').hover(function(){arf.addClass('ui-state-hover');},function(){arf.removeClass('ui-state-hover');}).append("<span class='ui-icon ui-icon-circle-triangle-n'></span>").css((dir=="rtl"?"left":"right"),"0px"):"";$(grid.cDiv).append(arf).append("<span class='ui-jqgrid-title"+(dir=="rtl"?"-rtl":"")+"'>"+ts.p.caption+"</span>").addClass("ui-jqgrid-titlebar ui-widget-header ui-corner-top ui-helper-clearfix");$(grid.cDiv).insertBefore(grid.hDiv);if(ts.p.toolbar[0]){grid.uDiv=document.createElement("div");if(ts.p.toolbar[1]=="top"){$(grid.uDiv).insertBefore(grid.hDiv);}
else if(ts.p.toolbar[1]=="bottom"){$(grid.uDiv).insertAfter(grid.hDiv);}
if(ts.p.toolbar[1]=="both"){grid.ubDiv=document.createElement("div");$(grid.uDiv).insertBefore(grid.hDiv).addClass("ui-userdata ui-state-default").attr("id","t_"+this.id);$(grid.ubDiv).insertAfter(grid.hDiv).addClass("ui-userdata ui-state-default").attr("id","tb_"+this.id);if(hg){$(grid.ubDiv).hide();}}else{$(grid.uDiv).width(grid.width).addClass("ui-userdata ui-state-default").attr("id","t_"+this.id);}
if(hg){$(grid.uDiv).hide();}}
if(ts.p.toppager){ts.p.toppager=ts.p.id+"_toppager";grid.topDiv=$("<div id='"+ts.p.toppager+"'></div>")[0];ts.p.toppager="#"+ts.p.toppager;$(grid.topDiv).insertBefore(grid.hDiv).addClass('ui-state-default ui-jqgrid-toppager').width(grid.width);setPager(ts.p.toppager,'_t');}
if(ts.p.footerrow){grid.sDiv=$("<div class='ui-jqgrid-sdiv'></div>")[0];hb=$("<div class='ui-jqgrid-hbox"+(dir=="rtl"?"-rtl":"")+"'></div>");$(grid.sDiv).append(hb).insertAfter(grid.hDiv).width(grid.width);$(hb).append(tfoot);grid.footers=$(".ui-jqgrid-ftable",grid.sDiv)[0].rows[0].cells;if(ts.p.rownumbers)grid.footers[0].className='ui-state-default jqgrid-rownum';if(hg){$(grid.sDiv).hide();}}
if(ts.p.caption){var tdt=ts.p.datatype;if(ts.p.hidegrid===true){$(".ui-jqgrid-titlebar-close",grid.cDiv).click(function(e){var onHdCl=$.isFunction(ts.p.onHeaderClick);if(ts.p.gridstate=='visible'){$(".ui-jqgrid-bdiv, .ui-jqgrid-hdiv","#gview_"+ts.p.id).slideUp("fast");if(ts.p.pager){$(ts.p.pager).slideUp("fast");}
if(ts.p.toppager){$(ts.p.toppager).slideUp("fast");}
if(ts.p.toolbar[0]===true){if(ts.p.toolbar[1]=='both'){$(grid.ubDiv).slideUp("fast");}
$(grid.uDiv).slideUp("fast");}
if(ts.p.footerrow)$(".ui-jqgrid-sdiv","#gbox_"+ts.p.id).slideUp("fast");$("span",this).removeClass("ui-icon-circle-triangle-n").addClass("ui-icon-circle-triangle-s");ts.p.gridstate='hidden';if(onHdCl){if(!hg){ts.p.onHeaderClick.call(ts,ts.p.gridstate,e);}}}else if(ts.p.gridstate=='hidden'){$(".ui-jqgrid-hdiv, .ui-jqgrid-bdiv","#gview_"+ts.p.id).slideDown("fast");if(ts.p.pager){$(ts.p.pager).slideDown("fast");}
if(ts.p.toppager){$(ts.p.toppager).slideDown("fast");}
if(ts.p.toolbar[0]===true){if(ts.p.toolbar[1]=='both'){$(grid.ubDiv).slideDown("fast");}
$(grid.uDiv).slideDown("fast");}
if(ts.p.footerrow)$(".ui-jqgrid-sdiv","#gbox_"+ts.p.id).slideDown("fast");$("span",this).removeClass("ui-icon-circle-triangle-s").addClass("ui-icon-circle-triangle-n");if(hg){ts.p.datatype=tdt;populate();hg=false;}
ts.p.gridstate='visible';if(onHdCl){ts.p.onHeaderClick.call(ts,ts.p.gridstate,e)}}
return false;});if(hg){ts.p.datatype="local";$(".ui-jqgrid-titlebar-close",grid.cDiv).trigger("click");}}}else{$(grid.cDiv).hide();}
$(grid.hDiv).after(grid.bDiv).mousemove(function(e){if(grid.resizing){grid.dragMove(e);return false;}});$(".ui-jqgrid-labels",grid.hDiv).bind("selectstart",function(){return false;});$(document).mouseup(function(e){if(grid.resizing){grid.dragEnd();return false;}
return true;});this.updateColumns=function(){var r=this.rows[0],self=this;if(r){$("td",r).each(function(k){$(this).css("width",self.grid.headers[k].width+"px");});this.grid.cols=r.cells;}
return this;}
ts.formatCol=formatCol;ts.sortData=sortData;ts.updatepager=updatepager;ts.formatter=function(rowId,cellval,colpos,rwdat,act){return formatter(rowId,cellval,colpos,rwdat,act);};$.extend(grid,{populate:populate,emptyRows:emptyRows});this.grid=grid;ts.addXmlData=function(d){addXmlData(d,ts.grid.bDiv);};ts.addJSONData=function(d){addJSONData(d,ts.grid.bDiv);};populate();ts.p.hiddengrid=false;$(window).unload(function(){$(this).empty();this.grid=null;this.p=null;});});};$.jgrid.extend({getGridParam:function(pName){var $t=this[0];if(!$t.grid){return;}
if(!pName){return $t.p;}
else{return typeof($t.p[pName])!="undefined"?$t.p[pName]:null;}},setGridParam:function(newParams){return this.each(function(){if(this.grid&&typeof(newParams)==='object'){$.extend(true,this.p,newParams);}});},getDataIDs:function(){var ids=[],i=0,len;this.each(function(){len=this.rows.length;if(len&&len>0){while(i<len){ids[i]=this.rows[i].id;i++;}}});return ids;},setSelection:function(selection,onsr){return this.each(function(){var $t=this,stat,pt,olr,ner,ia,tpsr;if(selection===undefined)return;onsr=onsr===false?false:true;pt=$t.rows.namedItem(selection+"");if(pt===null)return;if($t.p.selrow&&$t.p.scrollrows===true){olr=$t.rows.namedItem($t.p.selrow).rowIndex;ner=$t.rows.namedItem(selection).rowIndex;if(ner>=0){if(ner>olr){scrGrid(ner,'d');}else{scrGrid(ner,'u');}}}
if(!$t.p.multiselect){if(pt.className!=="ui-subgrid"){if($t.p.selrow){$("tr#"+$.jgrid.jqID($t.p.selrow),$t.grid.bDiv).removeClass("ui-state-highlight").attr("aria-selected","false");}
$t.p.selrow=pt.id;$(pt).addClass("ui-state-highlight").attr("aria-selected","true");if($t.p.onSelectRow&&onsr){$t.p.onSelectRow.call($t,$t.p.selrow,true);}}}else{$t.p.selrow=pt.id;ia=$.inArray($t.p.selrow,$t.p.selarrrow);if(ia===-1){if(pt.className!=="ui-subgrid"){$(pt).addClass("ui-state-highlight").attr("aria-selected","true");}
stat=true;$("#jqg_"+$.jgrid.jqID($t.p.selrow),$t.rows[pt.rowIndex]).attr("checked",stat);$t.p.selarrrow.push($t.p.selrow);if($t.p.onSelectRow&&onsr){$t.p.onSelectRow.call($t,$t.p.selrow,stat);}}else{if(pt.className!=="ui-subgrid"){$(pt).removeClass("ui-state-highlight").attr("aria-selected","false");}
stat=false;$("#jqg_"+$.jgrid.jqID($t.p.selrow),$t.rows[pt.rowIndex]).attr("checked",stat);$t.p.selarrrow.splice(ia,1);if($t.p.onSelectRow&&onsr){$t.p.onSelectRow.call($t,$t.p.selrow,stat);}
tpsr=$t.p.selarrrow[0];$t.p.selrow=(tpsr===undefined)?null:tpsr;}}
function scrGrid(iR,tp){var ch=$($t.grid.bDiv)[0].clientHeight,st=$($t.grid.bDiv)[0].scrollTop,nROT=$t.rows[iR].offsetTop+$t.rows[iR].clientHeight,pROT=$t.rows[iR].offsetTop;if(tp=='d'){if(nROT>=ch){$($t.grid.bDiv)[0].scrollTop=st+nROT-pROT;}}
if(tp=='u'){if(pROT<st){$($t.grid.bDiv)[0].scrollTop=st-nROT+pROT;}}}});},resetSelection:function(){return this.each(function(){var t=this,ind;if(!t.p.multiselect){if(t.p.selrow){$("tr#"+$.jgrid.jqID(t.p.selrow),t.grid.bDiv).removeClass("ui-state-highlight").attr("aria-selected","false");t.p.selrow=null;}}else{$(t.p.selarrrow).each(function(i,n){ind=t.rows.namedItem(n);$(ind).removeClass("ui-state-highlight").attr("aria-selected","false");$("#jqg_"+$.jgrid.jqID(n),ind).attr("checked",false);});$("#cb_"+$.jgrid.jqID(t.p.id),t.grid.hDiv).attr("checked",false);t.p.selarrrow=[];}
t.p.savedRow=[];});},getRowData:function(rowid){var res={},resall,getall=false,len,j=0;this.each(function(){var $t=this,nm,ind;if(typeof(rowid)=='undefined'){getall=true;resall=[];len=$t.rows.length;}else{ind=$t.rows.namedItem(rowid);if(!ind)return res;len=1;}
while(j<len){if(getall)ind=$t.rows[j];$('td',ind).each(function(i){nm=$t.p.colModel[i].name;if(nm!=='cb'&&nm!=='subgrid'){if($t.p.treeGrid===true&&nm==$t.p.ExpandColumn){res[nm]=$.jgrid.htmlDecode($("span:first",this).html());}else{try{res[nm]=$.unformat(this,{rowId:ind.id,colModel:$t.p.colModel[i]},i);}catch(e){res[nm]=$.jgrid.htmlDecode($(this).html());}}}});j++;if(getall){resall.push(res);res={};}}});return resall?resall:res;},delRowData:function(rowid){var success=false,rowInd,ia,ri;this.each(function(){var $t=this;rowInd=$t.rows.namedItem(rowid);if(!rowInd){return false;}
else{ri=rowInd.rowIndex;$(rowInd).remove();$t.p.records--;$t.p.reccount--;$t.updatepager(true,false);success=true;if($t.p.multiselect){ia=$.inArray(rowid,$t.p.selarrrow);if(ia!=-1){$t.p.selarrrow.splice(ia,1);}}
if(rowid==$t.p.selrow){$t.p.selrow=null;}}
if(ri==0&&success){$t.updateColumns();}
if($t.p.altRows===true&&success){var cn=$t.p.altclass;$($t.rows).each(function(i){if(i%2==1)$(this).addClass(cn);else $(this).removeClass(cn);});}});return success;},setRowData:function(rowid,data,cssp){var nm,success=false;this.each(function(){var t=this,vl,ind,cp=typeof cssp;;if(!t.grid){return false;}
ind=t.rows.namedItem(rowid);if(!ind)return false;if(data){$(this.p.colModel).each(function(i){nm=this.name;if(data[nm]!=undefined){vl=t.formatter(rowid,data[nm],i,data,'edit');if(t.p.treeGrid===true&&nm==t.p.ExpandColumn){$("td:eq("+i+") > span:first",ind).html(vl).attr("title",$.jgrid.stripHtml(vl));}else{$("td:eq("+i+")",ind).html(vl).attr("title",$.jgrid.stripHtml(vl));}
success=true;}});}
if(cp==='string'){$(ind).addClass(cssp);}else if(cp==='object'){$(ind).css(cssp);}});return success;},addRowData:function(rowid,rdata,pos,src){if(!pos){pos="last";}
var success=false,nm,row,gi,si,ni,sind,i,v,prp="",aradd,cnm,cn;if(rdata){if($.isArray(rdata)){aradd=true;pos="last";cnm=rowid;}else{rdata=[rdata];aradd=false;}
this.each(function(){var t=this,rowslen=t.rows.length||0,datalen=rdata.length;ni=t.p.rownumbers===true?1:0;gi=t.p.multiselect===true?1:0;si=t.p.subGrid===true?1:0;if(!aradd){if(typeof(rowid)!='undefined')rowid=rowid+"";else{rowid=(t.p.records+1)+"";if(t.p.keyIndex!==false){cmn=t.p.colModel[t.p.keyIndex+gi+si+ni].name;if(typeof rdata[0][cmn]!="undefined")rowid=rdata[0][cmn];}}}
cn=t.p.altclass;var k=0;var air=$.isFunction(t.p.afterInsertRow)?true:false;while(k<datalen){data=rdata[k];row="";if(aradd){try{rowid=data[cnm];}
catch(e){rowid=t.p.records+1;}
var cna=t.p.altRows===true?(t.rows.length-1)%2==0?cn:"":"";}
if(ni){prp=t.formatCol(ni,1);row+="<td role=\"gridcell\" class=\"ui-state-default jqgrid-rownum\" "+prp+">0</td>";}
if(gi){v="<input type=\"checkbox\""+" id=\"jqg_"+rowid+"\" class=\"cbox\"/>";prp=t.formatCol(ni,1);row+="<td role=\"gridcell\" "+prp+">"+v+"</td>";}
if(si){row+=$(t).jqGrid("addSubGridCell",gi+ni,1);}
for(i=gi+si+ni;i<this.p.colModel.length;i++){nm=this.p.colModel[i].name;v=t.formatter(rowid,data[nm],i,data,'add');prp=t.formatCol(i,1);row+="<td role=\"gridcell\" "+prp+" title=\""+$.jgrid.stripHtml(v)+"\">"+v+"</td>";}
row="<tr id=\""+rowid+"\" role=\"row\" class=\"ui-widget-content jqgrow ui-row-"+t.p.direction+" "+cna+"\">"+row+"</tr>";if(t.p.subGrid===true){row=$(row)[0];$(t).jqGrid("addSubGrid",row,gi+ni);}
if(t.rows.length===0){$("table:first",t.grid.bDiv).append(row);}else{switch(pos){case'last':$(t.rows[t.rows.length-1]).after(row);break;case'first':$(t.rows[0]).before(row);break;case'after':sind=t.rows.namedItem(src);if(sind){$(t.rows[sind.rowIndex+1]).hasClass("ui-subgrid")?$(t.rows[sind.rowIndex+1]).after(row):$(sind).after(row);}
break;case'before':sind=t.rows.namedItem(src);if(sind){$(sind).before(row);sind=sind.rowIndex;}
break;}}
t.p.records++;t.p.reccount++;if(!t.grid.cols||!t.grid.cols.length)t.grid.cols=t.rows[0].cells;if(pos==='first'||(pos==='before'&&sind<=1)||t.rows.length===1){t.updateColumns();}
if(air)t.p.afterInsertRow(t,rowid,data);k++;}
if(t.p.altRows===true&&!aradd){if(pos=="last"){if((t.rows.length-1)%2==1){$(t.rows[t.rows.length-1]).addClass(cn);}}else{$(t.rows).each(function(i){if(i%2==1)$(this).addClass(cn);else $(this).removeClass(cn);});}}
t.updatepager(true,true);success=true;});}
return success;},footerData:function(action,data,format){var nm,success=false,res={};function isEmpty(obj){for(var i in obj){return false;}return true;}
if(typeof(action)=="undefined")action="get";if(typeof(format)!="boolean")format=true;action=action.toLowerCase();this.each(function(){var t=this,vl,ind;if(!t.grid||!t.p.footerrow){return false;}
if(action=="set"){if(isEmpty(data))return false;}
success=true;$(this.p.colModel).each(function(i){nm=this.name;if(action=="set"){if(data[nm]!=undefined){vl=format?t.formatter("",data[nm],i,data,'edit'):data[nm];$("tr.footrow td:eq("+i+")",t.grid.sDiv).html(vl).attr("title",$.jgrid.stripHtml(vl));success=true;}}else if(action=="get"){res[nm]=$("tr.footrow td:eq("+i+")",t.grid.sDiv).html();}});});return action=="get"?res:success;},ShowHideCol:function(colname,show){return this.each(function(){var $t=this,fndh=false;if(!$t.grid){return;}
if(typeof colname==='string'){colname=[colname];}
show=show!="none"?"":"none";var sw=show==""?true:false;$(this.p.colModel).each(function(i){if($.inArray(this.name,colname)!==-1&&this.hidden===sw){$("tr",$t.grid.hDiv).each(function(){$("th:eq("+i+")",this).css("display",show);});$($t.rows).each(function(j){$("td:eq("+i+")",$t.rows[j]).css("display",show);});if($t.p.footerrow)$("td:eq("+i+")",$t.grid.sDiv).css("display",show);if(show=="none")$t.p.tblwidth-=this.width;else $t.p.tblwidth+=this.width;this.hidden=!sw;fndh=true;}});if(fndh===true){$("table:first",$t.grid.hDiv).width($t.p.tblwidth);$("table:first",$t.grid.bDiv).width($t.p.tblwidth);$t.grid.hDiv.scrollLeft=$t.grid.bDiv.scrollLeft;if($t.p.footerrow){$("table:first",$t.grid.sDiv).width($t.p.tblwidth);$t.grid.sDiv.scrollLeft=$t.grid.bDiv.scrollLeft;}}});},hideCol:function(colname){return this.each(function(){$(this).jqGrid("ShowHideCol",colname,"none");});},showCol:function(colname){return this.each(function(){$(this).jqGrid("ShowHideCol",colname,"");});},remapColumns:function(permutation,updateCells,keepHeader)
{function resortArray(a){var ac;if(a.length){ac=$.makeArray(a);}else{ac=$.extend({},a);}
$.each(permutation,function(i){a[i]=ac[this];});}
var ts=this.get(0);function resortRows(parent,clobj){$(">tr"+(clobj||""),parent).each(function(){var row=this;var elems=$.makeArray(row.cells);$.each(permutation,function(){var e=elems[this];if(e){row.appendChild(e);}});});}
resortArray(ts.p.colModel);resortArray(ts.p.colNames);resortArray(ts.grid.headers);resortRows($("thead:first",ts.grid.hDiv),keepHeader&&":not(.ui-jqgrid-labels)");if(updateCells){resortRows($("tbody:first",ts.grid.bDiv),".jqgrow");}
if(ts.p.footerrow){resortRows($("tbody:first",ts.grid.sDiv));}
if(ts.p.remapColumns){if(!ts.p.remapColumns.length)
ts.p.remapColumns=$.makeArray(permutation);else
resortArray(ts.p.remapColumns);}
ts.p.lastsort=$.inArray(ts.p.lastsort,permutation);if(ts.p.treeGrid)ts.p.expColInd=$.inArray(ts.p.expColInd,permutation);},setGridWidth:function(nwidth,shrink){return this.each(function(){var $t=this,cw,initwidth=0,brd=$t.p.cellLayout,lvc,vc=0,hs=false,scw=$t.p.scrollOffset,aw,gw=0,tw=0,cl=0,cr;if(!$t.grid){return;}
if(typeof shrink!='boolean'){shrink=$t.p.shrinkToFit;}
if(isNaN(nwidth)){return;}
else{nwidth=parseInt(nwidth,10);$t.grid.width=$t.p.width=nwidth;}
$("#gbox_"+$t.p.id).css("width",nwidth+"px");$("#gview_"+$t.p.id).css("width",nwidth+"px");$($t.grid.bDiv).css("width",nwidth+"px");$($t.grid.hDiv).css("width",nwidth+"px");if($t.p.pager){$($t.p.pager).css("width",nwidth+"px");}
if($t.p.toolbar[0]===true){$($t.grid.uDiv).css("width",nwidth+"px");if($t.p.toolbar[1]=="both"){$($t.grid.ubDiv).css("width",nwidth+"px");}}
if($t.p.footerrow)$($t.grid.sDiv).css("width",nwidth+"px");if(shrink===false&&$t.p.forceFit==true){$t.p.forceFit=false;}
if(shrink===true){if($.browser.safari){brd=0;}
$.each($t.p.colModel,function(i){if(this.hidden===false){initwidth+=parseInt(this.width,10);if(this.fixed){tw+=this.width;gw+=this.width+brd;}else{vc++;}
cl++;}});if(vc==0)return;$t.p.tblwidth=initwidth;aw=nwidth-brd*vc-gw;if(!isNaN($t.p.height)){if($($t.grid.bDiv)[0].clientHeight<$($t.grid.bDiv)[0].scrollHeight){hs=true;aw-=scw;}}
initwidth=0;var cle=$t.grid.cols.length>0;$.each($t.p.colModel,function(i){var tn=this.name;if(this.hidden===false&&!this.fixed){cw=Math.floor((aw)/($t.p.tblwidth-tw)*this.width);this.width=cw;initwidth+=cw;$t.grid.headers[i].width=cw;$t.grid.headers[i].el.style.width=cw+"px";if($t.p.footerrow)$t.grid.footers[i].style.width=cw+"px";if(cle)$t.grid.cols[i].style.width=cw+"px";lvc=i;}});cr=0;if(hs){if(nwidth-gw-(initwidth+brd*vc)!==scw)
cr=nwidth-gw-(initwidth+brd*vc)-scw;}else if(Math.abs(nwidth-gw-(initwidth+brd*vc))!==1){cr=nwidth-gw-(initwidth+brd*vc);}
$t.p.colModel[lvc].width+=cr;cw=$t.p.colModel[lvc].width;$t.grid.headers[lvc].width=cw;$t.grid.headers[lvc].el.style.width=cw+"px";if(cle)$t.grid.cols[lvc].style.width=cw+"px";$t.p.tblwidth=initwidth+cr+tw+brd*cl;$('table:first',$t.grid.bDiv).css("width",$t.p.tblwidth+"px");$('table:first',$t.grid.hDiv).css("width",$t.p.tblwidth+"px");$t.grid.hDiv.scrollLeft=$t.grid.bDiv.scrollLeft;if($t.p.footerrow){$t.grid.footers[lvc].style.width=cw+"px";$('table:first',$t.grid.sDiv).css("width",$t.p.tblwidth+"px");}}});},setGridHeight:function(nh){return this.each(function(){var $t=this;if(!$t.grid){return;}
$($t.grid.bDiv).css({height:nh+(isNaN(nh)?"":"px")});$t.p.height=nh;if($t.p.scroll)$t.grid.populateVisible();});},setCaption:function(newcap){return this.each(function(){this.p.caption=newcap;$("span.ui-jqgrid-title",this.grid.cDiv).html(newcap);$(this.grid.cDiv).show();});},setLabel:function(colname,nData,prop,attrp){return this.each(function(){var $t=this,pos=-1;if(!$t.grid){return;}
if(isNaN(colname)){$($t.p.colModel).each(function(i){if(this.name==colname){pos=i;return false;}});}else{pos=parseInt(colname,10);}
if(pos>=0){var thecol=$("tr.ui-jqgrid-labels th:eq("+pos+")",$t.grid.hDiv);if(nData){var ico=$(".s-ico",thecol);$("[id^=jqgh_]",thecol).empty().html(nData).append(ico);$t.p.colNames[pos]=nData;}
if(prop){if(typeof prop==='string'){$(thecol).addClass(prop);}else{$(thecol).css(prop);}}
if(typeof attrp==='object'){$(thecol).attr(attrp);}}});},setCell:function(rowid,colname,nData,cssp,attrp){return this.each(function(){var $t=this,pos=-1,v;if(!$t.grid){return;}
if(isNaN(colname)){$($t.p.colModel).each(function(i){if(this.name==colname){pos=i;return false;}});}else{pos=parseInt(colname,10);}
if(pos>=0){var ind=$t.rows.namedItem(rowid);if(ind){var tcell=$("td:eq("+pos+")",ind);if(nData!==""){v=$t.formatter(rowid,nData,pos,ind,'edit');if($t.p.treeGrid&&$(".tree-wrap",$(tcell)).length>0)
$("span",$(tcell)).html(v).attr("title",$.jgrid.stripHtml(v));else
$(tcell).html(v).attr("title",$.jgrid.stripHtml(v));}
if(typeof cssp==='string'){if(cssp){$(tcell).addClass(cssp);}
else{$(tcell).removeClass();}}else if(cssp){$(tcell).css(cssp);}
if(typeof attrp==='object'){$(tcell).attr(attrp);}}}});},getCell:function(rowid,col){var ret=false;this.each(function(){var $t=this,pos=-1;if(!$t.grid){return;}
if(isNaN(col)){$($t.p.colModel).each(function(i){if(this.name===col){pos=i;return false;}});}else{pos=parseInt(col,10);}
if(pos>=0){var ind=$t.rows.namedItem(rowid);if(ind){try{ret=$.unformat($("td:eq("+pos+")",ind),{rowId:ind.id,colModel:$t.p.colModel[pos]},pos);}catch(e){ret=$.jgrid.htmlDecode($("td:eq("+pos+")",ind).html());}}}});return ret;},getCol:function(col,obj,mathopr){var ret=[],val,sum=0;obj=typeof(obj)!='boolean'?false:obj;if(typeof mathopr=='undefined')mathopr=false;this.each(function(){var $t=this,pos=-1;if(!$t.grid){return;}
if(isNaN(col)){$($t.p.colModel).each(function(i){if(this.name===col){pos=i;return false;}});}else{pos=parseInt(col,10);}
if(pos>=0){var ln=$t.rows.length,i=0;if(ln&&ln>0){while(i<ln){try{val=$.unformat($($t.rows[i].cells[pos]),{rowId:$t.rows[i].id,colModel:$t.p.colModel[pos]},pos);}catch(e){val=$.jgrid.htmlDecode($t.rows[i].cells[pos].innerHTML);}
mathopr?sum+=parseFloat(val):obj?ret.push({id:$t.rows[i].id,value:val}):ret[i]=val;i++;}
if(mathopr){switch(mathopr.toLowerCase()){case'sum':ret=sum;break;case'avg':ret=sum/ln;break;case'count':ret=ln;break;}}}}});return ret;},clearGridData:function(clearfooter){return this.each(function(){var $t=this;if(!$t.grid){return;}
if(typeof clearfooter!='boolean')clearfooter=false;$("tbody:first tr",$t.grid.bDiv).remove();if($t.p.footerrow&&clearfooter)$(".ui-jqgrid-ftable td",$t.grid.sDiv).html("&#160;");$t.p.selrow=null;$t.p.selarrrow=[];$t.p.savedRow=[];$t.p.records=0;$t.p.page='0';$t.p.lastpage='0';$t.p.reccount=0;$t.updatepager(true,false);});},getInd:function(rowid,rc){var ret=false,rw;this.each(function(){rw=this.rows.namedItem(rowid);if(rw){ret=rc===true?rw:rw.rowIndex;}});return ret;}});})(jQuery);;(function($){$.fmatter={};$.fn.fmatter=function(formatType,cellval,opts,rwd,act){opts=$.extend({},$.jgrid.formatter,opts);return fireFormatter(formatType,cellval,opts,rwd,act);};$.fmatter.util={NumberFormat:function(nData,opts){if(!isNumber(nData)){nData*=1;}
if(isNumber(nData)){var bNegative=(nData<0);var sOutput=nData+"";var sDecimalSeparator=(opts.decimalSeparator)?opts.decimalSeparator:".";var nDotIndex;if(isNumber(opts.decimalPlaces)){var nDecimalPlaces=opts.decimalPlaces;var nDecimal=Math.pow(10,nDecimalPlaces);sOutput=Math.round(nData*nDecimal)/nDecimal+"";nDotIndex=sOutput.lastIndexOf(".");if(nDecimalPlaces>0){if(nDotIndex<0){sOutput+=sDecimalSeparator;nDotIndex=sOutput.length-1;}
else if(sDecimalSeparator!=="."){sOutput=sOutput.replace(".",sDecimalSeparator);}
while((sOutput.length-1-nDotIndex)<nDecimalPlaces){sOutput+="0";}}}
if(opts.thousandsSeparator){var sThousandsSeparator=opts.thousandsSeparator;nDotIndex=sOutput.lastIndexOf(sDecimalSeparator);nDotIndex=(nDotIndex>-1)?nDotIndex:sOutput.length;var sNewOutput=sOutput.substring(nDotIndex);var nCount=-1;for(var i=nDotIndex;i>0;i--){nCount++;if((nCount%3===0)&&(i!==nDotIndex)&&(!bNegative||(i>1))){sNewOutput=sThousandsSeparator+sNewOutput;}
sNewOutput=sOutput.charAt(i-1)+sNewOutput;}
sOutput=sNewOutput;}
sOutput=(opts.prefix)?opts.prefix+sOutput:sOutput;sOutput=(opts.suffix)?sOutput+opts.suffix:sOutput;return sOutput;}else{return nData;}},DateFormat:function(format,date,newformat,opts){var token=/\\.|[dDjlNSwzWFmMntLoYyaABgGhHisueIOPTZcrU]/g,timezone=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,timezoneClip=/[^-+\dA-Z]/g,pad=function(value,length){value=String(value);length=parseInt(length)||2;while(value.length<length)value='0'+value;return value;},ts={m:1,d:1,y:1970,h:0,i:0,s:0},timestamp=0,dM,k,hl,dateFormat=["i18n"];dateFormat["i18n"]={dayNames:opts.dayNames,monthNames:opts.monthNames};if(format in opts.masks)format=opts.masks[format];date=date.split(/[\\\/:_;.\t\T\s-]/);format=format.split(/[\\\/:_;.\t\T\s-]/);for(k=0,hl=format.length;k<hl;k++){if(format[k]=='M'){dM=$.inArray(date[k],dateFormat.i18n.monthNames);if(dM!==-1&&dM<12){date[k]=dM+1;}}
if(format[k]=='F'){dM=$.inArray(date[k],dateFormat.i18n.monthNames);if(dM!==-1&&dM>11){date[k]=dM+1-12;}}
ts[format[k].toLowerCase()]=parseInt(date[k],10);}
ts.m=parseInt(ts.m)-1;var ty=ts.y;if(ty>=70&&ty<=99)ts.y=1900+ts.y;else if(ty>=0&&ty<=69)ts.y=2000+ts.y;timestamp=new Date(ts.y,ts.m,ts.d,ts.h,ts.i,ts.s,0);if(newformat in opts.masks){newformat=opts.masks[newformat];}else if(!newformat){newformat='Y-m-d';}
var
G=timestamp.getHours(),i=timestamp.getMinutes(),j=timestamp.getDate(),n=timestamp.getMonth()+1,o=timestamp.getTimezoneOffset(),s=timestamp.getSeconds(),u=timestamp.getMilliseconds(),w=timestamp.getDay(),Y=timestamp.getFullYear(),N=(w+6)%7+1,z=(new Date(Y,n-1,j)-new Date(Y,0,1))/86400000,flags={d:pad(j),D:dateFormat.i18n.dayNames[w],j:j,l:dateFormat.i18n.dayNames[w+7],N:N,S:opts.S(j),w:w,z:z,W:N<5?Math.floor((z+N-1)/7)+1:Math.floor((z+N-1)/7)||((new Date(Y-1,0,1).getDay()+6)%7<4?53:52),F:dateFormat.i18n.monthNames[n-1+12],m:pad(n),M:dateFormat.i18n.monthNames[n-1],n:n,t:'?',L:'?',o:'?',Y:Y,y:String(Y).substring(2),a:G<12?opts.AmPm[0]:opts.AmPm[1],A:G<12?opts.AmPm[2]:opts.AmPm[3],B:'?',g:G%12||12,G:G,h:pad(G%12||12),H:pad(G),i:pad(i),s:pad(s),u:u,e:'?',I:'?',O:(o>0?"-":"+")+pad(Math.floor(Math.abs(o)/60)*100+Math.abs(o)%60,4),P:'?',T:(String(timestamp).match(timezone)||[""]).pop().replace(timezoneClip,""),Z:'?',c:'?',r:'?',U:Math.floor(timestamp/1000)};return newformat.replace(token,function($0){return $0 in flags?flags[$0]:$0.substring(1);});}};$.fn.fmatter.defaultFormat=function(cellval,opts){return(isValue(cellval)&&cellval!=="")?cellval:opts.defaultValue?opts.defaultValue:"&#160;";};$.fn.fmatter.email=function(cellval,opts){if(!isEmpty(cellval)){return"<a href=\"mailto:"+cellval+"\">"+cellval+"</a>";}else{return $.fn.fmatter.defaultFormat(cellval,opts);}};$.fn.fmatter.checkbox=function(cval,opts){var op=$.extend({},opts.checkbox),ds;if(!isUndefined(opts.colModel.formatoptions)){op=$.extend({},op,opts.colModel.formatoptions);}
if(op.disabled===true){ds="disabled";}else{ds="";}
if(isEmpty(cval)||isUndefined(cval))cval=$.fn.fmatter.defaultFormat(cval,op);cval=cval+"";cval=cval.toLowerCase();var bchk=cval.search(/(false|0|no|off)/i)<0?" checked='checked' ":"";return"<input type=\"checkbox\" "+bchk+" value=\""+cval+"\" offval=\"no\" "+ds+"/>";},$.fn.fmatter.link=function(cellval,opts){var op={target:opts.target};var target="";if(!isUndefined(opts.colModel.formatoptions)){op=$.extend({},op,opts.colModel.formatoptions);}
if(op.target){target='target='+op.target;}
if(!isEmpty(cellval)){return"<a "+target+" href=\""+cellval+"\">"+cellval+"</a>";}else{return $.fn.fmatter.defaultFormat(cellval,opts);}};$.fn.fmatter.showlink=function(cellval,opts){var op={baseLinkUrl:opts.baseLinkUrl,showAction:opts.showAction,addParam:opts.addParam||"",target:opts.target,idName:opts.idName},target="";if(!isUndefined(opts.colModel.formatoptions)){op=$.extend({},op,opts.colModel.formatoptions);}
if(op.target){target='target='+op.target;}
idUrl=op.baseLinkUrl+op.showAction+'?'+op.idName+'='+opts.rowId+op.addParam;if(isString(cellval)){return"<a "+target+" href=\""+idUrl+"\">"+cellval+"</a>";}else{return $.fn.fmatter.defaultFormat(cellval,opts);}};$.fn.fmatter.integer=function(cellval,opts){var op=$.extend({},opts.integer);if(!isUndefined(opts.colModel.formatoptions)){op=$.extend({},op,opts.colModel.formatoptions);}
if(isEmpty(cellval)){return op.defaultValue;}
return $.fmatter.util.NumberFormat(cellval,op);};$.fn.fmatter.number=function(cellval,opts){var op=$.extend({},opts.number);if(!isUndefined(opts.colModel.formatoptions)){op=$.extend({},op,opts.colModel.formatoptions);}
if(isEmpty(cellval)){return op.defaultValue;}
return $.fmatter.util.NumberFormat(cellval,op);};$.fn.fmatter.currency=function(cellval,opts){var op=$.extend({},opts.currency);if(!isUndefined(opts.colModel.formatoptions)){op=$.extend({},op,opts.colModel.formatoptions);}
if(isEmpty(cellval)){return op.defaultValue;}
return $.fmatter.util.NumberFormat(cellval,op);};$.fn.fmatter.date=function(cellval,opts,rwd,act){var op=$.extend({},opts.date);if(!isUndefined(opts.colModel.formatoptions)){op=$.extend({},op,opts.colModel.formatoptions);}
if(!op.reformatAfterEdit&&act=='edit'){return $.fn.fmatter.defaultFormat(cellval,opts);}else if(!isEmpty(cellval)){return $.fmatter.util.DateFormat(op.srcformat,cellval,op.newformat,op);}else{return $.fn.fmatter.defaultFormat(cellval,opts);}};$.fn.fmatter.select=function(cellval,opts,rwd,act){cellval=cellval+"";var oSelect=false,ret=[];if(!isUndefined(opts.colModel.editoptions)){oSelect=opts.colModel.editoptions.value;}
if(oSelect){var msl=opts.colModel.editoptions.multiple===true?true:false,scell=[],sv;if(msl){scell=cellval.split(",");scell=$.map(scell,function(n){return $.trim(n);})}
if(isString(oSelect)){var so=oSelect.split(";"),j=0;for(var i=0;i<so.length;i++){sv=so[i].split(":");if(sv.length>2){sv[1]=jQuery.map(sv,function(n,i){if(i>0)return n;}).join(":");}
if(msl){if(jQuery.inArray(sv[0],scell)>-1){ret[j]=sv[1];j++;}}else if($.trim(sv[0])==$.trim(cellval)){ret[0]=sv[1];break;}}}else if(isObject(oSelect)){if(msl){ret=jQuery.map(scell,function(n,i){return oSelect[n];});}else{ret[0]=oSelect[cellval]||"";}}}
cellval=ret.join(", ");return cellval==""?$.fn.fmatter.defaultFormat(cellval,opts):cellval;};$.fn.fmatter.rowactions=function(rid,gid,act,keys){switch(act)
{case'edit':var restorerow=function(){$(".ui-inline-edit, .ui-inline-del","#"+rid).show();$(".ui-inline-save, .ui-inline-cancel","#"+rid).hide();}
$('#'+gid).jqGrid('editRow',rid,keys,null,null,null,{oper:'edit'},restorerow,null,restorerow);$(".ui-inline-edit, .ui-inline-del","#"+rid).hide();$(".ui-inline-save, .ui-inline-cancel","#"+rid).show();break;case'save':$('#'+gid).jqGrid('saveRow',rid,null,null,{oper:'edit'});$(".ui-inline-edit, .ui-inline-del","#"+rid).show();$(".ui-inline-save, .ui-inline-cancel","#"+rid).hide();break;case'cancel':$('#'+gid).jqGrid('restoreRow',rid);$(".ui-inline-edit, .ui-inline-del","#"+rid).show();$(".ui-inline-save, .ui-inline-cancel","#"+rid).hide();break;}};$.fn.fmatter.actions=function(cellval,opts,rwd){var op={keys:false};if(!isUndefined(opts.colModel.formatoptions)){op=$.extend(op,opts.colModel.formatoptions);}
var rowid=opts.rowId;if(typeof(rowid)=='undefined'||isEmpty(rowid))return"";var ocl="onclick=$.fn.fmatter.rowactions('"+rowid+"','"+opts.gid+"','edit',"+op.keys+");"
var str="<div style='margin-left:8px;'><div title='"+$.jgrid.nav.edittitle+"' style='float:left;cursor:pointer;' class='ui-pg-div ui-inline-edit' "+ocl+"><span class='ui-icon ui-icon-pencil'></span></div>";ocl="onclick=jQuery('#"+opts.gid+"').jqGrid('delGridRow','"+rowid+"');"
str=str+"<div title='"+$.jgrid.nav.deltitle+"' style='float:left;margin-left:5px;' class='ui-pg-div ui-inline-del' "+ocl+"><span class='ui-icon ui-icon-trash'></span></div>";ocl="onclick=$.fn.fmatter.rowactions('"+rowid+"','"+opts.gid+"','save',false);"
str=str+"<div title='"+$.jgrid.edit.bSubmit+"' style='float:left;display:none' class='ui-pg-div ui-inline-save'><span class='ui-icon ui-icon-disk' "+ocl+"></span></div>";ocl="onclick=$.fn.fmatter.rowactions('"+rowid+"','"+opts.gid+"','cancel',false);"
str=str+"<div title='"+$.jgrid.edit.bCancel+"' style='float:left;display:none;margin-left:5px;' class='ui-pg-div ui-inline-cancel'><span class='ui-icon ui-icon-cancel' "+ocl+"></span></div></div>";return str;};$.unformat=function(cellval,options,pos,cnt){var ret,formatType=options.colModel.formatter,op=options.colModel.formatoptions||{},sep,re=/([\.\*\_\'\(\)\{\}\+\?\\])/g;unformatFunc=options.colModel.unformat||($.fn.fmatter[formatType]&&$.fn.fmatter[formatType].unformat);if(typeof unformatFunc!=='undefined'&&isFunction(unformatFunc)){ret=unformatFunc($(cellval).text(),options,cellval);}else if(typeof formatType!=='undefined'&&isString(formatType)){var opts=$.jgrid.formatter||{},stripTag;switch(formatType){case'integer':op=$.extend({},opts.integer,op);sep=op.thousandsSeparator.replace(re,"\\$1");stripTag=new RegExp(sep,"g");ret=$(cellval).text().replace(stripTag,'');break;case'number':op=$.extend({},opts.number,op);sep=op.thousandsSeparator.replace(re,"\\$1");stripTag=new RegExp(sep,"g");ret=$(cellval).text().replace(stripTag,"").replace(op.decimalSeparator,'.');break;case'currency':op=$.extend({},opts.currency,op);sep=op.thousandsSeparator.replace(re,"\\$1");stripTag=new RegExp(sep,"g");ret=$(cellval).text().replace(stripTag,'').replace(op.decimalSeparator,'.').replace(op.prefix,'').replace(op.suffix,'');break;case'checkbox':var cbv=(options.colModel.editoptions)?options.colModel.editoptions.value.split(":"):["Yes","No"];ret=$('input',cellval).attr("checked")?cbv[0]:cbv[1];break;case'select':ret=$.unformat.select(cellval,options,pos,cnt);break;case'actions':return"";default:ret=$(cellval).text();}}
return ret?ret:cnt===true?$(cellval).text():$.jgrid.htmlDecode($(cellval).html());};$.unformat.select=function(cellval,options,pos,cnt){var ret=[];var cell=$(cellval).text();if(cnt==true)return cell;var op=$.extend({},options.colModel.editoptions);if(op.value){var oSelect=op.value,msl=op.multiple===true?true:false,scell=[],sv;if(msl){scell=cell.split(",");scell=$.map(scell,function(n){return $.trim(n);})}
if(isString(oSelect)){var so=oSelect.split(";"),j=0;for(var i=0;i<so.length;i++){sv=so[i].split(":");if(msl){if(jQuery.inArray(sv[1],scell)>-1){ret[j]=sv[0];j++;}}else if($.trim(sv[1])==$.trim(cell)){ret[0]=sv[0];break;}}}else if(isObject(oSelect)){if(!msl)scell[0]=cell;ret=jQuery.map(scell,function(n){var rv;$.each(oSelect,function(i,val){if(val==n){rv=i;return false;}});if(rv)return rv;});}
return ret.join(", ");}else{return cell||"";}};function fireFormatter(formatType,cellval,opts,rwd,act){var v=cellval;if($.fn.fmatter[formatType]){v=$.fn.fmatter[formatType](cellval,opts,rwd,act);}
return v;};function debug($obj){if(window.console&&window.console.log)window.console.log($obj);};isValue=function(o){return(isObject(o)||isString(o)||isNumber(o)||isBoolean(o));};isBoolean=function(o){return typeof o==='boolean';};isNull=function(o){return o===null;};isNumber=function(o){return typeof o==='number'&&isFinite(o);};isString=function(o){return typeof o==='string';};isEmpty=function(o){if(!isString(o)&&isValue(o)){return false;}else if(!isValue(o)){return true;}
o=$.trim(o).replace(/\&nbsp\;/ig,'').replace(/\&#160\;/ig,'');return o==="";};isUndefined=function(o){return typeof o==='undefined';};isObject=function(o){return(o&&(typeof o==='object'||isFunction(o)))||false;};isFunction=function(o){return typeof o==='function';};})(jQuery);;(function($){$.jgrid.extend({getColProp:function(colname){var ret={},$t=this[0];if(!$t.grid){return;}
var cM=$t.p.colModel;for(var i=0;i<cM.length;i++){if(cM[i].name==colname){ret=cM[i];break;}}
return ret;},setColProp:function(colname,obj){return this.each(function(){if(this.grid){if(obj){var cM=this.p.colModel;for(var i=0;i<cM.length;i++){if(cM[i].name==colname){$.extend(this.p.colModel[i],obj);break;}}}}});},sortGrid:function(colname,reload,sor){return this.each(function(){var $t=this,idx=-1;if(!$t.grid){return;}
if(!colname){colname=$t.p.sortname;}
for(var i=0;i<$t.p.colModel.length;i++){if($t.p.colModel[i].index==colname||$t.p.colModel[i].name==colname){idx=i;break;}}
if(idx!=-1){var sort=$t.p.colModel[idx].sortable;if(typeof sort!=='boolean'){sort=true;}
if(typeof reload!=='boolean'){reload=false;}
if(sort){$t.sortData("jqgh_"+colname,idx,reload,sor);}}});},GridDestroy:function(){return this.each(function(){if(this.grid){if(this.p.pager){$(this.p.pager).remove();}
var gid=this.id;try{$("#gbox_"+gid).remove();}catch(_){}}});},GridUnload:function(){return this.each(function(){if(!this.grid){return;}
var defgrid={id:$(this).attr('id'),cl:$(this).attr('class')};if(this.p.pager){$(this.p.pager).empty().removeClass("ui-state-default ui-jqgrid-pager corner-bottom");}
var newtable=document.createElement('table');$(newtable).attr({id:defgrid['id']});newtable.className=defgrid['cl'];var gid=this.id;$(newtable).removeClass("ui-jqgrid-btable");if($(this.p.pager).parents("#gbox_"+gid).length===1){$(newtable).insertBefore("#gbox_"+gid).show();$(this.p.pager).insertBefore("#gbox_"+gid);}else{$(newtable).insertBefore("#gbox_"+gid).show();}
$("#gbox_"+gid).remove();});},setGridState:function(state){return this.each(function(){if(!this.grid){return;}
$t=this;if(state=='hidden'){$(".ui-jqgrid-bdiv, .ui-jqgrid-hdiv","#gview_"+$t.p.id).slideUp("fast");if($t.p.pager){$($t.p.pager).slideUp("fast");}
if($t.p.toolbar[0]===true){if($t.p.toolbar[1]=='both'){$($t.grid.ubDiv).slideUp("fast");}
$($t.grid.uDiv).slideUp("fast");}
if($t.p.footerrow)$(".ui-jqgrid-sdiv","#gbox_"+$s.p.id).slideUp("fast");$(".ui-jqgrid-titlebar-close span",$t.grid.cDiv).removeClass("ui-icon-circle-triangle-n").addClass("ui-icon-circle-triangle-s");$t.p.gridstate='hidden';}else if(state=='visible'){$(".ui-jqgrid-hdiv, .ui-jqgrid-bdiv","#gview_"+$t.p.id).slideDown("fast");if($t.p.pager){$($t.p.pager).slideDown("fast");}
if($t.p.toolbar[0]===true){if($t.p.toolbar[1]=='both'){$($t.grid.ubDiv).slideDown("fast");}
$($t.grid.uDiv).slideDown("fast");}
if($t.p.footerrow)$(".ui-jqgrid-sdiv","#gbox_"+$t.p.id).slideDown("fast");$(".ui-jqgrid-titlebar-close span",$t.grid.cDiv).removeClass("ui-icon-circle-triangle-s").addClass("ui-icon-circle-triangle-n");$t.p.gridstate='visible';}});},updateGridRows:function(data,rowidname,jsonreader){var nm,success=false;this.each(function(){var t=this,vl,ind,srow,sid;if(!t.grid){return false;}
if(!rowidname)rowidname="id";if(data&&data.length>0){$(data).each(function(j){srow=this;ind=t.rows.namedItem(srow[rowidname]);if(ind){sid=srow[rowidname];if(jsonreader===true){if(t.p.jsonReader.repeatitems===true){if(t.p.jsonReader.cell){srow=srow[t.p.jsonReader.cell];}
for(var k=0;k<srow.length;k++){vl=t.formatter(sid,srow[k],k,srow,'edit');if(t.p.treeGrid===true&&nm==t.p.ExpandColumn){$("td:eq("+k+") > span:first",ind).html(vl).attr("title",$.jgrid.stripHtml(vl));}else{$("td:eq("+k+")",ind).html(vl).attr("title",$.jgrid.stripHtml(vl));}}
success=true;return true;}}
$(t.p.colModel).each(function(i){nm=jsonreader===true?this.jsonmap||this.name:this.name;if(srow[nm]!=undefined){vl=t.formatter(sid,srow[nm],i,srow,'edit');if(t.p.treeGrid===true&&nm==t.p.ExpandColumn){$("td:eq("+i+") > span:first",ind).html(vl).attr("title",$.jgrid.stripHtml(vl));}else{$("td:eq("+i+")",ind).html(vl).attr("title",$.jgrid.stripHtml(vl));}
success=true;}});}});}});return success;},filterGrid:function(gridid,p){p=$.extend({gridModel:false,gridNames:false,gridToolbar:false,filterModel:[],formtype:"horizontal",autosearch:true,formclass:"filterform",tableclass:"filtertable",buttonclass:"filterbutton",searchButton:"Search",clearButton:"Clear",enableSearch:false,enableClear:false,beforeSearch:null,afterSearch:null,beforeClear:null,afterClear:null,url:'',marksearched:true},p||{});return this.each(function(){var self=this;this.p=p;if(this.p.filterModel.length==0&&this.p.gridModel===false){alert("No filter is set");return;}
if(!gridid){alert("No target grid is set!");return;}
this.p.gridid=gridid.indexOf("#")!=-1?gridid:"#"+gridid;var gcolMod=$(this.p.gridid).jqGrid("getGridParam",'colModel');if(gcolMod){if(this.p.gridModel===true){var thegrid=$(this.p.gridid)[0];var sh;$.each(gcolMod,function(i,n){var tmpFil=[];this.search=this.search===false?false:true;if(this.editrules&&this.editrules.searchhidden===true){sh=true;}else{if(this.hidden===true){sh=false;}else{sh=true;}}
if(this.search===true&&sh===true){if(self.p.gridNames===true){tmpFil.label=thegrid.p.colNames[i];}else{tmpFil.label='';}
tmpFil.name=this.name;tmpFil.index=this.index||this.name;tmpFil.stype=this.edittype||'text';if(tmpFil.stype!='select'){tmpFil.stype='text';}
tmpFil.defval=this.defval||'';tmpFil.surl=this.surl||'';tmpFil.sopt=this.editoptions||{};tmpFil.width=this.width;self.p.filterModel.push(tmpFil);}});}else{$.each(self.p.filterModel,function(i,n){for(var j=0;j<gcolMod.length;j++){if(this.name==gcolMod[j].name){this.index=gcolMod[j].index||this.name;break;}}
if(!this.index){this.index=this.name;}});}}else{alert("Could not get grid colModel");return;}
var triggerSearch=function(){var sdata={},j=0,v;var gr=$(self.p.gridid)[0],nm;gr.p.searchdata={};if($.isFunction(self.p.beforeSearch)){self.p.beforeSearch();}
$.each(self.p.filterModel,function(i,n){nm=this.index;switch(this.stype){case'select':v=$("select[name="+nm+"]",self).val();if(v){sdata[nm]=v;if(self.p.marksearched){$("#jqgh_"+this.name,gr.grid.hDiv).addClass("dirty-cell");}
j++;}else{if(self.p.marksearched){$("#jqgh_"+this.name,gr.grid.hDiv).removeClass("dirty-cell");}
try{delete gr.p.postData[this.index];}catch(e){}}
break;default:v=$("input[name="+nm+"]",self).val();if(v){sdata[nm]=v;if(self.p.marksearched){$("#jqgh_"+this.name,gr.grid.hDiv).addClass("dirty-cell");}
j++;}else{if(self.p.marksearched){$("#jqgh_"+this.name,gr.grid.hDiv).removeClass("dirty-cell");}
try{delete gr.p.postData[this.index];}catch(e){}}}});var sd=j>0?true:false;$.extend(gr.p.postData,sdata);var saveurl;if(self.p.url){saveurl=$(gr).jqGrid("getGridParam",'url');$(gr).jqGrid("setGridParam",{url:self.p.url});}
$(gr).jqGrid("setGridParam",{search:sd}).trigger("reloadGrid",[{page:1}]);if(saveurl){$(gr).jqGrid("setGridParam",{url:saveurl});}
if($.isFunction(self.p.afterSearch)){self.p.afterSearch();}};var clearSearch=function(){var sdata={},v,j=0;var gr=$(self.p.gridid)[0],nm;if($.isFunction(self.p.beforeClear)){self.p.beforeClear();}
$.each(self.p.filterModel,function(i,n){nm=this.index;v=(this.defval)?this.defval:"";if(!this.stype){this.stype='text';}
switch(this.stype){case'select':var v1;$("select[name="+nm+"] option",self).each(function(i){if(i==0)this.selected=true;if($(this).text()==v){this.selected=true;v1=$(this).val();return false;}});if(v1){sdata[nm]=v1;if(self.p.marksearched){$("#jqgh_"+this.name,gr.grid.hDiv).addClass("dirty-cell");}
j++;}else{if(self.p.marksearched){$("#jqgh_"+this.name,gr.grid.hDiv).removeClass("dirty-cell");}
try{delete gr.p.postData[this.index];}catch(e){}}
break;case'text':$("input[name="+nm+"]",self).val(v);if(v){sdata[nm]=v;if(self.p.marksearched){$("#jqgh_"+this.name,gr.grid.hDiv).addClass("dirty-cell");}
j++;}else{if(self.p.marksearched){$("#jqgh_"+this.name,gr.grid.hDiv).removeClass("dirty-cell");}
try{delete gr.p.postData[this.index];}catch(e){}}
break;}});var sd=j>0?true:false;$.extend(gr.p.postData,sdata);var saveurl;if(self.p.url){saveurl=$(gr).jqGrid("getGridParam",'url');$(gr).jqGrid("setGridParam",{url:self.p.url});}
$(gr).jqGrid("setGridParam",{search:sd}).trigger("reloadGrid",[{page:1}]);if(saveurl){$(gr).jqGrid("setGridParam",{url:saveurl});}
if($.isFunction(self.p.afterClear)){self.p.afterClear();}};var formFill=function(){var tr=document.createElement("tr");var tr1,sb,cb,tl,td,td1;if(self.p.formtype=='horizontal'){$(tbl).append(tr);}
$.each(self.p.filterModel,function(i,n){tl=document.createElement("td");$(tl).append("<label for='"+this.name+"'>"+this.label+"</label>");td=document.createElement("td");var $t=this;if(!this.stype){this.stype='text';}
switch(this.stype)
{case"select":if(this.surl){$(td).load(this.surl,function(){if($t.defval)$("select",this).val($t.defval);$("select",this).attr({name:$t.index||$t.name,id:"sg_"+$t.name});if($t.sopt)$("select",this).attr($t.sopt);if(self.p.gridToolbar===true&&$t.width){$("select",this).width($t.width);}
if(self.p.autosearch===true){$("select",this).change(function(e){triggerSearch();return false;});}});}else{if($t.sopt.value){var oSv=$t.sopt.value;var elem=document.createElement("select");$(elem).attr({name:$t.index||$t.name,id:"sg_"+$t.name}).attr($t.sopt);if(typeof oSv==="string"){var so=oSv.split(";"),sv,ov;for(var k=0;k<so.length;k++){sv=so[k].split(":");ov=document.createElement("option");ov.value=sv[0];ov.innerHTML=sv[1];if(sv[1]==$t.defval)ov.selected="selected";elem.appendChild(ov);}}else if(typeof oSv==="object"){for(var key in oSv){i++;ov=document.createElement("option");ov.value=key;ov.innerHTML=oSv[key];if(oSv[key]==$t.defval)ov.selected="selected";elem.appendChild(ov);}}
if(self.p.gridToolbar===true&&$t.width){$(elem).width($t.width);}
$(td).append(elem);if(self.p.autosearch===true){$(elem).change(function(e){triggerSearch();return false;});}}}
break;case'text':var df=this.defval?this.defval:"";$(td).append("<input type='text' name='"+(this.index||this.name)+"' id='sg_"+this.name+"' value='"+df+"'/>");if($t.sopt)$("input",td).attr($t.sopt);if(self.p.gridToolbar===true&&$t.width){if($.browser.msie){$("input",td).width($t.width-4);}else{$("input",td).width($t.width-2);}}
if(self.p.autosearch===true){$("input",td).keypress(function(e){var key=e.charCode?e.charCode:e.keyCode?e.keyCode:0;if(key==13){triggerSearch();return false;}
return this;});}
break;}
if(self.p.formtype=='horizontal'){if(self.p.gridToolbar===true&&self.p.gridNames===false){$(tr).append(td);}else{$(tr).append(tl).append(td);}
$(tr).append(td);}else{tr1=document.createElement("tr");$(tr1).append(tl).append(td);$(tbl).append(tr1);}});td=document.createElement("td");if(self.p.enableSearch===true){sb="<input type='button' id='sButton' class='"+self.p.buttonclass+"' value='"+self.p.searchButton+"'/>";$(td).append(sb);$("input#sButton",td).click(function(){triggerSearch();return false;});}
if(self.p.enableClear===true){cb="<input type='button' id='cButton' class='"+self.p.buttonclass+"' value='"+self.p.clearButton+"'/>";$(td).append(cb);$("input#cButton",td).click(function(){clearSearch();return false;});}
if(self.p.enableClear===true||self.p.enableSearch===true){if(self.p.formtype=='horizontal'){$(tr).append(td);}else{tr1=document.createElement("tr");$(tr1).append("<td>&#160;</td>").append(td);$(tbl).append(tr1);}}};var frm=$("<form name='SearchForm' style=display:inline;' class='"+this.p.formclass+"'></form>");var tbl=$("<table class='"+this.p.tableclass+"' cellspacing='0' cellpading='0' border='0'><tbody></tbody></table>");$(frm).append(tbl);formFill();$(this).append(frm);this.triggerSearch=triggerSearch;this.clearSearch=clearSearch;});},filterToolbar:function(p){p=$.extend({autosearch:true,searchOnEnter:true,beforeSearch:null,afterSearch:null,beforeClear:null,afterClear:null,searchurl:'',stringResult:false,groupOp:'AND'},p||{});return this.each(function(){var $t=this;var triggerToolbar=function(){var sdata={},j=0,v,nm,sopt={};$.each($t.p.colModel,function(i,n){nm=this.index||this.name;var so=(this.searchoptions&&this.searchoptions.sopt)?this.searchoptions.sopt[0]:"bw";switch(this.stype){case'select':v=$("select[name="+nm+"]",$t.grid.hDiv).val();if(v){sdata[nm]=v;sopt[nm]=so;j++;}else{try{delete $t.p.postData[nm];}catch(e){}}
break;case'text':v=$("input[name="+nm+"]",$t.grid.hDiv).val();if(v){sdata[nm]=v;sopt[nm]=so;j++;}else{try{delete $t.p.postData[nm];}catch(e){}}
break;}});var sd=j>0?true:false;if(!p.stringResult){$.extend($t.p.postData,sdata);}else{var ruleGroup="{\"groupOp\":\""+p.groupOp+"\",\"rules\":[";var gi=0;$.each(sdata,function(i,n){if(gi>0)ruleGroup+=",";ruleGroup+="{\"field\":\""+i+"\",";ruleGroup+="\"op\":\""+sopt[i]+"\",";ruleGroup+="\"data\":\""+n+"\"}";gi++;});ruleGroup+="]}";$.extend($t.p.postData,{filters:ruleGroup});}
var saveurl;if($t.p.searchurl){saveurl=$t.p.url;$($t).jqGrid("setGridParam",{url:$t.p.searchurl});}
var bsr=false;if($.isFunction(p.beforeSearch)){bsr=p.beforeSearch.call($t);}
if(!bsr)$($t).jqGrid("setGridParam",{search:sd}).trigger("reloadGrid",[{page:1}]);if(saveurl){$($t).jqGrid("setGridParam",{url:saveurl});}
if($.isFunction(p.afterSearch)){p.afterSearch();}};var clearToolbar=function(trigger){var sdata={},v,j=0,nm;trigger=(typeof trigger!='boolean')?true:trigger;$.each($t.p.colModel,function(i,n){v=(this.searchoptions&&this.searchoptions.defaultValue)?this.searchoptions.defaultValue:"";nm=this.index||this.name;switch(this.stype){case'select':var v1;$("select[name="+nm+"] option",$t.grid.hDiv).each(function(i){if(i==0)this.selected=true;if($(this).text()==v){this.selected=true;v1=$(this).val();return false;}});if(v1){sdata[nm]=v1;j++;}else{try{delete $t.p.postData[nm];}catch(e){}}
break;case'text':$("input[name="+nm+"]",$t.grid.hDiv).val(v);if(v){sdata[nm]=v;j++;}else{try{delete $t.p.postData[nm];}catch(e){}}
break;}});var sd=j>0?true:false;if(!p.stringResult){$.extend($t.p.postData,sdata);}else{var ruleGroup="{\"groupOp\":\""+p.groupOp+"\",\"rules\":[";var gi=0;$.each(sdata,function(i,n){if(gi>0)ruleGroup+=",";ruleGroup+="{\"field\":\""+i+"\",";ruleGroup+="\"op\":\""+"eq"+"\",";ruleGroup+="\"data\":\""+n+"\"}";gi++;});ruleGroup+="]}";$.extend($t.p.postData,{filters:ruleGroup});}
var saveurl;if($t.p.searchurl){saveurl=$t.p.url;$($t).jqGrid("setGridParam",{url:$t.p.searchurl});}
var bcv=false;if($.isFunction(p.beforeClear)){bcv=p.beforeClear.call($t);}
if(!bcv){if(trigger)
$($t).jqGrid("setGridParam",{search:sd}).trigger("reloadGrid",[{page:1}]);}
if(saveurl){$($t).jqGrid("setGridParam",{url:saveurl});}
if($.isFunction(p.afterClear)){p.afterClear();}};var toggleToolbar=function(){var trow=$("tr.ui-search-toolbar",$t.grid.hDiv);if(trow.css("display")=='none')trow.show();else trow.hide();};function bindEvents(selector,events){var jElem=$(selector);if(jElem[0]!=null){jQuery.each(events,function(){if(this.data!=null)
jElem.bind(this.type,this.data,this.fn);else
jElem.bind(this.type,this.fn);});}}
var tr=$("<tr class='ui-search-toolbar' role='rowheader'></tr>");var timeoutHnd;$.each($t.p.colModel,function(i,n){var cm=this,thd,th,soptions,surl,self;th=$("<th role='columnheader' class='ui-state-default ui-th-column ui-th-"+$t.p.direction+"'></th>");thd=$("<div style='width:100%;position:relative;height:100%;padding-right:0.3em;'></div>");if(this.hidden===true){$(th).css("display","none");}
this.search=this.search===false?false:true;if(typeof this.stype=='undefined'){this.stype='text';}
soptions=$.extend({},this.searchoptions||{});if(this.search){switch(this.stype)
{case"select":surl=this.surl||soptions.dataUrl;if(surl){self=thd;$.ajax($.extend({url:surl,dataType:"html",complete:function(res,status){if(soptions.buildSelect!=null){var d=soptions.buildSelect(res);if(d)$(self).append(d);}else{$(self).append(res.responseText);}
if(soptions.defaultValue)$("select",self).val(soptions.defaultValue);$("select",self).attr({name:cm.index||cm.name,id:"gs_"+cm.name});if(soptions.attr){$("select",self).attr(soptions.attr);}
$("select",self).css({width:"100%"});if(soptions.dataInit!=null)soptions.dataInit($("select",self)[0]);if(soptions.dataEvents!=null)bindEvents($("select",self)[0],soptions.dataEvents);if(p.autosearch===true){$("select",self).change(function(e){triggerToolbar();return false;});}
res=null;}},$.jgrid.ajaxOptions,$t.p.ajaxSelectOptions||{}));}else{var oSv;if(cm.searchoptions&&cm.searchoptions.value)
oSv=cm.searchoptions.value;else if(cm.editoptions&&cm.editoptions.value){oSv=cm.editoptions.value;}
if(oSv){var elem=document.createElement("select");elem.style.width="100%";$(elem).attr({name:cm.index||cm.name,id:"gs_"+cm.name});if(typeof oSv==="string"){var so=oSv.split(";"),sv,ov;for(var k=0;k<so.length;k++){sv=so[k].split(":");ov=document.createElement("option");ov.value=sv[0];ov.innerHTML=sv[1];elem.appendChild(ov);}}else if(typeof oSv==="object"){for(var key in oSv){ov=document.createElement("option");ov.value=key;ov.innerHTML=oSv[key];elem.appendChild(ov);}}
if(soptions.defaultValue)$(elem).val(soptions.defaultValue);if(soptions.attr){$(elem).attr(soptions.attr);}
if(soptions.dataInit!=null)soptions.dataInit(elem);if(soptions.dataEvents!=null)bindEvents(elem,soptions.dataEvents);$(thd).append(elem);if(p.autosearch===true){$(elem).change(function(e){triggerToolbar();return false;});}}}
break;case'text':var df=soptions.defaultValue?soptions.defaultValue:"";$(thd).append("<input type='text' style='width:95%;padding:0px;' name='"+(cm.index||cm.name)+"' id='gs_"+cm.name+"' value='"+df+"'/>");if(soptions.attr){$("input",thd).attr(soptions.attr);}
if(soptions.dataInit!=null)soptions.dataInit($("input",thd)[0]);if(soptions.dataEvents!=null)bindEvents($("input",thd)[0],soptions.dataEvents);if(p.autosearch===true){if(p.searchOnEnter){$("input",thd).keypress(function(e){var key=e.charCode?e.charCode:e.keyCode?e.keyCode:0;if(key==13){triggerToolbar();return false;}
return this;});}else{$("input",thd).keydown(function(e){var key=e.which;switch(key){case 9:case 16:case 37:case 38:case 39:case 40:case 27:break;default:if(timeoutHnd)clearTimeout(timeoutHnd);timeoutHnd=setTimeout(function(){triggerToolbar();},500);}});}}
break;}}
$(th).append(thd);$(tr).append(th);});$("table thead",$t.grid.hDiv).append(tr);this.triggerToolbar=triggerToolbar;this.clearToolbar=clearToolbar;this.toggleToolbar=toggleToolbar;});}});})(jQuery);var showModal=function(h){h.w.show();};var closeModal=function(h){h.w.hide().attr("aria-hidden","true");if(h.o){h.o.remove();}};var createModal=function(aIDs,content,p,insertSelector,posSelector,appendsel){var mw=document.createElement('div'),rtlsup;rtlsup=jQuery(p.gbox).attr("dir")=="rtl"?true:false;mw.className="ui-widget ui-widget-content ui-corner-all ui-jqdialog";mw.id=aIDs.themodal;var mh=document.createElement('div');mh.className="ui-jqdialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix";mh.id=aIDs.modalhead;jQuery(mh).append("<span class='ui-jqdialog-title'>"+p.caption+"</span>");var ahr=jQuery("<a href='javascript:void(0)' class='ui-jqdialog-titlebar-close ui-corner-all'></a>").hover(function(){ahr.addClass('ui-state-hover');},function(){ahr.removeClass('ui-state-hover');}).append("<span class='ui-icon ui-icon-closethick'></span>");jQuery(mh).append(ahr);if(rtlsup){mw.dir="rtl";jQuery(".ui-jqdialog-title",mh).css("float","right");jQuery(".ui-jqdialog-titlebar-close",mh).css("left",0.3+"em");}else{mw.dir="ltr";jQuery(".ui-jqdialog-title",mh).css("float","left");jQuery(".ui-jqdialog-titlebar-close",mh).css("right",0.3+"em");}
var mc=document.createElement('div');jQuery(mc).addClass("ui-jqdialog-content ui-widget-content").attr("id",aIDs.modalcontent);jQuery(mc).append(content);mw.appendChild(mc);jQuery(mw).prepend(mh);if(appendsel===true){jQuery('body').append(mw);}
else{jQuery(mw).insertBefore(insertSelector);}
if(typeof p.jqModal==='undefined'){p.jqModal=true;}
var coord={};if(jQuery.fn.jqm&&p.jqModal===true){if(p.left==0&&p.top==0){var pos=[];pos=findPos(posSelector);p.left=pos[0]+4;p.top=pos[1]+4;}
coord.top=p.top+"px";coord.left=p.left;}else if(p.left!=0||p.top!=0){coord.left=p.left;coord.top=p.top+"px";}
jQuery("a.ui-jqdialog-titlebar-close",mh).click(function(e){var oncm=jQuery("#"+aIDs.themodal).data("onClose")||p.onClose;var gboxclose=jQuery("#"+aIDs.themodal).data("gbox")||p.gbox;hideModal("#"+aIDs.themodal,{gb:gboxclose,jqm:p.jqModal,onClose:oncm});return false;});if(p.width==0||!p.width){p.width=300;}
if(p.height==0||!p.height){p.height=200;}
if(!p.zIndex){p.zIndex=950;}
var rtlt=0;if(rtlsup&&coord.left&&!appendsel){rtlt=jQuery(p.gbox).width()-(!isNaN(p.width)?parseInt(p.width):0)-8;coord.left=parseInt(coord.left)+parseInt(rtlt);}
if(coord.left)coord.left+="px";jQuery(mw).css(jQuery.extend({width:isNaN(p.width)?"auto":p.width+"px",height:isNaN(p.height)?"auto":p.height+"px",zIndex:p.zIndex,overflow:'hidden'},coord)).attr({tabIndex:"-1","role":"dialog","aria-labelledby":aIDs.modalhead,"aria-hidden":"true"});if(typeof p.drag=='undefined'){p.drag=true;}
if(typeof p.resize=='undefined'){p.resize=true;}
if(p.drag){jQuery(mh).css('cursor','move');if(jQuery.fn.jqDrag){jQuery(mw).jqDrag(mh);}else{try{jQuery(mw).draggable({handle:jQuery("#"+mh.id)});}catch(e){}}}
if(p.resize){if(jQuery.fn.jqResize){jQuery(mw).append("<div class='jqResize ui-resizable-handle ui-resizable-se ui-icon ui-icon-gripsmall-diagonal-se ui-icon-grip-diagonal-se'></div>");jQuery("#"+aIDs.themodal).jqResize(".jqResize",aIDs.scrollelm?"#"+aIDs.scrollelm:false);}else{try{jQuery(mw).resizable({handles:'se, sw',alsoResize:aIDs.scrollelm?"#"+aIDs.scrollelm:false});}catch(e){}}}
if(p.closeOnEscape===true){jQuery(mw).keydown(function(e){if(e.which==27){var cone=jQuery("#"+aIDs.themodal).data("onClose")||p.onClose;hideModal(this,{gb:p.gbox,jqm:p.jqModal,onClose:cone});}});}};var viewModal=function(selector,o){o=jQuery.extend({toTop:true,overlay:10,modal:false,onShow:showModal,onHide:closeModal,gbox:'',jqm:true,jqM:true},o||{});if(jQuery.fn.jqm&&o.jqm==true){if(o.jqM)jQuery(selector).attr("aria-hidden","false").jqm(o).jqmShow();else jQuery(selector).attr("aria-hidden","false").jqmShow();}else{if(o.gbox!=''){jQuery(".jqgrid-overlay:first",o.gbox).show();jQuery(selector).data("gbox",o.gbox);}
jQuery(selector).show().attr("aria-hidden","false");try{jQuery(':input:visible',selector)[0].focus();}catch(_){}}};var hideModal=function(selector,o){o=jQuery.extend({jqm:true,gb:''},o||{});if(o.onClose){var oncret=o.onClose(selector);if(typeof oncret=='boolean'&&!oncret)return;}
if(jQuery.fn.jqm&&o.jqm===true){jQuery(selector).attr("aria-hidden","true").jqmHide();}else{if(o.gb!=''){try{jQuery(".jqgrid-overlay:first",o.gb).hide();}catch(e){}}
jQuery(selector).hide().attr("aria-hidden","true");}};function info_dialog(caption,content,c_b,modalopt){var mopt={width:290,height:'auto',dataheight:'auto',drag:true,resize:false,caption:"<b>"+caption+"</b>",left:250,top:170,zIndex:1000,jqModal:true,modal:false,closeOnEscape:true,align:'center',buttonalign:'center',buttons:[]};jQuery.extend(mopt,modalopt||{});var jm=mopt.jqModal;if(jQuery.fn.jqm&&!jm)jm=false;var buttstr="";if(mopt.buttons.length>0){for(var i=0;i<mopt.buttons.length;i++){if(typeof mopt.buttons[i].id=="undefined")mopt.buttons[i].id="info_button_"+i;buttstr+="<a href='javascript:void(0)' id='"+mopt.buttons[i].id+"' class='fm-button ui-state-default ui-corner-all'>"+mopt.buttons[i].text+"</a>";}}
var dh=isNaN(mopt.dataheight)?mopt.dataheight:mopt.dataheight+"px",cn="text-align:"+mopt.align+";";var cnt="<div id='info_id'>";cnt+="<div id='infocnt' style='margin:0px;padding-bottom:1em;width:100%;overflow:auto;position:relative;height:"+dh+";"+cn+"'>"+content+"</div>";cnt+=c_b?"<div class='ui-widget-content ui-helper-clearfix' style='text-align:"+mopt.buttonalign+";padding-bottom:0.8em;padding-top:0.5em;background-image: none;border-width: 1px 0 0 0;'><a href='javascript:void(0)' id='closedialog' class='fm-button ui-state-default ui-corner-all'>"+c_b+"</a>"+buttstr+"</div>":"";cnt+="</div>";try{if(jQuery("#info_dialog").attr("aria-hidden")=="false")
hideModal("#info_dialog",{jqm:jm});jQuery("#info_dialog").remove();}catch(e){}
createModal({themodal:'info_dialog',modalhead:'info_head',modalcontent:'info_content',scrollelm:'infocnt'},cnt,mopt,'','',true);if(buttstr){jQuery.each(mopt.buttons,function(i){jQuery("#"+this.id,"#info_id").bind('click',function(){mopt.buttons[i].onClick.call(jQuery("#info_dialog"));return false;});});}
jQuery("#closedialog","#info_id").click(function(e){hideModal("#info_dialog",{jqm:jm});return false;});jQuery(".fm-button","#info_dialog").hover(function(){jQuery(this).addClass('ui-state-hover');},function(){jQuery(this).removeClass('ui-state-hover');});viewModal("#info_dialog",{onHide:function(h){h.w.hide().remove();if(h.o){h.o.remove();}},modal:mopt.modal,jqm:jm});try{$("#info_dialog").focus();}catch(e){}}
function findPos(obj){var curleft=curtop=0;if(obj.offsetParent){do{curleft+=obj.offsetLeft;curtop+=obj.offsetTop;}while(obj=obj.offsetParent);}
return[curleft,curtop];}
function isArray(obj){if(obj.constructor.toString().indexOf("Array")==-1){return false;}else{return true;}}
function createEl(eltype,options,vl,autowidth,ajaxso){var elem="";if(options.defaultValue)delete options['defaultValue'];function bindEv(el,opt){if(jQuery.isFunction(opt.dataInit)){el.id=opt.id;opt.dataInit(el);delete opt['id'];delete opt['dataInit'];}
if(opt.dataEvents){jQuery.each(opt.dataEvents,function(){if(this.data!=null)
jQuery(el).bind(this.type,this.data,this.fn);else
jQuery(el).bind(this.type,this.fn);});delete opt['dataEvents'];}
return opt;}
switch(eltype)
{case"textarea":elem=document.createElement("textarea");if(autowidth){if(!options.cols)jQuery(elem).css({width:"98%"});}else if(!options.cols)options.cols=20;if(!options.rows)options.rows=2;if(vl=='&nbsp;'||vl=='&#160;'||(vl.length==1&&vl.charCodeAt(0)==160)){vl="";}
elem.value=vl;options=bindEv(elem,options);jQuery(elem).attr(options);break;case"checkbox":elem=document.createElement("input");elem.type="checkbox";if(!options.value){var vl1=vl.toLowerCase();if(vl1.search(/(false|0|no|off|undefined)/i)<0&&vl1!==""){elem.checked=true;elem.defaultChecked=true;elem.value=vl;}else{elem.value="on";}
jQuery(elem).attr("offval","off");}else{var cbval=options.value.split(":");if(vl===cbval[0]){elem.checked=true;elem.defaultChecked=true;}
elem.value=cbval[0];jQuery(elem).attr("offval",cbval[1]);try{delete options['value'];}catch(e){}}
options=bindEv(elem,options);jQuery(elem).attr(options);break;case"select":elem=document.createElement("select");var msl,ovm=[];if(options.multiple===true){msl=true;elem.multiple="multiple";}else msl=false;if(options.dataUrl!=null){jQuery.ajax(jQuery.extend({url:options.dataUrl,type:"GET",complete:function(data,status){try{delete options['dataUrl'];delete options['value'];}catch(e){}
var a;if(options.buildSelect!=null){var b=options.buildSelect(data);a=jQuery(b).html();delete options['buildSelect'];}else
a=jQuery(data.responseText).html();if(a){jQuery(elem).append(a);options=bindEv(elem,options);if(typeof options.size==='undefined'){options.size=msl?3:1;}
if(msl){ovm=vl.split(",");ovm=jQuery.map(ovm,function(n){return jQuery.trim(n)});}else{ovm[0]=vl;}
jQuery(elem).attr(options);setTimeout(function(){jQuery("option",elem).each(function(i){if(i==0)this.selected="";if(jQuery.inArray(jQuery(this).text(),ovm)>-1||jQuery.inArray(jQuery(this).val(),ovm)>-1){this.selected="selected";if(!msl)return false;}});},0);}}},ajaxso||{}));}else if(options.value){var i;if(msl){ovm=vl.split(",");ovm=jQuery.map(ovm,function(n){return jQuery.trim(n)});if(typeof options.size==='undefined'){options.size=3;}}else{options.size=1;}
if(typeof options.value==='function')options.value=options.value();if(typeof options.value==='string'){var so=options.value.split(";"),sv,ov;for(i=0;i<so.length;i++){sv=so[i].split(":");if(sv.length>2){sv[1]=jQuery.map(sv,function(n,i){if(i>0)return n;}).join(":");}
ov=document.createElement("option");ov.value=sv[0];ov.innerHTML=sv[1];if(!msl&&(sv[0]==vl||sv[1]==vl))ov.selected="selected";if(msl&&(jQuery.inArray(sv[1],ovm)>-1||jQuery.inArray(sv[0],ovm)>-1)){ov.selected="selected";}
elem.appendChild(ov);}}else if(typeof options.value==='object'){var oSv=options.value;for(var key in oSv){ov=document.createElement("option");ov.value=key;ov.innerHTML=oSv[key];if(!msl&&(key==vl||oSv[key]==vl))ov.selected="selected";if(msl&&(jQuery.inArray(oSv[key],ovm)>-1||jQuery.inArray(key,ovm)>-1))ov.selected="selected";elem.appendChild(ov);}}
options=bindEv(elem,options);try{delete options['value'];}catch(e){}
jQuery(elem).attr(options);}
break;case"text":case"password":case"button":elem=document.createElement("input");elem.type=eltype;elem.value=vl;options=bindEv(elem,options);if(eltype!="button"){if(autowidth){if(!options.size)jQuery(elem).css({width:"98%"});}else if(!options.size)options.size=20;}
jQuery(elem).attr(options);break;case"image":case"file":elem=document.createElement("input");elem.type=eltype;options=bindEv(elem,options);jQuery(elem).attr(options);break;case"custom":elem=document.createElement("span");try{if(jQuery.isFunction(options.custom_element)){var celm=options.custom_element.call(this,vl,options);if(celm){celm=jQuery(celm).addClass("customelement").attr({id:options.id,name:options.name});jQuery(elem).empty().append(celm);}
else throw"e2";}else throw"e1";}catch(e){if(e=="e1")info_dialog(jQuery.jgrid.errors.errcap,"function 'custom_element' "+jQuery.jgrid.edit.msg.nodefined,jQuery.jgrid.edit.bClose);if(e=="e2")info_dialog(jQuery.jgrid.errors.errcap,"function 'custom_element' "+jQuery.jgrid.edit.msg.novalue,jQuery.jgrid.edit.bClose);else info_dialog(jQuery.jgrid.errors.errcap,e.message,jQuery.jgrid.edit.bClose);}
break;}
return elem;}
function checkValues(val,valref,g){var edtrul,i,nm;if(typeof(valref)=='string'){for(i=0,len=g.p.colModel.length;i<len;i++){if(g.p.colModel[i].name==valref){edtrul=g.p.colModel[i].editrules;valref=i;try{nm=g.p.colModel[i].formoptions.label;}catch(e){}
break;}}}else if(valref>=0){edtrul=g.p.colModel[valref].editrules;}
if(edtrul){if(!nm)nm=g.p.colNames[valref];if(edtrul.required===true){if(val.match(/^s+$/)||val=="")return[false,nm+": "+jQuery.jgrid.edit.msg.required,""];}
var rqfield=edtrul.required===false?false:true;if(edtrul.number===true){if(!(rqfield===false&&isEmpty(val))){if(isNaN(val))return[false,nm+": "+jQuery.jgrid.edit.msg.number,""];}}
if(typeof edtrul.minValue!='undefined'&&!isNaN(edtrul.minValue)){if(parseFloat(val)<parseFloat(edtrul.minValue))return[false,nm+": "+jQuery.jgrid.edit.msg.minValue+" "+edtrul.minValue,""];}
if(typeof edtrul.maxValue!='undefined'&&!isNaN(edtrul.maxValue)){if(parseFloat(val)>parseFloat(edtrul.maxValue))return[false,nm+": "+jQuery.jgrid.edit.msg.maxValue+" "+edtrul.maxValue,""];}
var filter;if(edtrul.email===true){if(!(rqfield===false&&isEmpty(val))){filter=/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i;if(!filter.test(val)){return[false,nm+": "+jQuery.jgrid.edit.msg.email,""];}}}
if(edtrul.integer===true){if(!(rqfield===false&&isEmpty(val))){if(isNaN(val))return[false,nm+": "+jQuery.jgrid.edit.msg.integer,""];if((val%1!=0)||(val.indexOf('.')!=-1))return[false,nm+": "+jQuery.jgrid.edit.msg.integer,""];}}
if(edtrul.date===true){if(!(rqfield===false&&isEmpty(val))){var dft=g.p.colModel[valref].datefmt||"Y-m-d";if(!checkDate(dft,val))return[false,nm+": "+jQuery.jgrid.edit.msg.date+" - "+dft,""];}}
if(edtrul.time===true){if(!(rqfield===false&&isEmpty(val))){if(!checkTime(val))return[false,nm+": "+jQuery.jgrid.edit.msg.date+" - hh:mm (am/pm)",""];}}
if(edtrul.url===true){if(!(rqfield===false&&isEmpty(val))){filter=/^(((https?)|(ftp)):\/\/([\-\w]+\.)+\w{2,3}(\/[%\-\w]+(\.\w{2,})?)*(([\w\-\.\?\\\/+@&#;`~=%!]*)(\.\w{2,})?)*\/?)/i;if(!filter.test(val)){return[false,nm+": "+jQuery.jgrid.edit.msg.url,""];}}}
if(edtrul.custom===true){if(!(rqfield===false&&isEmpty(val))){if(jQuery.isFunction(edtrul.custom_func)){var ret=edtrul.custom_func.call(g,val,nm);if(jQuery.isArray(ret)){return ret;}else{return[false,jQuery.jgrid.edit.msg.customarray,""];}}else{return[false,jQuery.jgrid.edit.msg.customfcheck,""];}}}}
return[true,"",""];}
function checkDate(format,date){var tsp={},sep;format=format.toLowerCase();if(format.indexOf("/")!=-1){sep="/";}else if(format.indexOf("-")!=-1){sep="-";}else if(format.indexOf(".")!=-1){sep=".";}else{sep="/";}
format=format.split(sep);date=date.split(sep);if(date.length!=3)return false;var j=-1,yln,dln=-1,mln=-1;for(var i=0;i<format.length;i++){var dv=isNaN(date[i])?0:parseInt(date[i],10);tsp[format[i]]=dv;yln=format[i];if(yln.indexOf("y")!=-1){j=i;}
if(yln.indexOf("m")!=-1){mln=i}
if(yln.indexOf("d")!=-1){dln=i}}
if(format[j]=="y"||format[j]=="yyyy"){yln=4;}else if(format[j]=="yy"){yln=2;}else{yln=-1;}
var daysInMonth=DaysArray(12);var strDate;if(j===-1){return false;}else{strDate=tsp[format[j]].toString();if(yln==2&&strDate.length==1){yln=1;}
if(strDate.length!=yln||(tsp[format[j]]==0&&date[j]!="00")){return false;}}
if(mln===-1){return false;}else{strDate=tsp[format[mln]].toString();if(strDate.length<1||tsp[format[mln]]<1||tsp[format[mln]]>12){return false;}}
if(dln===-1){return false;}else{strDate=tsp[format[dln]].toString();if(strDate.length<1||tsp[format[dln]]<1||tsp[format[dln]]>31||(tsp[format[mln]]==2&&tsp[format[dln]]>daysInFebruary(tsp[format[j]]))||tsp[format[dln]]>daysInMonth[tsp[format[mln]]]){return false;}}
return true;}
function daysInFebruary(year){return(((year%4==0)&&((!(year%100==0))||(year%400==0)))?29:28);}
function DaysArray(n){for(var i=1;i<=n;i++){this[i]=31;if(i==4||i==6||i==9||i==11){this[i]=30;}
if(i==2){this[i]=29;}}
return this;}
function isEmpty(val)
{if(val.match(/^s+$/)||val==""){return true;}else{return false;}}
function checkTime(time){var re=/^(\d{1,2}):(\d{2})([ap]m)?$/,regs;if(!isEmpty(time))
{regs=time.match(re);if(regs){if(regs[3]){if(regs[1]<1||regs[1]>12)
return false;}else{if(regs[1]>23)
return false;}
if(regs[2]>59){return false;}}else{return false;}}
return true;};(function($){var rp_ge=null;$.jgrid.extend({searchGrid:function(p){p=$.extend({recreateFilter:false,drag:true,sField:'searchField',sValue:'searchString',sOper:'searchOper',sFilter:'filters',beforeShowSearch:null,afterShowSearch:null,onInitializeSearch:null,closeAfterSearch:false,closeOnEscape:false,multipleSearch:false,sopt:null,onClose:null},$.jgrid.search,p||{});return this.each(function(){var $t=this;if(!$t.grid){return;}
if($.fn.searchFilter){var fid="fbox_"+$t.p.id;if(p.recreateFilter===true){$("#"+fid).remove();}
if($("#"+fid).html()!=null){if($.isFunction(p.beforeShowSearch)){p.beforeShowSearch($("#"+fid));};showFilter();if($.isFunction(p.afterShowSearch)){p.afterShowSearch($("#"+fid));}}else{var fields=[],colNames=$("#"+$t.p.id).jqGrid("getGridParam","colNames"),colModel=$("#"+$t.p.id).jqGrid("getGridParam","colModel"),stempl=['eq','ne','lt','le','gt','ge','bw','bn','in','ni','ew','en','cn','nc'],j,pos,k,oprtr;oprtr=jQuery.fn.searchFilter.defaults.operators;if(p.sopt!=null){oprtr=[];k=0;for(j=0;j<p.sopt.length;j++){if((pos=$.inArray(p.sopt[j],stempl))!=-1){oprtr[k]={op:p.sopt[j],text:p.odata[pos]};k++;}}}
var searchable;$.each(colModel,function(i,v){searchable=(typeof v.search==='undefined')?true:v.search,hidden=(v.hidden===true),soptions=$.extend({},{text:colNames[i],itemval:v.index||v.name},this.searchoptions),ignoreHiding=(soptions.searchhidden===true);if(typeof soptions.sopt=='undefined')soptions.sopt=p.sopt||stempl;k=0;soptions.ops=[];if(soptions.sopt.length>0){for(j=0;j<soptions.sopt.length;j++){if((pos=$.inArray(soptions.sopt[j],stempl))!=-1){soptions.ops[k]={op:soptions.sopt[j],text:p.odata[pos]};k++;}}}
if(typeof(this.stype)==='undefined')this.stype='text';if(this.stype=='select'){if(soptions.dataUrl!=null){}
else{var eov;if(soptions.value)
eov=soptions.value;else if(this.editoptions)
eov=this.editoptions.value;if(eov){soptions.dataValues=[];if(typeof(eov)==='string'){var so=eov.split(";"),sv;for(j=0;j<so.length;j++){sv=so[j].split(":");soptions.dataValues[j]={value:sv[0],text:sv[1]};}}else if(typeof(eov)==='object'){j=0;for(var key in eov){soptions.dataValues[j]={value:key,text:eov[key]};j++;}}}}}
if((ignoreHiding&&searchable)||(searchable&&!hidden)){fields.push(soptions);}});if(fields.length>0){$("<div id='"+fid+"' role='dialog' tabindex='-1'></div>").insertBefore("#gview_"+$t.p.id);$("#"+fid).searchFilter(fields,{groupOps:p.groupOps,operators:oprtr,onClose:hideFilter,resetText:p.Reset,searchText:p.Find,windowTitle:p.caption,rulesText:p.rulesText,matchText:p.matchText,onSearch:searchFilters,onReset:resetFilters,stringResult:p.multipleSearch,ajaxSelectOptions:$.extend({},$.jgrid.ajaxOptions,$t.p.ajaxSelectOptions||{})});$(".ui-widget-overlay","#"+fid).remove();if($t.p.direction=="rtl")$(".ui-closer","#"+fid).css("float","left");if(p.drag===true){$("#"+fid+" table thead tr:first td:first").css('cursor','move');if(jQuery.fn.jqDrag){$("#"+fid).jqDrag($("#"+fid+" table thead tr:first td:first"));}else{try{$("#"+fid).draggable({handle:$("#"+fid+" table thead tr:first td:first")});}catch(e){}}}
if(p.multipleSearch===false){$(".ui-del, .ui-add, .ui-del, .ui-add-last, .matchText, .rulesText","#"+fid).hide();$("select[name='groupOp']","#"+fid).hide();}
if($.isFunction(p.onInitializeSearch)){p.onInitializeSearch($("#"+fid));};if($.isFunction(p.beforeShowSearch)){p.beforeShowSearch($("#"+fid));};showFilter();if($.isFunction(p.afterShowSearch)){p.afterShowSearch($("#"+fid));}
if(p.closeOnEscape===true){$("#"+fid).keydown(function(e){if(e.which==27){hideFilter($("#"+fid));}});}}}}
function searchFilters(filters){var hasFilters=(filters!==undefined),grid=$("#"+$t.p.id),sdata={};if(p.multipleSearch===false){sdata[p.sField]=filters.rules[0].field;sdata[p.sValue]=filters.rules[0].data;sdata[p.sOper]=filters.rules[0].op;}else{sdata[p.sFilter]=filters;}
grid[0].p.search=hasFilters;$.extend(grid[0].p.postData,sdata);grid.trigger("reloadGrid",[{page:1}]);if(p.closeAfterSearch)hideFilter($("#"+fid));}
function resetFilters(filters){var hasFilters=(filters!==undefined),grid=$("#"+$t.p.id),sdata=[];grid[0].p.search=hasFilters;if(p.multipleSearch===false){sdata[p.sField]=sdata[p.sValue]=sdata[p.sOper]="";}else{sdata[p.sFilter]="";}
$.extend(grid[0].p.postData,sdata);grid.trigger("reloadGrid",[{page:1}]);}
function hideFilter(selector){if(p.onClose){var fclm=p.onClose(selector);if(typeof fclm=='boolean'&&!fclm)return;}
selector.hide();$(".jqgrid-overlay:first","#gbox_"+$t.p.id).hide();}
function showFilter(){var fl=$(".ui-searchFilter").length;if(fl>1){var zI=$("#"+fid).css("zIndex");$("#"+fid).css({zIndex:parseInt(zI)+fl});}
$("#"+fid).show();$(".jqgrid-overlay:first","#gbox_"+$t.p.id).show();try{$(':input:visible',"#"+fid)[0].focus();}catch(_){}}});},editGridRow:function(rowid,p){p=$.extend({top:0,left:0,width:300,height:'auto',dataheight:'auto',modal:false,drag:true,resize:true,url:null,mtype:"POST",clearAfterAdd:true,closeAfterEdit:false,reloadAfterSubmit:true,onInitializeForm:null,beforeInitData:null,beforeShowForm:null,afterShowForm:null,beforeSubmit:null,afterSubmit:null,onclickSubmit:null,afterComplete:null,onclickPgButtons:null,afterclickPgButtons:null,editData:{},recreateForm:false,jqModal:true,closeOnEscape:false,addedrow:"first",topinfo:'',bottominfo:'',saveicon:[],closeicon:[],savekey:[false,13],navkeys:[false,38,40],checkOnSubmit:false,checkOnUpdate:false,_savedData:{},processing:false,onClose:null,ajaxEditOptions:{},serializeEditData:null,viewPagerButtons:true},$.jgrid.edit,p||{});rp_ge=p;return this.each(function(){var $t=this;if(!$t.grid||!rowid){return;}
var gID=$t.p.id,frmgr="FrmGrid_"+gID,frmtb="TblGrid_"+gID,IDs={themodal:'editmod'+gID,modalhead:'edithd'+gID,modalcontent:'editcnt'+gID,scrollelm:frmgr},onBeforeShow=$.isFunction(rp_ge.beforeShowForm)?rp_ge.beforeShowForm:false,onAfterShow=$.isFunction(rp_ge.afterShowForm)?rp_ge.afterShowForm:false,onBeforeInit=$.isFunction(rp_ge.beforeInitData)?rp_ge.beforeInitData:false,onInitializeForm=$.isFunction(rp_ge.onInitializeForm)?rp_ge.onInitializeForm:false,copydata=null,maxCols=1,maxRows=0,gurl,postdata,ret,extpost,newData,diff;if(rowid=="new"){rowid="_empty";p.caption=p.addCaption;}else{p.caption=p.editCaption;};if(p.recreateForm===true&&$("#"+IDs.themodal).html()!=null){$("#"+IDs.themodal).remove();}
var closeovrl=true;if(p.checkOnUpdate&&p.jqModal&&!p.modal){closeovrl=false;}
if($("#"+IDs.themodal).html()!=null){$(".ui-jqdialog-title","#"+IDs.modalhead).html(p.caption);$("#FormError","#"+frmtb).hide();if(rp_ge.topinfo){$(".topinfo","#"+frmtb+"_2").html(rp_ge.topinfo);$(".tinfo","#"+frmtb+"_2").show();}
else $(".tinfo","#"+frmtb+"_2").hide();if(rp_ge.bottominfo){$(".bottominfo","#"+frmtb+"_2").html(rp_ge.bottominfo);$(".binfo","#"+frmtb+"_2").show();}
else $(".binfo","#"+frmtb+"_2").hide();if(onBeforeInit){onBeforeInit($("#"+frmgr));}
fillData(rowid,$t,frmgr);if(rowid=="_empty"||!rp_ge.viewPagerButtons){$("#pData, #nData","#"+frmtb+"_2").hide();}else{$("#pData, #nData","#"+frmtb+"_2").show();}
if(rp_ge.processing===true){rp_ge.processing=false;$("#sData","#"+frmtb+"_2").removeClass('ui-state-active');}
if($("#"+frmgr).data("disabled")===true){$(".confirm","#"+IDs.themodal).hide();$("#"+frmgr).data("disabled",false);}
if(onBeforeShow){onBeforeShow($("#"+frmgr));}
$("#"+IDs.themodal).data("onClose",rp_ge.onClose);viewModal("#"+IDs.themodal,{gbox:"#gbox_"+gID,jqm:p.jqModal,jqM:false,closeoverlay:closeovrl,modal:p.modal});if(!closeovrl){$(".jqmOverlay").click(function(){if(!checkUpdates())return false;hideModal("#"+IDs.themodal,{gb:"#gbox_"+gID,jqm:p.jqModal,onClose:rp_ge.onClose});return false;});}
if(onAfterShow){onAfterShow($("#"+frmgr));}}else{$($t.p.colModel).each(function(i){var fmto=this.formoptions;maxCols=Math.max(maxCols,fmto?fmto.colpos||0:0);maxRows=Math.max(maxRows,fmto?fmto.rowpos||0:0);});var dh=isNaN(p.dataheight)?p.dataheight:p.dataheight+"px";var flr,frm=$("<form name='FormPost' id='"+frmgr+"' class='FormGrid' style='width:100%;overflow:auto;position:relative;height:"+dh+";'></form>").data("disabled",false),tbl=$("<table id='"+frmtb+"' class='EditTable' cellspacing='0' cellpading='0' border='0'><tbody></tbody></table>");$(frm).append(tbl);flr=$("<tr id='FormError' style='display:none'><td class='ui-state-error' colspan='"+(maxCols*2)+"'></td></tr>");flr[0].rp=0;$(tbl).append(flr);flr=$("<tr style='display:none' class='tinfo'><td class='topinfo' colspan='"+(maxCols*2)+"'>"+rp_ge.topinfo+"</td></tr>");flr[0].rp=0;$(tbl).append(flr);if(onBeforeInit){onBeforeInit($("#"+frmgr));}
var rtlb=$t.p.direction=="rtl"?true:false,bp=rtlb?"nData":"pData",bn=rtlb?"pData":"nData",valref=createData(rowid,$t,tbl,maxCols),bP="<a href='javascript:void(0)' id='"+bp+"' class='fm-button ui-state-default ui-corner-left'><span class='ui-icon ui-icon-triangle-1-w'></span></div>",bN="<a href='javascript:void(0)' id='"+bn+"' class='fm-button ui-state-default ui-corner-right'><span class='ui-icon ui-icon-triangle-1-e'></span></div>",bS="<a href='javascript:void(0)' id='sData' class='fm-button ui-state-default ui-corner-all'>"+p.bSubmit+"</a>",bC="<a href='javascript:void(0)' id='cData' class='fm-button ui-state-default ui-corner-all'>"+p.bCancel+"</a>";var bt="<table border='0' class='EditTable' id='"+frmtb+"_2'><tbody><tr id='Act_Buttons'><td class='navButton ui-widget-content'>"+(rtlb?bN+bP:bP+bN)+"</td><td class='EditButton ui-widget-content'>"+bS+bC+"</td></tr>";bt+="<tr style='display:none' class='binfo'><td class='bottominfo' colspan='2'>"+rp_ge.bottominfo+"</td></tr>";bt+="</tbody></table>";if(maxRows>0){var sd=[];$.each($(tbl)[0].rows,function(i,r){sd[i]=r;});sd.sort(function(a,b){if(a.rp>b.rp){return 1;}
if(a.rp<b.rp){return-1;}
return 0;});$.each(sd,function(index,row){$('tbody',tbl).append(row);});}
p.gbox="#gbox_"+gID;var cle=false;if(p.closeOnEscape===true){p.closeOnEscape=false;cle=true;}
var tms=$("<span></span>").append(frm).append(bt);createModal(IDs,tms,p,"#gview_"+$t.p.id,$("#gview_"+$t.p.id)[0]);if(rtlb){$("#pData, #nData","#"+frmtb+"_2").css("float","right");$(".EditButton","#"+frmtb+"_2").css("text-align","left");}
if(rp_ge.topinfo)$(".tinfo","#"+frmtb+"_2").show();if(rp_ge.bottominfo)$(".binfo","#"+frmtb+"_2").show();tms=null;bt=null;$("#"+IDs.themodal).keydown(function(e){var wkey=e.target;if($("#"+frmgr).data("disabled")===true)return false;if(rp_ge.savekey[0]===true&&e.which==rp_ge.savekey[1]){if(wkey.tagName!="TEXTAREA"){$("#sData","#"+frmtb+"_2").trigger("click");return false;}}
if(e.which===27){if(!checkUpdates())return false;if(cle)hideModal(this,{gb:p.gbox,jqm:p.jqModal,onClose:rp_ge.onClose});return false;}
if(rp_ge.navkeys[0]===true){if($("#id_g","#"+frmtb).val()=="_empty")return true;if(e.which==rp_ge.navkeys[1]){$("#pData","#"+frmtb+"_2").trigger("click");return false;}
if(e.which==rp_ge.navkeys[2]){$("#nData","#"+frmtb+"_2").trigger("click");return false;}}});if(p.checkOnUpdate){$("a.ui-jqdialog-titlebar-close span","#"+IDs.themodal).removeClass("jqmClose");$("a.ui-jqdialog-titlebar-close","#"+IDs.themodal).unbind("click").click(function(){if(!checkUpdates())return false;hideModal("#"+IDs.themodal,{gb:"#gbox_"+gID,jqm:p.jqModal,onClose:rp_ge.onClose});return false;});}
p.saveicon=$.extend([true,"left","ui-icon-disk"],p.saveicon);p.closeicon=$.extend([true,"left","ui-icon-close"],p.closeicon);if(p.saveicon[0]==true){$("#sData","#"+frmtb+"_2").addClass(p.saveicon[1]=="right"?'fm-button-icon-right':'fm-button-icon-left').append("<span class='ui-icon "+p.saveicon[2]+"'></span>");}
if(p.closeicon[0]==true){$("#cData","#"+frmtb+"_2").addClass(p.closeicon[1]=="right"?'fm-button-icon-right':'fm-button-icon-left').append("<span class='ui-icon "+p.closeicon[2]+"'></span>");}
if(rp_ge.checkOnSubmit||rp_ge.checkOnUpdate){bS="<a href='javascript:void(0)' id='sNew' class='fm-button ui-state-default ui-corner-all' style='z-index:1002'>"+p.bYes+"</a>";bN="<a href='javascript:void(0)' id='nNew' class='fm-button ui-state-default ui-corner-all' style='z-index:1002'>"+p.bNo+"</a>";bC="<a href='javascript:void(0)' id='cNew' class='fm-button ui-state-default ui-corner-all' style='z-index:1002'>"+p.bExit+"</a>";var ii,zI=p.zIndex||999;zI++;if($.browser.msie&&$.browser.version==6){ii='<iframe style="display:block;position:absolute;z-index:-1;filter:Alpha(Opacity=\'0\');" src="javascript:false;"></iframe>';}else{ii="";}
$("<div class='ui-widget-overlay jqgrid-overlay confirm' style='z-index:"+zI+";display:none;'>&#160;"+ii+"</div><div class='confirm ui-widget-content ui-jqconfirm' style='z-index:"+(zI+1)+"'>"+p.saveData+"<br/><br/>"+bS+bN+bC+"</div>").insertAfter("#"+frmgr);$("#sNew","#"+IDs.themodal).click(function(){postIt();$("#"+frmgr).data("disabled",false);$(".confirm","#"+IDs.themodal).hide();return false;});$("#nNew","#"+IDs.themodal).click(function(){$(".confirm","#"+IDs.themodal).hide();$("#"+frmgr).data("disabled",false);setTimeout(function(){$(":input","#"+frmgr)[0].focus();},0);return false;});$("#cNew","#"+IDs.themodal).click(function(){$(".confirm","#"+IDs.themodal).hide();$("#"+frmgr).data("disabled",false);hideModal("#"+IDs.themodal,{gb:"#gbox_"+gID,jqm:p.jqModal,onClose:rp_ge.onClose});return false;});}
if(onInitializeForm){onInitializeForm($("#"+frmgr));}
if(rowid=="_empty"||!rp_ge.viewPagerButtons){$("#pData,#nData","#"+frmtb+"_2").hide();}else{$("#pData,#nData","#"+frmtb+"_2").show();}
if(onBeforeShow){onBeforeShow($("#"+frmgr));}
$("#"+IDs.themodal).data("onClose",rp_ge.onClose);viewModal("#"+IDs.themodal,{gbox:"#gbox_"+gID,jqm:p.jqModal,closeoverlay:closeovrl,modal:p.modal});if(!closeovrl){$(".jqmOverlay").click(function(){if(!checkUpdates())return false;hideModal("#"+IDs.themodal,{gb:"#gbox_"+gID,jqm:p.jqModal,onClose:rp_ge.onClose});return false;});}
if(onAfterShow){onAfterShow($("#"+frmgr));}
$(".fm-button","#"+IDs.themodal).hover(function(){$(this).addClass('ui-state-hover');},function(){$(this).removeClass('ui-state-hover');});$("#sData","#"+frmtb+"_2").click(function(e){postdata={};extpost={};$("#FormError","#"+frmtb).hide();getFormData();if(postdata[$t.p.id+"_id"]=="_empty")postIt();else if(p.checkOnSubmit===true){newData=$.extend({},postdata,extpost);diff=compareData(newData,rp_ge._savedData);if(diff){$("#"+frmgr).data("disabled",true);$(".confirm","#"+IDs.themodal).show();}else{postIt();}}else{postIt();}
return false;});$("#cData","#"+frmtb+"_2").click(function(e){if(!checkUpdates())return false;hideModal("#"+IDs.themodal,{gb:"#gbox_"+gID,jqm:p.jqModal,onClose:rp_ge.onClose});return false;});$("#nData","#"+frmtb+"_2").click(function(e){if(!checkUpdates())return false;$("#FormError","#"+frmtb).hide();var npos=getCurrPos();npos[0]=parseInt(npos[0]);if(npos[0]!=-1&&npos[1][npos[0]+1]){if($.isFunction(p.onclickPgButtons)){p.onclickPgButtons('next',$("#"+frmgr),npos[1][npos[0]]);}
fillData(npos[1][npos[0]+1],$t,frmgr);$($t).jqGrid("setSelection",npos[1][npos[0]+1]);if($.isFunction(p.afterclickPgButtons)){p.afterclickPgButtons('next',$("#"+frmgr),npos[1][npos[0]+1]);}
updateNav(npos[0]+1,npos[1].length-1);};return false;});$("#pData","#"+frmtb+"_2").click(function(e){if(!checkUpdates())return false;$("#FormError","#"+frmtb).hide();var ppos=getCurrPos();if(ppos[0]!=-1&&ppos[1][ppos[0]-1]){if($.isFunction(p.onclickPgButtons)){p.onclickPgButtons('prev',$("#"+frmgr),ppos[1][ppos[0]]);}
fillData(ppos[1][ppos[0]-1],$t,frmgr);$($t).jqGrid("setSelection",ppos[1][ppos[0]-1]);if($.isFunction(p.afterclickPgButtons)){p.afterclickPgButtons('prev',$("#"+frmgr),ppos[1][ppos[0]-1]);}
updateNav(ppos[0]-1,ppos[1].length-1);};return false;});}
var posInit=getCurrPos();updateNav(posInit[0],posInit[1].length-1);function updateNav(cr,totr,rid){if(cr==0){$("#pData","#"+frmtb+"_2").addClass('ui-state-disabled');}else{$("#pData","#"+frmtb+"_2").removeClass('ui-state-disabled');}
if(cr==totr){$("#nData","#"+frmtb+"_2").addClass('ui-state-disabled');}else{$("#nData","#"+frmtb+"_2").removeClass('ui-state-disabled');}}
function getCurrPos(){var rowsInGrid=$($t).jqGrid("getDataIDs"),selrow=$("#id_g","#"+frmtb).val(),pos=$.inArray(selrow,rowsInGrid);return[pos,rowsInGrid];}
function checkUpdates(){var stat=true;$("#FormError","#"+frmtb).hide();if(rp_ge.checkOnUpdate){postdata={};extpost={};getFormData();newData=$.extend({},postdata,extpost);diff=compareData(newData,rp_ge._savedData);if(diff){$("#"+frmgr).data("disabled",true);$(".confirm","#"+IDs.themodal).show();stat=false;}}
return stat;}
function getFormData(){$(".FormElement","#"+frmtb).each(function(i){var celm=$(".customelement",this);if(celm.length){var elem=celm[0],nm=elem.name;$.each($t.p.colModel,function(i,n){if(this.name==nm&&this.editoptions&&$.isFunction(this.editoptions.custom_value)){try{postdata[nm]=this.editoptions.custom_value($("#"+nm,"#"+frmtb),'get');if(postdata[nm]===undefined)throw"e1";}catch(e){if(e=="e1")info_dialog(jQuery.jgrid.errors.errcap,"function 'custom_value' "+$.jgrid.edit.msg.novalue,jQuery.jgrid.edit.bClose);else info_dialog(jQuery.jgrid.errors.errcap,e.message,jQuery.jgrid.edit.bClose);}
return true;}});}else{switch($(this).get(0).type){case"checkbox":if($(this).attr("checked")){postdata[this.name]=$(this).val();}else{var ofv=$(this).attr("offval");postdata[this.name]=ofv;}
break;case"select-one":postdata[this.name]=$("option:selected",this).val();extpost[this.name]=$("option:selected",this).text();break;case"select-multiple":postdata[this.name]=$(this).val();if(postdata[this.name])postdata[this.name]=postdata[this.name].join(",");else postdata[this.name]="";var selectedText=[];$("option:selected",this).each(function(i,selected){selectedText[i]=$(selected).text();});extpost[this.name]=selectedText.join(",");break;case"password":case"text":case"textarea":case"button":postdata[this.name]=$(this).val();break;}
if($t.p.autoencode)postdata[this.name]=$.jgrid.htmlEncode(postdata[this.name]);}});return true;}
function createData(rowid,obj,tb,maxcols){var nm,hc,trdata,cnt=0,tmp,dc,elc,retpos=[],ind=false,rp,cp,tdtmpl="<td class='CaptionTD ui-widget-content'>&#160;</td><td class='DataTD ui-widget-content' style='white-space:pre'>&#160;</td>",tmpl="";for(var i=1;i<=maxcols;i++){tmpl+=tdtmpl;}
if(rowid!='_empty'){ind=$(obj).jqGrid("getInd",rowid);}
$(obj.p.colModel).each(function(i){nm=this.name;if(this.editrules&&this.editrules.edithidden==true){hc=false;}else{hc=this.hidden===true?true:false;}
dc=hc?"style='display:none'":"";if(nm!=='cb'&&nm!=='subgrid'&&this.editable===true&&nm!=='rn'){if(ind===false){tmp="";}else{if(nm==obj.p.ExpandColumn&&obj.p.treeGrid===true){tmp=$("td:eq("+i+")",obj.rows[ind]).text();}else{try{tmp=$.unformat($("td:eq("+i+")",obj.rows[ind]),{rowId:rowid,colModel:this},i);}catch(_){tmp=$("td:eq("+i+")",obj.rows[ind]).html();}}}
var opt=$.extend({},this.editoptions||{},{id:nm,name:nm});frmopt=$.extend({},{elmprefix:'',elmsuffix:'',rowabove:false,rowcontent:''},this.formoptions||{}),rp=parseInt(frmopt.rowpos)||cnt+1,cp=parseInt((parseInt(frmopt.colpos)||1)*2);if(rowid=="_empty"&&opt.defaultValue){tmp=$.isFunction(opt.defaultValue)?opt.defaultValue():opt.defaultValue;}
if(!this.edittype)this.edittype="text";if($t.p.autoencode)tmp=$.jgrid.htmlDecode(tmp);elc=createEl(this.edittype,opt,tmp,false,$.extend({},$.jgrid.ajaxOptions,obj.p.ajaxSelectOptions||{}));if(tmp==""&&this.edittype=="checkbox"){tmp=$(elc).attr("offval");}
if(rp_ge.checkOnSubmit||rp_ge.checkOnUpdate)rp_ge._savedData[nm]=tmp;$(elc).addClass("FormElement");trdata=$(tb).find("tr[rowpos="+rp+"]");if(frmopt.rowabove){var newdata=$("<tr><td class='contentinfo' colspan='"+(maxcols*2)+"'>"+frmopt.rowcontent+"</td></tr>");$(tb).append(newdata);newdata[0].rp=rp;}
if(trdata.length==0){trdata=$("<tr "+dc+" rowpos='"+rp+"'></tr>").addClass("FormData").attr("id","tr_"+nm);$(trdata).append(tmpl);$(tb).append(trdata);trdata[0].rp=rp;}
$("td:eq("+(cp-2)+")",trdata[0]).html(typeof frmopt.label==='undefined'?obj.p.colNames[i]:frmopt.label);$("td:eq("+(cp-1)+")",trdata[0]).append(frmopt.elmprefix).append(elc).append(frmopt.elmsuffix);retpos[cnt]=i;cnt++;};});if(cnt>0){var idrow=$("<tr class='FormData' style='display:none'><td class='CaptionTD'></td><td colspan='"+(maxcols*2-1)+"' class='DataTD'><input class='FormElement' id='id_g' type='text' name='"+obj.p.id+"_id' value='"+rowid+"'/></td></tr>");idrow[0].rp=cnt+999;$(tb).append(idrow);if(rp_ge.checkOnSubmit||rp_ge.checkOnUpdate)rp_ge._savedData.id=rowid;}
return retpos;}
function fillData(rowid,obj,fmid){var nm,hc,cnt=0,tmp,fld,opt,vl,vlc;if(rp_ge.checkOnSubmit||rp_ge.checkOnUpdate){rp_ge._savedData={};rp_ge._savedData.id=rowid;}
var cm=obj.p.colModel;if(rowid=='_empty'){$(cm).each(function(i){nm=this.name;opt=$.extend({},this.editoptions||{});fld=$("#"+$.jgrid.jqID(nm),"#"+fmid);if(fld[0]!=null){vl="";if(opt.defaultValue){vl=$.isFunction(opt.defaultValue)?opt.defaultValue():opt.defaultValue;if(fld[0].type=='checkbox'){vlc=vl.toLowerCase();if(vlc.search(/(false|0|no|off|undefined)/i)<0&&vlc!==""){fld[0].checked=true;fld[0].defaultChecked=true;fld[0].value=vl;}else{fld.attr({checked:"",defaultChecked:""});}}else{fld.val(vl);}}else{if(fld[0].type=='checkbox'){fld[0].checked=false;fld[0].defaultChecked=false;vl=$(fld).attr("offval");}else if(fld[0].type.substr(0,6)=='select'){fld[0].selectedIndex=0;}else{fld.val(vl);}}
if(rp_ge.checkOnSubmit===true||rp_ge.checkOnUpdate)rp_ge._savedData[nm]=vl;}});$("#id_g","#"+fmid).val(rowid);return;}
var tre=$(obj).jqGrid("getInd",rowid,true);if(!tre)return;$('td',tre).each(function(i){nm=cm[i].name;if(nm!=='cb'&&nm!=='subgrid'&&nm!=='rn'&&cm[i].editable===true){if(nm==obj.p.ExpandColumn&&obj.p.treeGrid===true){tmp=$(this).text();}else{try{tmp=$.unformat(this,{rowId:rowid,colModel:cm[i]},i);}catch(_){tmp=$(this).html();}}
if($t.p.autoencode)tmp=$.jgrid.htmlDecode(tmp);if(rp_ge.checkOnSubmit===true||rp_ge.checkOnUpdate)rp_ge._savedData[nm]=tmp;nm=$.jgrid.jqID(nm);switch(cm[i].edittype){case"password":case"text":case"button":case"image":$("#"+nm,"#"+fmid).val(tmp);break;case"textarea":if(tmp=="&nbsp;"||tmp=="&#160;"||(tmp.length==1&&tmp.charCodeAt(0)==160)){tmp='';}
$("#"+nm,"#"+fmid).val(tmp);break;case"select":var opv=tmp.split(",");opv=$.map(opv,function(n){return $.trim(n)});$("#"+nm+" option","#"+fmid).each(function(j){if(!cm[i].editoptions.multiple&&(opv[0]==$(this).text()||opv[0]==$(this).val())){this.selected=true;}else if(cm[i].editoptions.multiple){if($.inArray($(this).text(),opv)>-1||$.inArray($(this).val(),opv)>-1){this.selected=true;}else{this.selected=false;}}else{this.selected=false;}});break;case"checkbox":tmp=tmp+"";tmp=tmp.toLowerCase();if(tmp.search(/(false|0|no|off|undefined)/i)<0&&tmp!==""){$("#"+nm,"#"+fmid).attr("checked",true);$("#"+nm,"#"+fmid).attr("defaultChecked",true);}else{$("#"+nm,"#"+fmid).attr("checked",false);$("#"+nm,"#"+fmid).attr("defaultChecked","");}
break;case'custom':try{if(cm[i].editoptions&&$.isFunction(cm[i].editoptions.custom_value)){var dummy=cm[i].editoptions.custom_value($("#"+nm,"#"+fmid),'set',tmp);}else throw"e1";}catch(e){if(e=="e1")info_dialog(jQuery.jgrid.errors.errcap,"function 'custom_value' "+$.jgrid.edit.msg.nodefined,jQuery.jgrid.edit.bClose);else info_dialog(jQuery.jgrid.errors.errcap,e.message,jQuery.jgrid.edit.bClose);}
break;}
cnt++;}});if(cnt>0){$("#id_g","#"+frmtb).val(rowid);}}
function postIt(){var copydata,ret=[true,"",""],onCS={},opers=$t.p.prmNames,idname,oper;if($.isFunction(rp_ge.beforeCheckValues)){var retvals=rp_ge.beforeCheckValues(postdata,$("#"+frmgr),postdata[$t.p.id+"_id"]=="_empty"?opers.addoper:opers.editoper);if(retvals&&typeof(retvals)==='object')postdata=retvals;}
for(var key in postdata){ret=checkValues(postdata[key],key,$t);if(ret[0]==false)break;}
if(ret[0]){if($.isFunction(rp_ge.onclickSubmit)){onCS=rp_ge.onclickSubmit(rp_ge,postdata)||{};}
if($.isFunction(rp_ge.beforeSubmit)){ret=rp_ge.beforeSubmit(postdata,$("#"+frmgr));}}
gurl=rp_ge.url?rp_ge.url:$($t).jqGrid('getGridParam','editurl');if(ret[0]){if(!gurl){ret[0]=false;ret[1]+=" "+$.jgrid.errors.nourl;}}
if(ret[0]===false){$("#FormError>td","#"+frmtb).html(ret[1]);$("#FormError","#"+frmtb).show();return;}
if(!rp_ge.processing){rp_ge.processing=true;$("#sData","#"+frmtb+"_2").addClass('ui-state-active');oper=opers.oper;idname=opers.id;postdata[oper]=($.trim(postdata[$t.p.id+"_id"])=="_empty")?opers.addoper:opers.editoper;if(postdata[oper]!=opers.addoper)
postdata[idname]=postdata[$t.p.id+"_id"];else{if(postdata[idname]===undefined)postdata[idname]=postdata[$t.p.id+"_id"];}
delete postdata[$t.p.id+"_id"];postdata=$.extend(postdata,rp_ge.editData,onCS);$.ajax($.extend({url:gurl,type:rp_ge.mtype,data:$.isFunction(rp_ge.serializeEditData)?rp_ge.serializeEditData(postdata):postdata,complete:function(data,Status){if(Status!="success"){ret[0]=false;if($.isFunction(rp_ge.errorTextFormat)){ret[1]=rp_ge.errorTextFormat(data);}else{ret[1]=Status+" Status: '"+data.statusText+"'. Error code: "+data.status;}}else{if($.isFunction(rp_ge.afterSubmit)){ret=rp_ge.afterSubmit(data,postdata);}}
if(ret[0]===false){$("#FormError>td","#"+frmtb).html(ret[1]);$("#FormError","#"+frmtb).show();}else{$.each($t.p.colModel,function(i,n){if(extpost[this.name]&&this.formatter&&this.formatter=='select'){try{delete extpost[this.name];}catch(e){}}});postdata=$.extend(postdata,extpost);if($t.p.autoencode){$.each(postdata,function(n,v){postdata[n]=$.jgrid.htmlDecode(v);});}
if(postdata[oper]==opers.addoper){if(!ret[2]){ret[2]=parseInt($t.p.records)+1;}
postdata[idname]=ret[2];if(rp_ge.closeAfterAdd){if(rp_ge.reloadAfterSubmit){$($t).trigger("reloadGrid");}
else{$($t).jqGrid("addRowData",ret[2],postdata,p.addedrow);$($t).jqGrid("setSelection",ret[2]);}
hideModal("#"+IDs.themodal,{gb:"#gbox_"+gID,jqm:p.jqModal,onClose:rp_ge.onClose});}else if(rp_ge.clearAfterAdd){if(rp_ge.reloadAfterSubmit){$($t).trigger("reloadGrid");}
else{$($t).jqGrid("addRowData",ret[2],postdata,p.addedrow);}
fillData("_empty",$t,frmgr);}else{if(rp_ge.reloadAfterSubmit){$($t).trigger("reloadGrid");}
else{$($t).jqGrid("addRowData",ret[2],postdata,p.addedrow);}}}else{if(rp_ge.reloadAfterSubmit){$($t).trigger("reloadGrid");if(!rp_ge.closeAfterEdit){setTimeout(function(){$($t).jqGrid("setSelection",postdata[idname]);},1000);}}else{if($t.p.treeGrid===true){$($t).jqGrid("setTreeRow",postdata[idname],postdata);}else{$($t).jqGrid("setRowData",postdata[idname],postdata);}}
if(rp_ge.closeAfterEdit){hideModal("#"+IDs.themodal,{gb:"#gbox_"+gID,jqm:p.jqModal,onClose:rp_ge.onClose});}}
if($.isFunction(rp_ge.afterComplete)){copydata=data;setTimeout(function(){rp_ge.afterComplete(copydata,postdata,$("#"+frmgr));copydata=null;},500);}}
rp_ge.processing=false;if(rp_ge.checkOnSubmit||rp_ge.checkOnUpdate){$("#"+frmgr).data("disabled",false);if(rp_ge._savedData.id!="_empty")rp_ge._savedData=postdata;}
$("#sData","#"+frmtb+"_2").removeClass('ui-state-active');try{$(':input:visible',"#"+frmgr)[0].focus();}catch(e){}},error:function(xhr,st,err){$("#FormError>td","#"+frmtb).html(st+" : "+err);$("#FormError","#"+frmtb).show();rp_ge.processing=false;$("#"+frmgr).data("disabled",false);$("#sData","#"+frmtb+"_2").removeClass('ui-state-active');}},$.jgrid.ajaxOptions,rp_ge.ajaxEditOptions));}}
function compareData(nObj,oObj){var ret=false,key;for(key in nObj){if(nObj[key]!=oObj[key]){ret=true;break;}}
return ret;}});},viewGridRow:function(rowid,p){p=$.extend({top:0,left:0,width:0,height:'auto',dataheight:'auto',modal:false,drag:true,resize:true,jqModal:true,closeOnEscape:false,labelswidth:'30%',closeicon:[],navkeys:[false,38,40],onClose:null,beforeShowForm:null,viewPagerButtons:true},$.jgrid.view,p||{});return this.each(function(){var $t=this;if(!$t.grid||!rowid){return;}
if(!p.imgpath){p.imgpath=$t.p.imgpath;}
var gID=$t.p.id,frmgr="ViewGrid_"+gID,frmtb="ViewTbl_"+gID,IDs={themodal:'viewmod'+gID,modalhead:'viewhd'+gID,modalcontent:'viewcnt'+gID,scrollelm:frmgr},maxCols=1,maxRows=0;if($("#"+IDs.themodal).html()!=null){$(".ui-jqdialog-title","#"+IDs.modalhead).html(p.caption);$("#FormError","#"+frmtb).hide();fillData(rowid,$t);if($.isFunction(p.beforeShowForm))p.beforeShowForm($("#"+frmgr));viewModal("#"+IDs.themodal,{gbox:"#gbox_"+gID,jqm:p.jqModal,jqM:false,modal:p.modal});focusaref();}else{$($t.p.colModel).each(function(i){var fmto=this.formoptions;maxCols=Math.max(maxCols,fmto?fmto.colpos||0:0);maxRows=Math.max(maxRows,fmto?fmto.rowpos||0:0);});var dh=isNaN(p.dataheight)?p.dataheight:p.dataheight+"px";var flr,frm=$("<form name='FormPost' id='"+frmgr+"' class='FormGrid' style='width:100%;overflow:auto;position:relative;height:"+dh+";'></form>"),tbl=$("<table id='"+frmtb+"' class='EditTable' cellspacing='1' cellpading='2' border='0' style='table-layout:fixed'><tbody></tbody></table>");$(frm).append(tbl);var valref=createData(rowid,$t,tbl,maxCols),rtlb=$t.p.direction=="rtl"?true:false,bp=rtlb?"nData":"pData",bn=rtlb?"pData":"nData",bP="<a href='javascript:void(0)' id='"+bp+"' class='fm-button ui-state-default ui-corner-left'><span class='ui-icon ui-icon-triangle-1-w'></span></div>",bN="<a href='javascript:void(0)' id='"+bn+"' class='fm-button ui-state-default ui-corner-right'><span class='ui-icon ui-icon-triangle-1-e'></span></div>",bC="<a href='javascript:void(0)' id='cData' class='fm-button ui-state-default ui-corner-all'>"+p.bClose+"</a>";if(maxRows>0){var sd=[];$.each($(tbl)[0].rows,function(i,r){sd[i]=r;});sd.sort(function(a,b){if(a.rp>b.rp){return 1;}
if(a.rp<b.rp){return-1;}
return 0;});$.each(sd,function(index,row){$('tbody',tbl).append(row);});}
p.gbox="#gbox_"+gID;var cle=false;if(p.closeOnEscape===true){p.closeOnEscape=false;cle=true;}
var bt=$("<span></span>").append(frm).append("<table border='0' class='EditTable' id='"+frmtb+"_2'><tbody><tr id='Act_Buttons'><td class='navButton ui-widget-content' width='"+p.labelswidth+"'>"+(rtlb?bN+bP:bP+bN)+"</td><td class='EditButton ui-widget-content'>"+bC+"</td></tr></tbody></table>");createModal(IDs,bt,p,"#gview_"+$t.p.id,$("#gview_"+$t.p.id)[0]);if(rtlb){$("#pData, #nData","#"+frmtb+"_2").css("float","right");$(".EditButton","#"+frmtb+"_2").css("text-align","left");}
if(!p.viewPagerButtons)$("#pData, #nData","#"+frmtb+"_2").hide();bt=null;$("#"+IDs.themodal).keydown(function(e){if(e.which===27){if(cle)hideModal(this,{gb:p.gbox,jqm:p.jqModal,onClose:p.onClose});return false;}
if(p.navkeys[0]===true){if(e.which===p.navkeys[1]){$("#pData","#"+frmtb+"_2").trigger("click");return false;}
if(e.which===p.navkeys[2]){$("#nData","#"+frmtb+"_2").trigger("click");return false;}}});p.closeicon=$.extend([true,"left","ui-icon-close"],p.closeicon);if(p.closeicon[0]==true){$("#cData","#"+frmtb+"_2").addClass(p.closeicon[1]=="right"?'fm-button-icon-right':'fm-button-icon-left').append("<span class='ui-icon "+p.closeicon[2]+"'></span>");}
if($.isFunction(p.beforeShowForm))p.beforeShowForm($("#"+frmgr));viewModal("#"+IDs.themodal,{gbox:"#gbox_"+gID,jqm:p.jqModal,modal:p.modal});$(".fm-button:not(.ui-state-disabled)","#"+frmtb+"_2").hover(function(){$(this).addClass('ui-state-hover');},function(){$(this).removeClass('ui-state-hover');});focusaref();$("#cData","#"+frmtb+"_2").click(function(e){hideModal("#"+IDs.themodal,{gb:"#gbox_"+gID,jqm:p.jqModal,onClose:p.onClose});return false;});$("#nData","#"+frmtb+"_2").click(function(e){$("#FormError","#"+frmtb).hide();var npos=getCurrPos();npos[0]=parseInt(npos[0]);if(npos[0]!=-1&&npos[1][npos[0]+1]){if($.isFunction(p.onclickPgButtons)){p.onclickPgButtons('next',$("#"+frmgr),npos[1][npos[0]]);}
fillData(npos[1][npos[0]+1],$t);$($t).jqGrid("setSelection",npos[1][npos[0]+1]);if($.isFunction(p.afterclickPgButtons)){p.afterclickPgButtons('next',$("#"+frmgr),npos[1][npos[0]+1]);}
updateNav(npos[0]+1,npos[1].length-1);};focusaref();return false;});$("#pData","#"+frmtb+"_2").click(function(e){$("#FormError","#"+frmtb).hide();var ppos=getCurrPos();if(ppos[0]!=-1&&ppos[1][ppos[0]-1]){if($.isFunction(p.onclickPgButtons)){p.onclickPgButtons('prev',$("#"+frmgr),ppos[1][ppos[0]]);}
fillData(ppos[1][ppos[0]-1],$t);$($t).jqGrid("setSelection",ppos[1][ppos[0]-1]);if($.isFunction(p.afterclickPgButtons)){p.afterclickPgButtons('prev',$("#"+frmgr),ppos[1][ppos[0]-1]);}
updateNav(ppos[0]-1,ppos[1].length-1);};focusaref();return false;});};function focusaref(){if(p.closeOnEscape===true||p.navkeys[0]===true){setTimeout(function(){$(".ui-jqdialog-titlebar-close","#"+IDs.modalhead).focus()},0);}}
var posInit=getCurrPos();updateNav(posInit[0],posInit[1].length-1);function updateNav(cr,totr,rid){if(cr==0){$("#pData","#"+frmtb+"_2").addClass('ui-state-disabled');}else{$("#pData","#"+frmtb+"_2").removeClass('ui-state-disabled');}
if(cr==totr){$("#nData","#"+frmtb+"_2").addClass('ui-state-disabled');}else{$("#nData","#"+frmtb+"_2").removeClass('ui-state-disabled');}}
function getCurrPos(){var rowsInGrid=$($t).jqGrid("getDataIDs"),selrow=$("#id_g","#"+frmtb).val(),pos=$.inArray(selrow,rowsInGrid);return[pos,rowsInGrid];}
function createData(rowid,obj,tb,maxcols){var nm,hc,trdata,tdl,tde,cnt=0,tmp,dc,retpos=[],ind=false,tdtmpl="<td class='CaptionTD form-view-label ui-widget-content' width='"+p.labelswidth+"'>&#160;</td><td class='DataTD form-view-data ui-helper-reset ui-widget-content'>&#160;</td>",tmpl="",tdtmpl2="<td class='CaptionTD form-view-label ui-widget-content'>&#160;</td><td class='DataTD form-view-data ui-widget-content'>&#160;</td>",fmtnum=['integer','number','currency'],max1=0,max2=0,maxw,setme,viewfld;for(var i=1;i<=maxcols;i++){tmpl+=i==1?tdtmpl:tdtmpl2;}
$(obj.p.colModel).each(function(i){if(this.editrules&&this.editrules.edithidden===true){hc=false;}else{hc=this.hidden===true?true:false;}
if(!hc&&this.align==='right'){if(this.formatter&&$.inArray(this.formatter,fmtnum)!==-1){max1=Math.max(max1,parseInt(this.width,10));}else{max2=Math.max(max2,parseInt(this.width,10));}}});maxw=max1!==0?max1:max2!==0?max2:0;ind=$(obj).jqGrid("getInd",rowid);$(obj.p.colModel).each(function(i){nm=this.name;setme=false;if(this.editrules&&this.editrules.edithidden===true){hc=false;}else{hc=this.hidden===true?true:false;}
dc=hc?"style='display:none'":"";viewfld=(typeof this.viewable!='boolean')?true:this.viewable;if(nm!=='cb'&&nm!=='subgrid'&&nm!=='rn'&&viewfld){if(ind===false){tmp="";}else{if(nm==obj.p.ExpandColumn&&obj.p.treeGrid===true){tmp=$("td:eq("+i+")",obj.rows[ind]).text();}else{tmp=$("td:eq("+i+")",obj.rows[ind]).html();}}
setme=this.align==='right'&&maxw!==0?true:false;var opt=$.extend({},this.editoptions||{},{id:nm,name:nm}),frmopt=$.extend({},{rowabove:false,rowcontent:''},this.formoptions||{}),rp=parseInt(frmopt.rowpos)||cnt+1,cp=parseInt((parseInt(frmopt.colpos)||1)*2);if(frmopt.rowabove){var newdata=$("<tr><td class='contentinfo' colspan='"+(maxcols*2)+"'>"+frmopt.rowcontent+"</td></tr>");$(tb).append(newdata);newdata[0].rp=rp;}
trdata=$(tb).find("tr[rowpos="+rp+"]");if(trdata.length==0){trdata=$("<tr "+dc+" rowpos='"+rp+"'></tr>").addClass("FormData").attr("id","trv_"+nm);$(trdata).append(tmpl);$(tb).append(trdata);trdata[0].rp=rp;}
$("td:eq("+(cp-2)+")",trdata[0]).html('<b>'+(typeof frmopt.label==='undefined'?obj.p.colNames[i]:frmopt.label)+'</b>');$("td:eq("+(cp-1)+")",trdata[0]).append("<span>"+tmp+"</span>").attr("id","v_"+nm);if(setme){$("td:eq("+(cp-1)+") span",trdata[0]).css({'text-align':'right',width:maxw+"px"});}
retpos[cnt]=i;cnt++;};});if(cnt>0){var idrow=$("<tr class='FormData' style='display:none'><td class='CaptionTD'></td><td colspan='"+(maxcols*2-1)+"' class='DataTD'><input class='FormElement' id='id_g' type='text' name='id' value='"+rowid+"'/></td></tr>");idrow[0].rp=cnt+99;$(tb).append(idrow);}
return retpos;};function fillData(rowid,obj){var nm,hc,cnt=0,tmp,opt,trv;trv=$(obj).jqGrid("getInd",rowid,true);if(!trv)return;$('td',trv).each(function(i){nm=obj.p.colModel[i].name;if(obj.p.colModel[i].editrules&&obj.p.colModel[i].editrules.edithidden===true){hc=false;}else{hc=obj.p.colModel[i].hidden===true?true:false;}
if(nm!=='cb'&&nm!=='subgrid'&&nm!=='rn'){if(nm==obj.p.ExpandColumn&&obj.p.treeGrid===true){tmp=$(this).text();}else{tmp=$(this).html();}
opt=$.extend({},obj.p.colModel[i].editoptions||{});nm=$.jgrid.jqID("v_"+nm);$("#"+nm+" span","#"+frmtb).html(tmp);if(hc){$("#"+nm,"#"+frmtb).parents("tr:first").hide();}
cnt++;}});if(cnt>0){$("#id_g","#"+frmtb).val(rowid);}};});},delGridRow:function(rowids,p){p=$.extend({top:0,left:0,width:240,height:'auto',dataheight:'auto',modal:false,drag:true,resize:true,url:'',mtype:"POST",reloadAfterSubmit:true,beforeShowForm:null,afterShowForm:null,beforeSubmit:null,onclickSubmit:null,afterSubmit:null,jqModal:true,closeOnEscape:false,delData:{},delicon:[],cancelicon:[],onClose:null,ajaxDelOptions:{},processing:false,serializeDelData:null},$.jgrid.del,p||{});rp_ge=p;return this.each(function(){var $t=this;if(!$t.grid){return;}
if(!rowids){return;}
var onBeforeShow=typeof p.beforeShowForm==='function'?true:false,onAfterShow=typeof p.afterShowForm==='function'?true:false,gID=$t.p.id,onCS={},dtbl="DelTbl_"+gID,postd,idname,opers,oper,IDs={themodal:'delmod'+gID,modalhead:'delhd'+gID,modalcontent:'delcnt'+gID,scrollelm:dtbl};if(isArray(rowids)){rowids=rowids.join();}
if($("#"+IDs.themodal).html()!=null){$("#DelData>td","#"+dtbl).text(rowids);$("#DelError","#"+dtbl).hide();if(rp_ge.processing===true){rp_ge.processing=false;$("#dData","#"+dtbl).removeClass('ui-state-active');}
if(onBeforeShow){p.beforeShowForm($("#"+dtbl));}
viewModal("#"+IDs.themodal,{gbox:"#gbox_"+gID,jqm:p.jqModal,jqM:false,modal:p.modal});if(onAfterShow){p.afterShowForm($("#"+dtbl));}}else{var dh=isNaN(p.dataheight)?p.dataheight:p.dataheight+"px";var tbl="<div id='"+dtbl+"' class='formdata' style='width:100%;overflow:auto;position:relative;height:"+dh+";'>";tbl+="<table class='DelTable'><tbody>";tbl+="<tr id='DelError' style='display:none'><td class='ui-state-error'></td></tr>";tbl+="<tr id='DelData' style='display:none'><td >"+rowids+"</td></tr>";tbl+="<tr><td class=\"delmsg\" style=\"white-space:pre;\">"+p.msg+"</td></tr><tr><td >&#160;</td></tr>";tbl+="</tbody></table></div>"
var bS="<a href='javascript:void(0)' id='dData' class='fm-button ui-state-default ui-corner-all'>"+p.bSubmit+"</a>",bC="<a href='javascript:void(0)' id='eData' class='fm-button ui-state-default ui-corner-all'>"+p.bCancel+"</a>";tbl+="<table cellspacing='0' cellpadding='0' border='0' class='EditTable' id='"+dtbl+"_2'><tbody><tr><td class='DataTD ui-widget-content'></td></tr><tr style='display:block;height:3px;'><td></td></tr><tr><td class='DelButton EditButton'>"+bS+"&#160;"+bC+"</td></tr></tbody></table>";p.gbox="#gbox_"+gID;createModal(IDs,tbl,p,"#gview_"+$t.p.id,$("#gview_"+$t.p.id)[0]);$(".fm-button","#"+dtbl+"_2").hover(function(){$(this).addClass('ui-state-hover');},function(){$(this).removeClass('ui-state-hover');});p.delicon=$.extend([true,"left","ui-icon-scissors"],p.delicon);p.cancelicon=$.extend([true,"left","ui-icon-cancel"],p.cancelicon);if(p.delicon[0]==true){$("#dData","#"+dtbl+"_2").addClass(p.delicon[1]=="right"?'fm-button-icon-right':'fm-button-icon-left').append("<span class='ui-icon "+p.delicon[2]+"'></span>");}
if(p.cancelicon[0]==true){$("#eData","#"+dtbl+"_2").addClass(p.cancelicon[1]=="right"?'fm-button-icon-right':'fm-button-icon-left').append("<span class='ui-icon "+p.cancelicon[2]+"'></span>");}
$("#dData","#"+dtbl+"_2").click(function(e){var ret=[true,""];onCS={};var postdata=$("#DelData>td","#"+dtbl).text();if(typeof p.onclickSubmit==='function'){onCS=p.onclickSubmit(rp_ge)||{};}
if(typeof p.beforeSubmit==='function'){ret=p.beforeSubmit(postdata);}
if(ret[0]){var gurl=rp_ge.url?rp_ge.url:$($t).jqGrid('getGridParam','editurl');if(!gurl){ret[0]=false;ret[1]+=" "+$.jgrid.errors.nourl;}}
if(ret[0]===false){$("#DelError>td","#"+dtbl).html(ret[1]);$("#DelError","#"+dtbl).show();}else{if(!rp_ge.processing){rp_ge.processing=true;$(this).addClass('ui-state-active');opers=$t.p.prmNames;postd=$.extend({},rp_ge.delData,onCS);oper=opers.oper;postd[oper]=opers.deloper;idname=opers.id;postd[idname]=postdata;$.ajax($.extend({url:gurl,type:p.mtype,data:$.isFunction(p.serializeDelData)?p.serializeDelData(postd):postd,complete:function(data,Status){if(Status!="success"){ret[0]=false;if($.isFunction(rp_ge.errorTextFormat)){ret[1]=rp_ge.errorTextFormat(data);}else{ret[1]=Status+" Status: '"+data.statusText+"'. Error code: "+data.status;}}else{if(typeof rp_ge.afterSubmit==='function'){ret=rp_ge.afterSubmit(data,postd);}}
if(ret[0]===false){$("#DelError>td","#"+dtbl).html(ret[1]);$("#DelError","#"+dtbl).show();}else{if(rp_ge.reloadAfterSubmit){$($t).trigger("reloadGrid");}else{var toarr=[];toarr=postdata.split(",");if($t.p.treeGrid===true){try{$($t).jqGrid("delTreeNode",toarr[0])}catch(e){}}else{for(var i=0;i<toarr.length;i++){$($t).jqGrid("delRowData",toarr[i]);}}
$t.p.selrow=null;$t.p.selarrrow=[];}
if($.isFunction(rp_ge.afterComplete)){setTimeout(function(){rp_ge.afterComplete(data,postdata);},500);}}
rp_ge.processing=false;$("#dData","#"+dtbl+"_2").removeClass('ui-state-active');if(ret[0]){hideModal("#"+IDs.themodal,{gb:"#gbox_"+gID,jqm:p.jqModal,onClose:rp_ge.onClose});}},error:function(xhr,st,err){$("#DelError>td","#"+dtbl).html(st+" : "+err);$("#DelError","#"+dtbl).show();rp_ge.processing=false;$("#dData","#"+dtbl+"_2").removeClass('ui-state-active');;}},$.jgrid.ajaxOptions,p.ajaxDelOptions));}}
return false;});$("#eData","#"+dtbl+"_2").click(function(e){hideModal("#"+IDs.themodal,{gb:"#gbox_"+gID,jqm:p.jqModal,onClose:rp_ge.onClose});return false;});if(onBeforeShow){p.beforeShowForm($("#"+dtbl));}
viewModal("#"+IDs.themodal,{gbox:"#gbox_"+gID,jqm:p.jqModal,modal:p.modal});if(onAfterShow){p.afterShowForm($("#"+dtbl));}}
if(p.closeOnEscape===true){setTimeout(function(){$(".ui-jqdialog-titlebar-close","#"+IDs.modalhead).focus()},0);}});},navGrid:function(elem,o,pEdit,pAdd,pDel,pSearch,pView){o=$.extend({edit:true,editicon:"ui-icon-pencil",add:true,addicon:"ui-icon-plus",del:true,delicon:"ui-icon-trash",search:true,searchicon:"ui-icon-search",refresh:true,refreshicon:"ui-icon-refresh",refreshstate:'firstpage',view:false,viewicon:"ui-icon-document",position:"left",closeOnEscape:true,beforeRefresh:null,afterRefresh:null,cloneToTop:false},$.jgrid.nav,o||{});return this.each(function(){var alertIDs={themodal:'alertmod',modalhead:'alerthd',modalcontent:'alertcnt'},$t=this,vwidth,vheight,twd,tdw;if(!$t.grid||typeof elem!='string'){return;}
if($("#"+alertIDs.themodal).html()==null){if(typeof window.innerWidth!='undefined'){vwidth=window.innerWidth,vheight=window.innerHeight}else if(typeof document.documentElement!='undefined'&&typeof document.documentElement.clientWidth!='undefined'&&document.documentElement.clientWidth!=0){vwidth=document.documentElement.clientWidth,vheight=document.documentElement.clientHeight}else{vwidth=1024;vheight=768;}
createModal(alertIDs,"<div>"+o.alerttext+"</div><span tabindex='0'><span tabindex='-1' id='jqg_alrt'></span></span>",{gbox:"#gbox_"+$t.p.id,jqModal:true,drag:true,resize:true,caption:o.alertcap,top:vheight/2-25,left:vwidth/2-100,width:200,height:'auto',closeOnEscape:o.closeOnEscape},"","",true);}
var clone=1;if(o.cloneToTop&&$t.p.toppager)clone=2;for(var i=0;i<clone;i++){var tbd,navtbl=$("<table cellspacing='0' cellpadding='0' border='0' class='ui-pg-table navtable' style='float:left;table-layout:auto;'><tbody><tr></tr></tbody></table>"),sep="<td class='ui-pg-button ui-state-disabled' style='width:4px;'><span class='ui-separator'></span></td>",pgid,elemids;if(i==0){pgid=elem;elemids=$t.p.id;if(pgid==$t.p.toppager){elemids+="_top";clone=1;}}else{pgid=$t.p.toppager;elemids=$t.p.id+"_top";}
if($t.p.direction=="rtl")$(navtbl).attr("dir","rtl").css("float","right");if(o.add){pAdd=pAdd||{};tbd=$("<td class='ui-pg-button ui-corner-all'></td>");$(tbd).append("<div class='ui-pg-div'><span class='ui-icon "+o.addicon+"'></span>"+o.addtext+"</div>");$("tr",navtbl).append(tbd);$(tbd,navtbl).attr({"title":o.addtitle||"",id:pAdd.id||"add_"+elemids}).click(function(){if(typeof o.addfunc=='function'){o.addfunc();}else{$($t).jqGrid("editGridRow","new",pAdd);}
return false;}).hover(function(){$(this).addClass("ui-state-hover");},function(){$(this).removeClass("ui-state-hover");});tbd=null;}
if(o.edit){tbd=$("<td class='ui-pg-button ui-corner-all'></td>");pEdit=pEdit||{};$(tbd).append("<div class='ui-pg-div'><span class='ui-icon "+o.editicon+"'></span>"+o.edittext+"</div>");$("tr",navtbl).append(tbd);$(tbd,navtbl).attr({"title":o.edittitle||"",id:pEdit.id||"edit_"+elemids}).click(function(){var sr=$t.p.selrow;if(sr){if(typeof o.editfunc=='function'){o.editfunc(sr);}else{$($t).jqGrid("editGridRow",sr,pEdit);}}else{viewModal("#"+alertIDs.themodal,{gbox:"#gbox_"+$t.p.id,jqm:true});$("#jqg_alrt").focus();}
return false;}).hover(function(){$(this).addClass("ui-state-hover");},function(){$(this).removeClass("ui-state-hover");});tbd=null;}
if(o.view){tbd=$("<td class='ui-pg-button ui-corner-all'></td>");pView=pView||{};$(tbd).append("<div class='ui-pg-div'><span class='ui-icon "+o.viewicon+"'></span>"+o.viewtext+"</div>");$("tr",navtbl).append(tbd);$(tbd,navtbl).attr({"title":o.viewtitle||"",id:pView.id||"view_"+elemids}).click(function(){var sr=$t.p.selrow;if(sr){$($t).jqGrid("viewGridRow",sr,pView);}else{viewModal("#"+alertIDs.themodal,{gbox:"#gbox_"+$t.p.id,jqm:true});$("#jqg_alrt").focus();}
return false;}).hover(function(){$(this).addClass("ui-state-hover");},function(){$(this).removeClass("ui-state-hover");});tbd=null;}
if(o.del){tbd=$("<td class='ui-pg-button ui-corner-all'></td>");pDel=pDel||{};$(tbd).append("<div class='ui-pg-div'><span class='ui-icon "+o.delicon+"'></span>"+o.deltext+"</div>");$("tr",navtbl).append(tbd);$(tbd,navtbl).attr({"title":o.deltitle||"",id:pDel.id||"del_"+elemids}).click(function(){var dr;if($t.p.multiselect){dr=$t.p.selarrrow;if(dr.length==0){dr=null;}}else{dr=$t.p.selrow;}
if(dr){$($t).jqGrid("delGridRow",dr,pDel);}
else{viewModal("#"+alertIDs.themodal,{gbox:"#gbox_"+$t.p.id,jqm:true});$("#jqg_alrt").focus();}
return false;}).hover(function(){$(this).addClass("ui-state-hover");},function(){$(this).removeClass("ui-state-hover");});tbd=null;}
if(o.add||o.edit||o.del||o.view){$("tr",navtbl).append(sep);}
if(o.search){tbd=$("<td class='ui-pg-button ui-corner-all'></td>");pSearch=pSearch||{};$(tbd).append("<div class='ui-pg-div'><span class='ui-icon "+o.searchicon+"'></span>"+o.searchtext+"</div>");$("tr",navtbl).append(tbd);$(tbd,navtbl).attr({"title":o.searchtitle||"",id:pSearch.id||"search_"+elemids}).click(function(){$($t).jqGrid("searchGrid",pSearch);return false;}).hover(function(){$(this).addClass("ui-state-hover");},function(){$(this).removeClass("ui-state-hover");});tbd=null;}
if(o.refresh){tbd=$("<td class='ui-pg-button ui-corner-all'></td>");$(tbd).append("<div class='ui-pg-div'><span class='ui-icon "+o.refreshicon+"'></span>"+o.refreshtext+"</div>");$("tr",navtbl).append(tbd);$(tbd,navtbl).attr({"title":o.refreshtitle||"",id:"refresh_"+elemids}).click(function(){if($.isFunction(o.beforeRefresh))o.beforeRefresh();$t.p.search=false;try{var gID=$t.p.id;$("#fbox_"+gID).searchFilter().reset();$t.clearToolbar(false);}catch(e){}
switch(o.refreshstate){case'firstpage':$($t).trigger("reloadGrid",[{page:1}]);break;case'current':$($t).trigger("reloadGrid",[{current:true}]);break;}
if($.isFunction(o.afterRefresh))o.afterRefresh();return false;}).hover(function(){$(this).addClass("ui-state-hover");},function(){$(this).removeClass("ui-state-hover");});tbd=null;}
tdw=$(".ui-jqgrid").css("font-size")||"11px";$('body').append("<div id='testpg2' class='ui-jqgrid ui-widget ui-widget-content' style='font-size:"+tdw+";visibility:hidden;' ></div>");twd=$(navtbl).clone().appendTo("#testpg2").width();$("#testpg2").remove();$(pgid+"_"+o.position,pgid).append(navtbl);if($t.p._nvtd){if(twd>$t.p._nvtd[0]){$(pgid+"_"+o.position,pgid).width(twd);$t.p._nvtd[0]=twd;}
$t.p._nvtd[1]=twd;}
tdw=null;twd=null;navtbl=null;}});},navButtonAdd:function(elem,p){p=$.extend({caption:"newButton",title:'',buttonicon:'ui-icon-newwin',onClickButton:null,position:"last",cursor:'pointer'},p||{});return this.each(function(){if(!this.grid){return;}
if(elem.indexOf("#")!=0){elem="#"+elem;}
var findnav=$(".navtable",elem)[0],$t=this;if(findnav){var tbd=$("<td></td>");$(tbd).addClass('ui-pg-button ui-corner-all').append("<div class='ui-pg-div'><span class='ui-icon "+p.buttonicon+"'></span>"+p.caption+"</div>");if(p.id){$(tbd).attr("id",p.id);}
if(p.position=='first'){if(findnav.rows[0].cells.length===0){$("tr",findnav).append(tbd);}else{$("tr td:eq(0)",findnav).before(tbd);}}else{$("tr",findnav).append(tbd);}
$(tbd,findnav).attr("title",p.title||"").click(function(e){if($.isFunction(p.onClickButton)){p.onClickButton.call($t,e);}
return false;}).hover(function(){$(this).addClass("ui-state-hover");},function(){$(this).removeClass("ui-state-hover");}).css("cursor",p.cursor?p.cursor:"normal");}});},navSeparatorAdd:function(elem,p){p=$.extend({sepclass:"ui-separator",sepcontent:''},p||{});return this.each(function(){if(!this.grid){return;}
if(elem.indexOf("#")!=0){elem="#"+elem;}
var findnav=$(".navtable",elem)[0];if(findnav){var sep="<td class='ui-pg-button ui-state-disabled' style='width:4px;'><span class='"+p.sepclass+"'></span>"+p.sepcontent+"</td>";$("tr",findnav).append(sep);}});},GridToForm:function(rowid,formid){return this.each(function(){var $t=this;if(!$t.grid){return;}
var rowdata=$($t).jqGrid("getRowData",rowid);if(rowdata){for(var i in rowdata){if($("[name="+i+"]",formid).is("input:radio")||$("[name="+i+"]",formid).is("input:checkbox")){$("[name="+i+"]",formid).each(function(){if($(this).val()==rowdata[i]){$(this).attr("checked","checked");}else{$(this).attr("checked","");}});}else{$("[name="+i+"]",formid).val(rowdata[i]);}}}});},FormToGrid:function(rowid,formid,mode,position){return this.each(function(){var $t=this;if(!$t.grid){return;}
if(!mode)mode='set';if(!position)position='first';var fields=$(formid).serializeArray();var griddata={};$.each(fields,function(i,field){griddata[field.name]=field.value;});if(mode=='add')$($t).jqGrid("addRowData",rowid,griddata,position);else if(mode=='set')$($t).jqGrid("setRowData",rowid,griddata);});}});})(jQuery);jQuery.fn.searchFilter=function(fields,options){function SearchFilter(jQ,fields,options){this.$=jQ;this.add=function(i){if(i==null)jQ.find(".ui-add-last").click();else jQ.find(".sf:eq("+i+") .ui-add").click();return this;};this.del=function(i){if(i==null)jQ.find(".sf:last .ui-del").click();else jQ.find(".sf:eq("+i+") .ui-del").click();return this;};this.search=function(e){jQ.find(".ui-search").click();return this;};this.reset=function(e){jQ.find(".ui-reset").click();return this;};this.close=function(){jQ.find(".ui-closer").click();return this;};if(fields!=null){function hover(){jQuery(this).toggleClass("ui-state-hover");return false;}
function active(e){jQuery(this).toggleClass("ui-state-active",(e.type=="mousedown"));return false;}
function buildOpt(value,text){return"<option value='"+value+"'>"+text+"</option>";}
function buildSel(className,options,isHidden){return"<select class='"+className+"'"+(isHidden?" style='display:none;'":"")+">"+options+"</select>";}
function initData(selector,fn){var jElem=jQ.find("tr.sf td.data "+selector);if(jElem[0]!=null)
fn(jElem);}
function bindDataEvents(selector,events){var jElem=jQ.find("tr.sf td.data "+selector);if(jElem[0]!=null){jQuery.each(events,function(){if(this.data!=null)
jElem.bind(this.type,this.data,this.fn);else
jElem.bind(this.type,this.fn);});}}
var opts=jQuery.extend({},jQuery.fn.searchFilter.defaults,options);var highest_late_setup=-1;var gOps_html="";jQuery.each(opts.groupOps,function(){gOps_html+=buildOpt(this.op,this.text);});gOps_html="<select name='groupOp'>"+gOps_html+"</select>";jQ.html("").addClass("ui-searchFilter").append("<div class='ui-widget-overlay' style='z-index: -1'>&#160;</div><table class='ui-widget-content ui-corner-all'><thead><tr><td colspan='5' class='ui-widget-header ui-corner-all' style='line-height: 18px;'><div class='ui-closer ui-state-default ui-corner-all ui-helper-clearfix' style='float: right;'><span class='ui-icon ui-icon-close'></span></div>"+opts.windowTitle+"</td></tr></thead><tbody><tr class='sf'><td class='fields'></td><td class='ops'></td><td class='data'></td><td><div class='ui-del ui-state-default ui-corner-all'><span class='ui-icon ui-icon-minus'></span></div></td><td><div class='ui-add ui-state-default ui-corner-all'><span class='ui-icon ui-icon-plus'></span></div></td></tr><tr><td colspan='5' class='divider'><div>&#160;</div></td></tr></tbody><tfoot><tr><td colspan='3'><span class='ui-reset ui-state-default ui-corner-all' style='display: inline-block; float: left;'><span class='ui-icon ui-icon-arrowreturnthick-1-w' style='float: left;'></span><span style='line-height: 18px; padding: 0 7px 0 3px;'>"+opts.resetText+"</span></span><span class='ui-search ui-state-default ui-corner-all' style='display: inline-block; float: right;'><span class='ui-icon ui-icon-search' style='float: left;'></span><span style='line-height: 18px; padding: 0 7px 0 3px;'>"+opts.searchText+"</span></span><span class='matchText'>"+opts.matchText+"</span> "+gOps_html+" <span class='rulesText'>"+opts.rulesText+"</span></td><td>&#160;</td><td><div class='ui-add-last ui-state-default ui-corner-all'><span class='ui-icon ui-icon-plusthick'></span></div></td></tr></tfoot></table>");var jRow=jQ.find("tr.sf");var jFields=jRow.find("td.fields");var jOps=jRow.find("td.ops");var jData=jRow.find("td.data");var default_ops_html="";jQuery.each(opts.operators,function(){default_ops_html+=buildOpt(this.op,this.text);});default_ops_html=buildSel("default",default_ops_html,true);jOps.append(default_ops_html);var default_data_html="<input type='text' class='default' style='display:none;' />";jData.append(default_data_html);var fields_html="";var has_custom_ops=false;var has_custom_data=false;jQuery.each(fields,function(i){var field_num=i;fields_html+=buildOpt(this.itemval,this.text);if(this.ops!=null){has_custom_ops=true;var custom_ops="";jQuery.each(this.ops,function(){custom_ops+=buildOpt(this.op,this.text);});custom_ops=buildSel("field"+field_num,custom_ops,true);jOps.append(custom_ops);}
if(this.dataUrl!=null){if(i>highest_late_setup)highest_late_setup=i;has_custom_data=true;var dEvents=this.dataEvents;var iEvent=this.dataInit;var bs=this.buildSelect;jQuery.ajax(jQuery.extend({url:this.dataUrl,complete:function(data){var $d;if(bs!=null)$d=jQuery("<div />").append(bs(data));else $d=jQuery("<div />").append(data.responseText);$d.find("select").addClass("field"+field_num).hide();jData.append($d.html());if(iEvent)initData(".field"+i,iEvent);if(dEvents)bindDataEvents(".field"+i,dEvents);if(i==highest_late_setup){jQ.find("tr.sf td.fields select[name='field']").change();}}},opts.ajaxSelectOptions));}else if(this.dataValues!=null){has_custom_data=true;var custom_data="";jQuery.each(this.dataValues,function(){custom_data+=buildOpt(this.value,this.text);});custom_data=buildSel("field"+field_num,custom_data,true);jData.append(custom_data);}else if(this.dataEvents!=null||this.dataInit!=null){has_custom_data=true;var custom_data="<input type='text' class='field"+field_num+"' />";jData.append(custom_data);}
if(this.dataInit!=null&&i!=highest_late_setup)
initData(".field"+i,this.dataInit);if(this.dataEvents!=null&&i!=highest_late_setup)
bindDataEvents(".field"+i,this.dataEvents);});fields_html="<select name='field'>"+fields_html+"</select>";jFields.append(fields_html);var jFSelect=jFields.find("select[name='field']");if(has_custom_ops)jFSelect.change(function(e){var index=e.target.selectedIndex;var td=jQuery(e.target).parents("tr.sf").find("td.ops");td.find("select").removeAttr("name").hide();var jElem=td.find(".field"+index);if(jElem[0]==null)jElem=td.find(".default");jElem.attr("name","op").show();});else jOps.find(".default").attr("name","op").show();if(has_custom_data)jFSelect.change(function(e){var index=e.target.selectedIndex;var td=jQuery(e.target).parents("tr.sf").find("td.data");td.find("select,input").removeClass("vdata").hide();var jElem=td.find(".field"+index);if(jElem[0]==null)jElem=td.find(".default");jElem.show().addClass("vdata");});else jData.find(".default").show().addClass("vdata");if(has_custom_ops||has_custom_data)jFSelect.change();jQ.find(".ui-state-default").hover(hover,hover).mousedown(active).mouseup(active);jQ.find(".ui-closer").click(function(e){opts.onClose(jQuery(jQ.selector));return false;});jQ.find(".ui-del").click(function(e){var row=jQuery(e.target).parents(".sf");if(row.siblings(".sf").length>0){if(opts.datepickerFix===true&&jQuery.fn.datepicker!==undefined)
row.find(".hasDatepicker").datepicker("destroy");row.remove();}else{row.find("select[name='field']")[0].selectedIndex=0;row.find("select[name='op']")[0].selectedIndex=0;row.find(".data input").val("");row.find(".data select").each(function(){this.selectedIndex=0;});row.find("select[name='field']").change();}
return false;});jQ.find(".ui-add").click(function(e){var row=jQuery(e.target).parents(".sf");var newRow=row.clone(true).insertAfter(row);newRow.find(".ui-state-default").removeClass("ui-state-hover ui-state-active");if(opts.clone){newRow.find("select[name='field']")[0].selectedIndex=row.find("select[name='field']")[0].selectedIndex;var stupid_browser=(newRow.find("select[name='op']")[0]==null);if(!stupid_browser)
newRow.find("select[name='op']").focus()[0].selectedIndex=row.find("select[name='op']")[0].selectedIndex;var jElem=newRow.find("select.vdata");if(jElem[0]!=null)
jElem[0].selectedIndex=row.find("select.vdata")[0].selectedIndex;}else{newRow.find(".data input").val("");newRow.find("select[name='field']").focus();}
if(opts.datepickerFix===true&&jQuery.fn.datepicker!==undefined){row.find(".hasDatepicker").each(function(){var settings=jQuery.data(this,"datepicker").settings;newRow.find("#"+this.id).unbind().removeAttr("id").removeClass("hasDatepicker").datepicker(settings);});}
newRow.find("select[name='field']").change();return false;});jQ.find(".ui-search").click(function(e){var ui=jQuery(jQ.selector);var ruleGroup;var group_op=ui.find("select[name='groupOp'] :selected").val();if(!opts.stringResult){ruleGroup={groupOp:group_op,rules:[]};}else{ruleGroup="{\"groupOp\":\""+group_op+"\",\"rules\":[";}
ui.find(".sf").each(function(i){var tField=jQuery(this).find("select[name='field'] :selected").val();var tOp=jQuery(this).find("select[name='op'] :selected").val();var tData=jQuery(this).find("input.vdata,select.vdata :selected").val();tData+="";tData=tData.replace(/\\/g,'\\\\').replace(/\"/g,'\\"');if(!opts.stringResult){ruleGroup.rules.push({field:tField,op:tOp,data:tData});}else{if(i>0)ruleGroup+=",";ruleGroup+="{\"field\":\""+tField+"\",";ruleGroup+="\"op\":\""+tOp+"\",";ruleGroup+="\"data\":\""+tData+"\"}";}});if(opts.stringResult)ruleGroup+="]}";opts.onSearch(ruleGroup);return false;});jQ.find(".ui-reset").click(function(e){var ui=jQuery(jQ.selector);ui.find(".ui-del").click();ui.find("select[name='groupOp']")[0].selectedIndex=0;opts.onReset();return false;});jQ.find(".ui-add-last").click(function(){var row=jQuery(jQ.selector+" .sf:last");var newRow=row.clone(true).insertAfter(row);newRow.find(".ui-state-default").removeClass("ui-state-hover ui-state-active");newRow.find(".data input").val("");newRow.find("select[name='field']").focus();if(opts.datepickerFix===true&&jQuery.fn.datepicker!==undefined){row.find(".hasDatepicker").each(function(){var settings=jQuery.data(this,"datepicker").settings;newRow.find("#"+this.id).unbind().removeAttr("id").removeClass("hasDatepicker").datepicker(settings);});}
newRow.find("select[name='field']").change();return false;});}}
return new SearchFilter(this,fields,options);};jQuery.fn.searchFilter.version='1.2.9';jQuery.fn.searchFilter.defaults={clone:true,datepickerFix:true,onReset:function(data){alert("Reset Clicked. Data Returned: "+data)},onSearch:function(data){alert("Search Clicked. Data Returned: "+data)},onClose:function(jElem){jElem.hide();},groupOps:[{op:"AND",text:"all"},{op:"OR",text:"any"}],operators:[{op:"eq",text:"is equal to"},{op:"ne",text:"is not equal to"},{op:"lt",text:"is less than"},{op:"le",text:"is less or equal to"},{op:"gt",text:"is greater than"},{op:"ge",text:"is greater or equal to"},{op:"in",text:"is in"},{op:"ni",text:"is not in"},{op:"bw",text:"begins with"},{op:"bn",text:"does not begin with"},{op:"ew",text:"ends with"},{op:"en",text:"does not end with"},{op:"cn",text:"contains"},{op:"nc",text:"does not contain"}],matchText:"match",rulesText:"rules",resetText:"Reset",searchText:"Search",stringResult:true,windowTitle:"Search Rules",ajaxSelectOptions:{}};;(function($){$.jgrid.extend({editRow:function(rowid,keys,oneditfunc,succesfunc,url,extraparam,aftersavefunc,errorfunc,afterrestorefunc){return this.each(function(){var $t=this,nm,tmp,editable,cnt=0,focus=null,svr={},ind,cm;if(!$t.grid){return;}
ind=$($t).jqGrid("getInd",rowid,true);if(ind==false){return;}
editable=$(ind).attr("editable")||"0";if(editable=="0"&&!$(ind).hasClass("not-editable-row")){cm=$t.p.colModel;$('td',ind).each(function(i){nm=cm[i].name;var treeg=$t.p.treeGrid===true&&nm==$t.p.ExpandColumn;if(treeg)tmp=$("span:first",this).html();else{try{tmp=$.unformat(this,{rowId:rowid,colModel:cm[i]},i);}catch(_){tmp=$(this).html();}}
if(nm!='cb'&&nm!='subgrid'&&nm!='rn'){if($t.p.autoencode)tmp=$.jgrid.htmlDecode(tmp);svr[nm]=tmp;if(cm[i].editable===true){if(focus===null){focus=i;}
if(treeg)$("span:first",this).html("");else $(this).html("");var opt=$.extend({},cm[i].editoptions||{},{id:rowid+"_"+nm,name:nm});if(!cm[i].edittype){cm[i].edittype="text";}
var elc=createEl(cm[i].edittype,opt,tmp,true,$.extend({},$.jgrid.ajaxOptions,$t.p.ajaxSelectOptions||{}));$(elc).addClass("editable");if(treeg)$("span:first",this).append(elc);else $(this).append(elc);if(cm[i].edittype=="select"&&cm[i].editoptions.multiple===true&&$.browser.msie){$(elc).width($(elc).width());}
cnt++;}}});if(cnt>0){svr['id']=rowid;$t.p.savedRow.push(svr);$(ind).attr("editable","1");$("td:eq("+focus+") input",ind).focus();if(keys===true){$(ind).bind("keydown",function(e){if(e.keyCode===27){$($t).jqGrid("restoreRow",rowid,afterrestorefunc);}
if(e.keyCode===13){var ta=e.target;if(ta.tagName=='TEXTAREA')return true;$($t).jqGrid("saveRow",rowid,succesfunc,url,extraparam,aftersavefunc,errorfunc,afterrestorefunc);return false;}
e.stopPropagation();});}
if($.isFunction(oneditfunc)){oneditfunc(rowid);}}}});},saveRow:function(rowid,succesfunc,url,extraparam,aftersavefunc,errorfunc,afterrestorefunc){return this.each(function(){var $t=this,nm,tmp={},tmp2={},editable,fr,cv,ind;if(!$t.grid){return;}
ind=$($t).jqGrid("getInd",rowid,true);if(ind==false){return;}
editable=$(ind).attr("editable");url=url?url:$t.p.editurl;if(editable==="1"&&url){var cm;$("td",ind).each(function(i){cm=$t.p.colModel[i];nm=cm.name;if(nm!='cb'&&nm!='subgrid'&&cm.editable===true&&nm!='rn'){switch(cm.edittype){case"checkbox":var cbv=["Yes","No"];if(cm.editoptions){cbv=cm.editoptions.value.split(":");}
tmp[nm]=$("input",this).attr("checked")?cbv[0]:cbv[1];break;case'text':case'password':case'textarea':case"button":tmp[nm]=$("input, textarea",this).val();break;case'select':if(!cm.editoptions.multiple){tmp[nm]=$("select>option:selected",this).val();tmp2[nm]=$("select>option:selected",this).text();}else{var sel=$("select",this),selectedText=[];tmp[nm]=$(sel).val();if(tmp[nm])tmp[nm]=tmp[nm].join(",");else tmp[nm]="";$("select > option:selected",this).each(function(i,selected){selectedText[i]=$(selected).text();});tmp2[nm]=selectedText.join(",");}
if(cm.formatter&&cm.formatter=='select')tmp2={};break;case'custom':try{if(cm.editoptions&&$.isFunction(cm.editoptions.custom_value)){tmp[nm]=cm.editoptions.custom_value($(".customelement",this),'get');if(tmp[nm]===undefined)throw"e2";}else throw"e1";}catch(e){if(e=="e1")info_dialog(jQuery.jgrid.errors.errcap,"function 'custom_value' "+$.jgrid.edit.msg.nodefined,jQuery.jgrid.edit.bClose);if(e=="e2")info_dialog(jQuery.jgrid.errors.errcap,"function 'custom_value' "+$.jgrid.edit.msg.novalue,jQuery.jgrid.edit.bClose);else info_dialog(jQuery.jgrid.errors.errcap,e.message,jQuery.jgrid.edit.bClose);}
break;}
cv=checkValues(tmp[nm],i,$t);if(cv[0]===false){cv[1]=tmp[nm]+" "+cv[1];return false;}
if($t.p.autoencode)tmp[nm]=$.jgrid.htmlEncode(tmp[nm]);}});if(cv[0]===false){try{var positions=findPos($("#"+rowid)[0]);info_dialog($.jgrid.errors.errcap,cv[1],$.jgrid.edit.bClose,{left:positions[0],top:positions[1]});}catch(e){alert(cv[1]);}
return;}
if(tmp){var idname,opers,oper;opers=$t.p.prmNames;oper=opers.oper;idname=opers.id;tmp[oper]=opers.editoper;tmp[idname]=rowid;if(extraparam){tmp=$.extend({},tmp,extraparam);}}
if(url=='clientArray'){tmp=$.extend({},tmp,tmp2);if($t.p.autoencode){$.each(tmp,function(n,v){tmp[n]=$.jgrid.htmlDecode(v);});}
var resp=$($t).jqGrid("setRowData",rowid,tmp);$(ind).attr("editable","0");for(var k=0;k<$t.p.savedRow.length;k++){if($t.p.savedRow[k].id==rowid){fr=k;break;}}
if(fr>=0){$t.p.savedRow.splice(fr,1);}
if($.isFunction(aftersavefunc)){aftersavefunc(rowid,resp);}}else{$("#lui_"+$t.p.id).show();$.ajax($.extend({url:url,data:$.isFunction($t.p.serializeRowData)?$t.p.serializeRowData(tmp):tmp,type:"POST",complete:function(res,stat){$("#lui_"+$t.p.id).hide();if(stat==="success"){var ret;if($.isFunction(succesfunc)){ret=succesfunc(res);}
else ret=true;if(ret===true){if($t.p.autoencode){$.each(tmp,function(n,v){tmp[n]=$.jgrid.htmlDecode(v);});}
tmp=$.extend({},tmp,tmp2);$($t).jqGrid("setRowData",rowid,tmp);$(ind).attr("editable","0");for(var k=0;k<$t.p.savedRow.length;k++){if($t.p.savedRow[k].id==rowid){fr=k;break;}};if(fr>=0){$t.p.savedRow.splice(fr,1);}
if($.isFunction(aftersavefunc)){aftersavefunc(rowid,res);}}else{$($t).jqGrid("restoreRow",rowid,afterrestorefunc);}}},error:function(res,stat){$("#lui_"+$t.p.id).hide();if($.isFunction(errorfunc)){errorfunc(rowid,res,stat);}else{alert("Error Row: "+rowid+" Result: "+res.status+":"+res.statusText+" Status: "+stat);}}},$.jgrid.ajaxOptions,$t.p.ajaxRowOptions||{}));}
$(ind).unbind("keydown");}});},restoreRow:function(rowid,afterrestorefunc){return this.each(function(){var $t=this,fr,ind,ares={};if(!$t.grid){return;}
ind=$($t).jqGrid("getInd",rowid,true);if(ind==false){return;}
for(var k=0;k<$t.p.savedRow.length;k++){if($t.p.savedRow[k].id==rowid){fr=k;break;}}
if(fr>=0){if($.isFunction($.fn['datepicker'])){try{$("input.hasDatepicker","#"+ind.id).datepicker('hide');}catch(e){}}
$.each($t.p.colModel,function(i,n){if(this.editable==true&&this.name in $t.p.savedRow[fr]){ares[this.name]=$t.p.savedRow[fr][this.name];}});$($t).jqGrid("setRowData",rowid,ares);$(ind).attr("editable","0").unbind("keydown");$t.p.savedRow.splice(fr,1);}
if($.isFunction(afterrestorefunc))
{afterrestorefunc(rowid);}});}});})(jQuery);;(function($){$.jgrid.extend({editCell:function(iRow,iCol,ed){return this.each(function(){var $t=this,nm,tmp,cc;if(!$t.grid||$t.p.cellEdit!==true){return;}
iCol=parseInt(iCol,10);$t.p.selrow=$t.rows[iRow].id;if(!$t.p.knv){$($t).jqGrid("GridNav");}
if($t.p.savedRow.length>0){if(ed===true){if(iRow==$t.p.iRow&&iCol==$t.p.iCol){return;}}
$($t).jqGrid("saveCell",$t.p.savedRow[0].id,$t.p.savedRow[0].ic)}else{window.setTimeout(function(){$("#"+$t.p.knv).attr("tabindex","-1").focus();},0);}
nm=$t.p.colModel[iCol].name;if(nm=='subgrid'||nm=='cb'||nm=='rn'){return;}
cc=$("td:eq("+iCol+")",$t.rows[iRow]);if($t.p.colModel[iCol].editable===true&&ed===true&&!cc.hasClass("not-editable-cell")){if(parseInt($t.p.iCol)>=0&&parseInt($t.p.iRow)>=0){$("td:eq("+$t.p.iCol+")",$t.rows[$t.p.iRow]).removeClass("edit-cell ui-state-highlight");$($t.rows[$t.p.iRow]).removeClass("selected-row ui-state-hover");}
$(cc).addClass("edit-cell ui-state-highlight");$($t.rows[iRow]).addClass("selected-row ui-state-hover");try{tmp=$.unformat(cc,{rowId:$t.rows[iRow].id,colModel:$t.p.colModel[iCol]},iCol);}catch(_){tmp=$(cc).html();}
if($t.p.autoencode)tmp=$.jgrid.htmlDecode(tmp);if(!$t.p.colModel[iCol].edittype){$t.p.colModel[iCol].edittype="text";}
$t.p.savedRow.push({id:iRow,ic:iCol,name:nm,v:tmp});if($.isFunction($t.p.formatCell)){var tmp2=$t.p.formatCell($t.rows[iRow].id,nm,tmp,iRow,iCol);if(tmp2!=undefined){tmp=tmp2;}}
var opt=$.extend({},$t.p.colModel[iCol].editoptions||{},{id:iRow+"_"+nm,name:nm});var elc=createEl($t.p.colModel[iCol].edittype,opt,tmp,true,$.extend({},$.jgrid.ajaxOptions,$t.p.ajaxSelectOptions||{}));if($.isFunction($t.p.beforeEditCell)){$t.p.beforeEditCell($t.rows[iRow].id,nm,tmp,iRow,iCol);}
$(cc).html("").append(elc).attr("tabindex","0");window.setTimeout(function(){$(elc).focus();},0);$("input, select, textarea",cc).bind("keydown",function(e){if(e.keyCode===27){if($("input.hasDatepicker",cc).length>0){if($(".ui-datepicker").is(":hidden"))$($t).jqGrid("restoreCell",iRow,iCol);else $("input.hasDatepicker",cc).datepicker('hide');}
else
$($t).jqGrid("restoreCell",iRow,iCol);}
if(e.keyCode===13){$($t).jqGrid("saveCell",iRow,iCol);}
if(e.keyCode==9){if(!$t.grid.hDiv.loading){if(e.shiftKey){$($t).jqGrid("prevCell",iRow,iCol);}
else{$($t).jqGrid("nextCell",iRow,iCol);}}else{return false;}}
e.stopPropagation();});if($.isFunction($t.p.afterEditCell)){$t.p.afterEditCell($t.rows[iRow].id,nm,tmp,iRow,iCol);}}else{if(parseInt($t.p.iCol)>=0&&parseInt($t.p.iRow)>=0){$("td:eq("+$t.p.iCol+")",$t.rows[$t.p.iRow]).removeClass("edit-cell ui-state-highlight");$($t.rows[$t.p.iRow]).removeClass("selected-row ui-state-hover");}
cc.addClass("edit-cell ui-state-highlight");$($t.rows[iRow]).addClass("selected-row ui-state-hover");if($.isFunction($t.p.onSelectCell)){tmp=cc.html().replace(/\&#160\;/ig,'');$t.p.onSelectCell($t.rows[iRow].id,nm,tmp,iRow,iCol);}}
$t.p.iCol=iCol;$t.p.iRow=iRow;});},saveCell:function(iRow,iCol){return this.each(function(){var $t=this,fr;if(!$t.grid||$t.p.cellEdit!==true){return;}
if($t.p.savedRow.length>=1){fr=0;}else{fr=null;}
if(fr!=null){var cc=$("td:eq("+iCol+")",$t.rows[iRow]),v,v2,cm=$t.p.colModel[iCol],nm=cm.name,nmjq=$.jgrid.jqID(nm);switch(cm.edittype){case"select":if(!cm.editoptions.multiple){v=$("#"+iRow+"_"+nmjq+">option:selected",$t.rows[iRow]).val();v2=$("#"+iRow+"_"+nmjq+">option:selected",$t.rows[iRow]).text();}else{var sel=$("#"+iRow+"_"+nmjq,$t.rows[iRow]),selectedText=[];v=$(sel).val();if(v)v.join(",");else v="";$("option:selected",sel).each(function(i,selected){selectedText[i]=$(selected).text();});v2=selectedText.join(",");}
if(cm.formatter)v2=v;break;case"checkbox":var cbv=["Yes","No"];if(cm.editoptions){cbv=cm.editoptions.value.split(":");}
v=$("#"+iRow+"_"+nmjq,$t.rows[iRow]).attr("checked")?cbv[0]:cbv[1];v2=v;break;case"password":case"text":case"textarea":case"button":v=$("#"+iRow+"_"+nmjq,$t.rows[iRow]).val();v2=v;break;case'custom':try{if(cm.editoptions&&$.isFunction(cm.editoptions.custom_value)){v=cm.editoptions.custom_value($(".customelement",cc),'get');if(v===undefined)throw"e2";else v2=v;}else throw"e1";}catch(e){if(e=="e1")info_dialog(jQuery.jgrid.errors.errcap,"function 'custom_value' "+$.jgrid.edit.msg.nodefined,jQuery.jgrid.edit.bClose);if(e=="e2")info_dialog(jQuery.jgrid.errors.errcap,"function 'custom_value' "+$.jgrid.edit.msg.novalue,jQuery.jgrid.edit.bClose);else info_dialog(jQuery.jgrid.errors.errcap,e.message,jQuery.jgrid.edit.bClose);}
break;}
if(v2!=$t.p.savedRow[fr].v){if($.isFunction($t.p.beforeSaveCell)){var vv=$t.p.beforeSaveCell($t.rows[iRow].id,nm,v,iRow,iCol);if(vv){v=vv;}}
var cv=checkValues(v,iCol,$t);if(cv[0]===true){var addpost={};if($.isFunction($t.p.beforeSubmitCell)){addpost=$t.p.beforeSubmitCell($t.rows[iRow].id,nm,v,iRow,iCol);if(!addpost){addpost={};}}
if(v2=="")v2=" ";if($("input.hasDatepicker",cc).length>0)$("input.hasDatepicker",cc).datepicker('hide');if($t.p.cellsubmit=='remote'){if($t.p.cellurl){var postdata={};if($t.p.autoencode)v=$.jgrid.htmlEncode(v);postdata[nm]=v;var idname,oper,opers;opers=$t.p.prmNames;idname=opers.id;oper=opers.oper;postdata[idname]=$t.rows[iRow].id;postdata[oper]=opers.editoper;postdata=$.extend(addpost,postdata);$("#lui_"+$t.p.id).show();$t.grid.hDiv.loading=true;$.ajax($.extend({url:$t.p.cellurl,data:$.isFunction($t.p.serializeCellData)?$t.p.serializeCellData(postdata):postdata,type:"POST",complete:function(result,stat){$("#lui_"+$t.p.id).hide();$t.grid.hDiv.loading=false;if(stat=='success'){if($.isFunction($t.p.afterSubmitCell)){var ret=$t.p.afterSubmitCell(result,postdata.id,nm,v,iRow,iCol);if(ret[0]===true){$(cc).empty();$($t).jqGrid("setCell",$t.rows[iRow].id,iCol,v2);$(cc).addClass("dirty-cell");$($t.rows[iRow]).addClass("edited");if($.isFunction($t.p.afterSaveCell)){$t.p.afterSaveCell($t.rows[iRow].id,nm,v,iRow,iCol);}
$t.p.savedRow.splice(0,1);}else{info_dialog($.jgrid.errors.errcap,ret[1],$.jgrid.edit.bClose);$($t).jqGrid("restoreCell",iRow,iCol);}}else{$(cc).empty();$($t).jqGrid("setCell",$t.rows[iRow].id,iCol,v2);$(cc).addClass("dirty-cell");$($t.rows[iRow]).addClass("edited");if($.isFunction($t.p.afterSaveCell)){$t.p.afterSaveCell($t.rows[iRow].id,nm,v,iRow,iCol);}
$t.p.savedRow.splice(0,1);}}},error:function(res,stat){$("#lui_"+$t.p.id).hide();$t.grid.hDiv.loading=false;if($.isFunction($t.p.errorCell)){$t.p.errorCell(res,stat);$($t).jqGrid("restoreCell",iRow,iCol);}else{info_dialog($.jgrid.errors.errcap,res.status+" : "+res.statusText+"<br/>"+stat,$.jgrid.edit.bClose);$($t).jqGrid("restoreCell",iRow,iCol);}}},$.jgrid.ajaxOptions,$t.p.ajaxCellOptions||{}));}else{try{info_dialog($.jgrid.errors.errcap,$.jgrid.errors.nourl,$.jgrid.edit.bClose);$($t).jqGrid("restoreCell",iRow,iCol);}catch(e){}}}
if($t.p.cellsubmit=='clientArray'){$(cc).empty();$($t).jqGrid("setCell",$t.rows[iRow].id,iCol,v2);$(cc).addClass("dirty-cell");$($t.rows[iRow]).addClass("edited");if($.isFunction($t.p.afterSaveCell)){$t.p.afterSaveCell($t.rows[iRow].id,nm,v,iRow,iCol);}
$t.p.savedRow.splice(0,1);}}else{try{window.setTimeout(function(){info_dialog($.jgrid.errors.errcap,v+" "+cv[1],$.jgrid.edit.bClose)},100);$($t).jqGrid("restoreCell",iRow,iCol);}catch(e){}}}else{$($t).jqGrid("restoreCell",iRow,iCol);}}
if($.browser.opera){$("#"+$t.p.knv).attr("tabindex","-1").focus();}else{window.setTimeout(function(){$("#"+$t.p.knv).attr("tabindex","-1").focus();},0);}});},restoreCell:function(iRow,iCol){return this.each(function(){var $t=this,fr;if(!$t.grid||$t.p.cellEdit!==true){return;}
if($t.p.savedRow.length>=1){fr=0;}else{fr=null;}
if(fr!=null){var cc=$("td:eq("+iCol+")",$t.rows[iRow]);if($.isFunction($.fn['datepicker'])){try{$("input.hasDatepicker",cc).datepicker('hide');}catch(e){}}
$(cc).empty().attr("tabindex","-1");$($t).jqGrid("setCell",$t.rows[iRow].id,iCol,$t.p.savedRow[fr].v);$t.p.savedRow.splice(0,1);}
window.setTimeout(function(){$("#"+$t.p.knv).attr("tabindex","-1").focus();},0);});},nextCell:function(iRow,iCol){return this.each(function(){var $t=this,nCol=false;if(!$t.grid||$t.p.cellEdit!==true){return;}
for(var i=iCol+1;i<$t.p.colModel.length;i++){if($t.p.colModel[i].editable===true){nCol=i;break;}}
if(nCol!==false){$($t).jqGrid("editCell",iRow,nCol,true);}else{if($t.p.savedRow.length>0){$($t).jqGrid("saveCell",iRow,iCol);}}});},prevCell:function(iRow,iCol){return this.each(function(){var $t=this,nCol=false;if(!$t.grid||$t.p.cellEdit!==true){return;}
for(var i=iCol-1;i>=0;i--){if($t.p.colModel[i].editable===true){nCol=i;break;}}
if(nCol!==false){$($t).jqGrid("editCell",iRow,nCol,true);}else{if($t.p.savedRow.length>0){$($t).jqGrid("saveCell",iRow,iCol);}}});},GridNav:function(){return this.each(function(){var $t=this;if(!$t.grid||$t.p.cellEdit!==true){return;}
$t.p.knv=$t.p.id+"_kn";var selection=$("<span style='width:0px;height:0px;background-color:black;' tabindex='0'><span tabindex='-1' style='width:0px;height:0px;background-color:grey' id='"+$t.p.knv+"'></span></span>"),i,kdir;$(selection).insertBefore($t.grid.cDiv);$("#"+$t.p.knv).focus().keydown(function(e){kdir=e.keyCode;if($t.p.direction=="rtl"){if(kdir==37)kdir=39;else if(kdir==39)kdir=37;}
switch(kdir){case 38:if($t.p.iRow-1>=0){scrollGrid($t.p.iRow-1,$t.p.iCol,'vu');$($t).jqGrid("editCell",$t.p.iRow-1,$t.p.iCol,false);}
break;case 40:if($t.p.iRow+1<=$t.rows.length-1){scrollGrid($t.p.iRow+1,$t.p.iCol,'vd');$($t).jqGrid("editCell",$t.p.iRow+1,$t.p.iCol,false);}
break;case 37:if($t.p.iCol-1>=0){i=findNextVisible($t.p.iCol-1,'lft');scrollGrid($t.p.iRow,i,'h');$($t).jqGrid("editCell",$t.p.iRow,i,false);}
break;case 39:if($t.p.iCol+1<=$t.p.colModel.length-1){i=findNextVisible($t.p.iCol+1,'rgt');scrollGrid($t.p.iRow,i,'h');$($t).jqGrid("editCell",$t.p.iRow,i,false);}
break;case 13:if(parseInt($t.p.iCol,10)>=0&&parseInt($t.p.iRow,10)>=0){$($t).jqGrid("editCell",$t.p.iRow,$t.p.iCol,true);}
break;}
return false;});function scrollGrid(iR,iC,tp){if(tp.substr(0,1)=='v'){var ch=$($t.grid.bDiv)[0].clientHeight,st=$($t.grid.bDiv)[0].scrollTop,nROT=$t.rows[iR].offsetTop+$t.rows[iR].clientHeight,pROT=$t.rows[iR].offsetTop;if(tp=='vd'){if(nROT>=ch){$($t.grid.bDiv)[0].scrollTop=$($t.grid.bDiv)[0].scrollTop+$t.rows[iR].clientHeight;}}
if(tp=='vu'){if(pROT<st){$($t.grid.bDiv)[0].scrollTop=$($t.grid.bDiv)[0].scrollTop-$t.rows[iR].clientHeight;}}}
if(tp=='h'){var cw=$($t.grid.bDiv)[0].clientWidth,sl=$($t.grid.bDiv)[0].scrollLeft,nCOL=$t.rows[iR].cells[iC].offsetLeft+$t.rows[iR].cells[iC].clientWidth,pCOL=$t.rows[iR].cells[iC].offsetLeft;if(nCOL>=cw+parseInt(sl)){$($t.grid.bDiv)[0].scrollLeft=$($t.grid.bDiv)[0].scrollLeft+$t.rows[iR].cells[iC].clientWidth;}else if(pCOL<sl){$($t.grid.bDiv)[0].scrollLeft=$($t.grid.bDiv)[0].scrollLeft-$t.rows[iR].cells[iC].clientWidth;}}};function findNextVisible(iC,act){var ind,i;if(act=='lft'){ind=iC+1;for(i=iC;i>=0;i--){if($t.p.colModel[i].hidden!==true){ind=i;break;}}}
if(act=='rgt'){ind=iC-1;for(i=iC;i<$t.p.colModel.length;i++){if($t.p.colModel[i].hidden!==true){ind=i;break;}}}
return ind;};});},getChangedCells:function(mthd){var ret=[];if(!mthd){mthd='all';}
this.each(function(){var $t=this,nm;if(!$t.grid||$t.p.cellEdit!==true){return;}
$($t.rows).each(function(j){var res={};if($(this).hasClass("edited")){$('td',this).each(function(i){nm=$t.p.colModel[i].name;if(nm!=='cb'&&nm!=='subgrid'){if(mthd=='dirty'){if($(this).hasClass('dirty-cell')){try{res[nm]=$.unformat(this,{rowId:$t.rows[j].id,colModel:$t.p.colModel[i]},i);}catch(e){res[nm]=$.jgrid.htmlDecode($(this).html());}}}else{try{res[nm]=$.unformat(this,{rowId:$t.rows[j].id,colModel:$t.p.colModel[i]},i);}catch(e){res[nm]=$.jgrid.htmlDecode($(this).html());}}}});res["id"]=this.id;ret.push(res);}});});return ret;}});})(jQuery);;(function($){$.jgrid.extend({setSubGrid:function(){return this.each(function(){var $t=this,cm;$t.p.colNames.unshift("");$t.p.colModel.unshift({name:'subgrid',width:$.browser.safari?$t.p.subGridWidth+$t.p.cellLayout:$t.p.subGridWidth,sortable:false,resizable:false,hidedlg:true,search:false,fixed:true});cm=$t.p.subGridModel;if(cm[0]){cm[0].align=$.extend([],cm[0].align||[]);for(i=0;i<cm[0].name.length;i++){cm[0].align[i]=cm[0].align[i]||'left';}}});},addSubGridCell:function(pos,iRow){var prp='',gv;this.each(function(){prp=this.formatCol(pos,iRow);gv=this.p.gridview;});if(gv===false){return"<td role='grid' class='ui-sgcollapsed sgcollapsed' "+prp+"><a href='javascript:void(0);'><span class='ui-icon ui-icon-plus'></span></a></td>";}else{return"<td role='grid' "+prp+"></td>";}},addSubGrid:function(t,pos){return this.each(function(){var ts=this;if(!ts.grid){return;}
var res,_id,pID,atd,nhc,subdata,bfsc;$("td:eq("+pos+")",t).click(function(e){if($(this).hasClass("sgcollapsed")){pID=ts.p.id;res=$(this).parent();atd=pos>=1?"<td colspan='"+pos+"'>&#160;</td>":"";_id=$(res).attr("id");bfsc=true;if($.isFunction(ts.p.subGridBeforeExpand)){bfsc=ts.p.subGridBeforeExpand(pID+"_"+_id,_id);}
if(bfsc===false){return false;}
nhc=0;$.each(ts.p.colModel,function(i,v){if(this.hidden===true||this.name=='rn'||this.name=='cb'){nhc++;}});subdata="<tr role='row' class='ui-subgrid'>"+atd+"<td class='ui-widget-content subgrid-cell'><span class='ui-icon ui-icon-carat-1-sw'/></td><td colspan='"+parseInt(ts.p.colNames.length-1-nhc)+"' class='ui-widget-content subgrid-data'><div id="+pID+"_"+_id+" class='tablediv'>";$(this).parent().after(subdata+"</div></td></tr>");if($.isFunction(ts.p.subGridRowExpanded)){ts.p.subGridRowExpanded(pID+"_"+_id,_id);}else{populatesubgrid(res);}
$(this).html("<a href='javascript:void(0);'><span class='ui-icon ui-icon-minus'></span></a>").removeClass("sgcollapsed").addClass("sgexpanded");}else if($(this).hasClass("sgexpanded")){bfsc=true;if($.isFunction(ts.p.subGridRowColapsed)){res=$(this).parent();_id=$(res).attr("id");bfsc=ts.p.subGridRowColapsed(pID+"_"+_id,_id);};if(bfsc===false){return false;}
$(this).parent().next().remove(".ui-subgrid");$(this).html("<a href='javascript:void(0);'><span class='ui-icon ui-icon-plus'></span></a>").removeClass("sgexpanded").addClass("sgcollapsed");}
return false;});var populatesubgrid=function(rd){var res,sid,dp,i,j;sid=$(rd).attr("id");dp={nd_:(new Date().getTime())};dp[ts.p.idName]=sid;if(!ts.p.subGridModel[0]){return false;}
if(ts.p.subGridModel[0].params){for(j=0;j<ts.p.subGridModel[0].params.length;j++){for(i=0;i<ts.p.colModel.length;i++){if(ts.p.colModel[i].name==ts.p.subGridModel[0].params[j]){dp[ts.p.colModel[i].name]=$("td:eq("+i+")",rd).text().replace(/\&#160\;/ig,'');}}}}
if(!ts.grid.hDiv.loading){ts.grid.hDiv.loading=true;$("#load_"+ts.p.id).show();if(!ts.p.subgridtype)ts.p.subgridtype=ts.p.datatype;if($.isFunction(ts.p.subgridtype)){ts.p.subgridtype(dp);}else{ts.p.subgridtype=ts.p.subgridtype.toLowerCase();}
switch(ts.p.subgridtype){case"xml":case"json":$.ajax($.extend({type:ts.p.mtype,url:ts.p.subGridUrl,dataType:ts.p.subgridtype,data:$.isFunction(ts.p.serializeSubGridData)?ts.p.serializeSubGridData(dp):dp,complete:function(sxml){if(ts.p.subgridtype=="xml")
subGridXml(sxml.responseXML,sid);else{subGridJson($.jgrid.parse(sxml.responseText),sid);}
sxml=null;}},$.jgrid.ajaxOptions,ts.p.ajaxSubgridOptions||{}));break;}}
return false;};var subGridCell=function(trdiv,cell,pos){var tddiv=$("<td align='"+ts.p.subGridModel[0].align[pos]+"'></td>").html(cell);$(trdiv).append(tddiv);};var subGridXml=function(sjxml,sbid){var tddiv,i,cur,sgmap,dummy=$("<table cellspacing='0' cellpadding='0' border='0'><tbody></tbody></table>"),trdiv=$("<tr></tr>");for(i=0;i<ts.p.subGridModel[0].name.length;i++){tddiv=$("<th class='ui-state-default ui-th-subgrid ui-th-column ui-th-"+ts.p.direction+"'></th>");$(tddiv).html(ts.p.subGridModel[0].name[i]);$(tddiv).width(ts.p.subGridModel[0].width[i]);$(trdiv).append(tddiv);}
$(dummy).append(trdiv);if(sjxml){sgmap=ts.p.xmlReader.subgrid;$(sgmap.root+" "+sgmap.row,sjxml).each(function(){trdiv=$("<tr class='ui-widget-content ui-subtblcell'></tr>");if(sgmap.repeatitems===true){$(sgmap.cell,this).each(function(i){subGridCell(trdiv,$(this).text()||'&#160;',i);});}else{var f=ts.p.subGridModel[0].mapping||ts.p.subGridModel[0].name;if(f){for(i=0;i<f.length;i++){subGridCell(trdiv,$(f[i],this).text()||'&#160;',i);}}}
$(dummy).append(trdiv);});}
var pID=$("table:first",ts.grid.bDiv).attr("id")+"_";$("#"+pID+sbid).append(dummy);ts.grid.hDiv.loading=false;$("#load_"+ts.p.id).hide();return false;};var subGridJson=function(sjxml,sbid){var tddiv,result,i,cur,sgmap,dummy=$("<table cellspacing='0' cellpadding='0' border='0'><tbody></tbody></table>"),trdiv=$("<tr></tr>");for(i=0;i<ts.p.subGridModel[0].name.length;i++){tddiv=$("<th class='ui-state-default ui-th-subgrid ui-th-column ui-th-"+ts.p.direction+"'></th>");$(tddiv).html(ts.p.subGridModel[0].name[i]);$(tddiv).width(ts.p.subGridModel[0].width[i]);$(trdiv).append(tddiv);}
$(dummy).append(trdiv);if(sjxml){sgmap=ts.p.jsonReader.subgrid;result=sjxml[sgmap.root];if(typeof result!=='undefined'){for(i=0;i<result.length;i++){cur=result[i];trdiv=$("<tr class='ui-widget-content ui-subtblcell'></tr>");if(sgmap.repeatitems===true){if(sgmap.cell){cur=cur[sgmap.cell];}
for(var j=0;j<cur.length;j++){subGridCell(trdiv,cur[j]||'&#160;',j);}}else{var f=ts.p.subGridModel[0].mapping||ts.p.subGridModel[0].name;if(f.length){for(var j=0;j<f.length;j++){subGridCell(trdiv,cur[f[j]]||'&#160;',j);}}}
$(dummy).append(trdiv);}}}
var pID=$("table:first",ts.grid.bDiv).attr("id")+"_";$("#"+pID+sbid).append(dummy);ts.grid.hDiv.loading=false;$("#load_"+ts.p.id).hide();return false;};ts.subGridXml=function(xml,sid){subGridXml(xml,sid);};ts.subGridJson=function(json,sid){subGridJson(json,sid);};});},expandSubGridRow:function(rowid){return this.each(function(){var $t=this;if(!$t.grid&&!rowid){return;}
if($t.p.subGrid===true){var rc=$(this).jqGrid("getInd",rowid,true);if(rc){var sgc=$("td.sgcollapsed",rc)[0];if(sgc){$(sgc).trigger("click");}}}});},collapseSubGridRow:function(rowid){return this.each(function(){var $t=this;if(!$t.grid&&!rowid){return;}
if($t.p.subGrid===true){var rc=$(this).jqGrid("getInd",rowid,true);if(rc){var sgc=$("td.sgexpanded",rc)[0];if(sgc){$(sgc).trigger("click");}}}});},toggleSubGridRow:function(rowid){return this.each(function(){var $t=this;if(!$t.grid&&!rowid){return;}
if($t.p.subGrid===true){var rc=$(this).jqGrid("getInd",rowid,true);if(rc){var sgc=$("td.sgcollapsed",rc)[0];if(sgc){$(sgc).trigger("click");}else{sgc=$("td.sgexpanded",rc)[0];if(sgc){$(sgc).trigger("click");}}}}});}});})(jQuery);;(function($){$.jgrid.extend({setTreeNode:function(rd,row){return this.each(function(){var $t=this;if(!$t.grid||!$t.p.treeGrid){return;}
var expCol=$t.p.expColInd;var expanded=$t.p.treeReader.expanded_field;var isLeaf=$t.p.treeReader.leaf_field;var level=$t.p.treeReader.level_field;row.level=rd[level];if($t.p.treeGridModel=='nested'){row.lft=rd[$t.p.treeReader.left_field];row.rgt=rd[$t.p.treeReader.right_field];if(!rd[isLeaf]){rd[isLeaf]=(parseInt(row.rgt,10)===parseInt(row.lft,10)+1)?'true':'false';}}else{row.parent_id=rd[$t.p.treeReader.parent_id_field];}
var curLevel=parseInt(row.level,10),ident,lftpos;if($t.p.tree_root_level===0){ident=curLevel+1;lftpos=curLevel;}else{ident=curLevel;lftpos=curLevel-1;}
var twrap="<div class='tree-wrap tree-wrap-"+$t.p.direction+"' style='width:"+(ident*18)+"px;'>";twrap+="<div style='"+($t.p.direction=="rtl"?"right:":"left:")+(lftpos*18)+"px;' class='ui-icon ";if(rd[isLeaf]=="true"||rd[isLeaf]==true){twrap+=$t.p.treeIcons.leaf+" tree-leaf'";row.isLeaf=true;}else{if(rd[expanded]=="true"||rd[expanded]==true){twrap+=$t.p.treeIcons.minus+" tree-minus treeclick'";row.expanded=true;}else{twrap+=$t.p.treeIcons.plus+" tree-plus treeclick'";row.expanded=false;}
row.isLeaf=false;}
twrap+="</div></div>";if(parseInt(rd[level],10)!==parseInt($t.p.tree_root_level,10)){if(!$($t).jqGrid("isVisibleNode",row)){$(row).css("display","none");}}
$("td:eq("+expCol+")",row).wrapInner("<span></span>").prepend(twrap);$(".treeclick",row).bind("click",function(e){var target=e.target||e.srcElement;var ind=$(target,$t.rows).parents("tr.jqgrow")[0].rowIndex;if(!$t.rows[ind].isLeaf){if($t.rows[ind].expanded){$($t).jqGrid("collapseRow",$t.rows[ind]);$($t).jqGrid("collapseNode",$t.rows[ind]);}else{$($t).jqGrid("expandRow",$t.rows[ind]);$($t).jqGrid("expandNode",$t.rows[ind]);}}
return false;});if($t.p.ExpandColClick===true){$("span",row).css("cursor","pointer").bind("click",function(e){var target=e.target||e.srcElement;var ind=$(target,$t.rows).parents("tr.jqgrow")[0].rowIndex;if(!$t.rows[ind].isLeaf){if($t.rows[ind].expanded){$($t).jqGrid("collapseRow",$t.rows[ind]);$($t).jqGrid("collapseNode",$t.rows[ind]);}else{$($t).jqGrid("expandRow",$t.rows[ind]);$($t).jqGrid("expandNode",$t.rows[ind]);}}
$($t).jqGrid("setSelection",$t.rows[ind].id);return false;});}});},setTreeGrid:function(){return this.each(function(){var $t=this,i=0,pico;if(!$t.p.treeGrid){return;}
if(!$t.p.treedatatype)$.extend($t.p,{treedatatype:$t.p.datatype});$t.p.subGrid=false;$t.p.altRows=false;$t.p.pgbuttons=false;$t.p.pginput=false;$t.p.multiselect=false;$t.p.rowList=[];pico='ui-icon-triangle-1-'+($t.p.direction=="rtl"?'w':'e');$t.p.treeIcons=$.extend({plus:pico,minus:'ui-icon-triangle-1-s',leaf:'ui-icon-radio-off'},$t.p.treeIcons||{});if($t.p.treeGridModel=='nested'){$t.p.treeReader=$.extend({level_field:"level",left_field:"lft",right_field:"rgt",leaf_field:"isLeaf",expanded_field:"expanded"},$t.p.treeReader);}else
if($t.p.treeGridModel=='adjacency'){$t.p.treeReader=$.extend({level_field:"level",parent_id_field:"parent",leaf_field:"isLeaf",expanded_field:"expanded"},$t.p.treeReader);}
for(var key in $t.p.colModel){if($t.p.colModel[key].name==$t.p.ExpandColumn){$t.p.expColInd=i;break;}
i++;}
if(!$t.p.expColInd)$t.p.expColInd=0;$.each($t.p.treeReader,function(i,n){if(n){$t.p.colNames.push(n);$t.p.colModel.push({name:n,width:1,hidden:true,sortable:false,resizable:false,hidedlg:true,editable:true,search:false});}});});},expandRow:function(record){this.each(function(){var $t=this;if(!$t.grid||!$t.p.treeGrid){return;}
var childern=$($t).jqGrid("getNodeChildren",record);$(childern).each(function(i){$(this).css("display","");if(this.expanded){$($t).jqGrid("expandRow",this);}});});},collapseRow:function(record){this.each(function(){var $t=this;if(!$t.grid||!$t.p.treeGrid){return;}
var childern=$($t).jqGrid("getNodeChildren",record);$(childern).each(function(i){$(this).css("display","none");if(this.expanded)
$($t).jqGrid("collapseRow",this);});});},getRootNodes:function(){var result=[];this.each(function(){var $t=this;if(!$t.grid||!$t.p.treeGrid){return;}
switch($t.p.treeGridModel){case'nested':var level=$t.p.treeReader.level_field;$($t.rows).each(function(i){if(parseInt(this[level],10)===parseInt($t.p.tree_root_level,10)){result.push(this);}});break;case'adjacency':$($t.rows).each(function(i){if(this.parent_id==null||this.parent_id.toLowerCase()=="null"){result.push(this);}});break;}});return result;},getNodeDepth:function(rc){var ret=null;this.each(function(){var $t=this;if(!this.grid||!this.p.treeGrid){return;}
switch($t.p.treeGridModel){case'nested':ret=parseInt(rc.level,10)-parseInt(this.p.tree_root_level,10);break;case'adjacency':ret=$($t).jqGrid("getNodeAncestors",rc).length;break;}});return ret;},getNodeParent:function(rc){var result=null;this.each(function(){var $t=this;if(!$t.grid||!$t.p.treeGrid){return;}
switch($t.p.treeGridModel){case'nested':var lft=parseInt(rc.lft,10),rgt=parseInt(rc.rgt,10),level=parseInt(rc.level,10);$(this.rows).each(function(){if(parseInt(this.level,10)===level-1&&parseInt(this.lft)<lft&&parseInt(this.rgt)>rgt){result=this;return false;}});break;case'adjacency':$(this.rows).each(function(){if(this.id==rc.parent_id){result=this;return false;}});break;}});return result;},getNodeChildren:function(rc){var result=[];this.each(function(){var $t=this;if(!$t.grid||!$t.p.treeGrid){return;}
switch($t.p.treeGridModel){case'nested':var lft=parseInt(rc.lft,10),rgt=parseInt(rc.rgt,10),level=parseInt(rc.level,10);$(this.rows).each(function(i){if(parseInt(this.level,10)===level+1&&parseInt(this.lft,10)>lft&&parseInt(this.rgt,10)<rgt){result.push(this);}});break;case'adjacency':$(this.rows).each(function(i){if(this.parent_id==rc.id){result.push(this);}});break;}});return result;},getFullTreeNode:function(rc){var result=[];this.each(function(){var $t=this;if(!$t.grid||!$t.p.treeGrid){return;}
switch($t.p.treeGridModel){case'nested':var lft=parseInt(rc.lft,10),rgt=parseInt(rc.rgt,10),level=parseInt(rc.level,10);$(this.rows).each(function(i){if(parseInt(this.level,10)>=level&&parseInt(this.lft,10)>=lft&&parseInt(this.lft,10)<=rgt){result.push(this);}});break;case'adjacency':result.push(rc);$(this.rows).each(function(i){len=result.length;for(i=0;i<len;i++){if(result[i].id==this.parent_id){result.push(this);break;}}});break;}});return result;},getNodeAncestors:function(rc){var ancestors=[];this.each(function(){if(!this.grid||!this.p.treeGrid){return;}
var parent=$(this).jqGrid("getNodeParent",rc);while(parent){ancestors.push(parent);parent=$(this).jqGrid("getNodeParent",parent);}});return ancestors;},isVisibleNode:function(rc){var result=true;this.each(function(){var $t=this;if(!$t.grid||!$t.p.treeGrid){return;}
var ancestors=$($t).jqGrid("getNodeAncestors",rc);$(ancestors).each(function(){result=result&&this.expanded;if(!result){return false;}});});return result;},isNodeLoaded:function(rc){var result;this.each(function(){var $t=this;if(!$t.grid||!$t.p.treeGrid){return;}
if(rc.loaded!==undefined){result=rc.loaded;}else if(rc.isLeaf||$($t).jqGrid("getNodeChildren",rc).length>0){result=true;}else{result=false;}});return result;},expandNode:function(rc){return this.each(function(){if(!this.grid||!this.p.treeGrid){return;}
if(!rc.expanded){if($(this).jqGrid("isNodeLoaded",rc)){rc.expanded=true;$("div.treeclick",rc).removeClass(this.p.treeIcons.plus+" tree-plus").addClass(this.p.treeIcons.minus+" tree-minus");}else{rc.expanded=true;$("div.treeclick",rc).removeClass(this.p.treeIcons.plus+" tree-plus").addClass(this.p.treeIcons.minus+" tree-minus");this.p.treeANode=rc.rowIndex;this.p.datatype=this.p.treedatatype;if(this.p.treeGridModel=='nested'){$(this).jqGrid("setGridParam",{postData:{nodeid:rc.id,n_left:rc.lft,n_right:rc.rgt,n_level:rc.level}});}else{$(this).jqGrid("setGridParam",{postData:{nodeid:rc.id,parentid:rc.parent_id,n_level:rc.level}});}
$(this).trigger("reloadGrid");if(this.p.treeGridModel=='nested'){$(this).jqGrid("setGridParam",{postData:{nodeid:'',n_left:'',n_right:'',n_level:''}});}else{$(this).jqGrid("setGridParam",{postData:{nodeid:'',parentid:'',n_level:''}});}}}});},collapseNode:function(rc){return this.each(function(){if(!this.grid||!this.p.treeGrid){return;}
if(rc.expanded){rc.expanded=false;$("div.treeclick",rc).removeClass(this.p.treeIcons.minus+" tree-minus").addClass(this.p.treeIcons.plus+" tree-plus");}});},SortTree:function(newDir){return this.each(function(){if(!this.grid||!this.p.treeGrid){return;}
var i,len,rec,records=[],$t=this,roots=$(this).jqGrid("getRootNodes");roots.sort(function(a,b){if(a.sortKey<b.sortKey){return-newDir;}
if(a.sortKey>b.sortKey){return newDir;}
return 0;});if(roots[0]){$("td",roots[0]).each(function(k){$(this).css("width",$t.grid.headers[k].width+"px");});$t.grid.cols=roots[0].cells;}
for(i=0,len=roots.length;i<len;i++){rec=roots[i];records.push(rec);$(this).jqGrid("collectChildrenSortTree",records,rec,newDir);}
$.each(records,function(index,row){$('tbody',$t.grid.bDiv).append(row);row.sortKey=null;});});},collectChildrenSortTree:function(records,rec,newDir){return this.each(function(){if(!this.grid||!this.p.treeGrid){return;}
var i,len,child,children=$(this).jqGrid("getNodeChildren",rec);children.sort(function(a,b){if(a.sortKey<b.sortKey){return-newDir;}
if(a.sortKey>b.sortKey){return newDir;}
return 0;});for(i=0,len=children.length;i<len;i++){child=children[i];records.push(child);$(this).jqGrid("collectChildrenSortTree",records,child,newDir);}});},setTreeRow:function(rowid,data){var nm,success=false;this.each(function(){var t=this;if(!t.grid||!t.p.treeGrid){return;}
success=$(t).jqGrid("setRowData",rowid,data);});return success;},delTreeNode:function(rowid){return this.each(function(){var $t=this;if(!$t.grid||!$t.p.treeGrid){return;}
var rc=$($t).jqGrid("getInd",rowid,true);if(rc){var dr=$($t).jqGrid("getNodeChildren",rc);if(dr.length>0){for(var i=0;i<dr.length;i++){$($t).jqGrid("delRowData",dr[i].id);}}
$($t).jqGrid("delRowData",rc.id);}});}});})(jQuery);;(function($){$.jgrid.extend({jqGridImport:function(o){o=$.extend({imptype:"xml",impstring:"",impurl:"",mtype:"GET",impData:{},xmlGrid:{config:"roots>grid",data:"roots>rows"},jsonGrid:{config:"grid",data:"data"},ajaxOptions:{}},o||{});return this.each(function(){var $t=this;var XmlConvert=function(xml,o){var cnfg=$(o.xmlGrid.config,xml)[0];var xmldata=$(o.xmlGrid.data,xml)[0];if(xmlJsonClass.xml2json&&$.jgrid.parse){var jstr=xmlJsonClass.xml2json(cnfg," ");var jstr=$.jgrid.parse(jstr);for(var key in jstr){var jstr1=jstr[key];}
if(xmldata){var svdatatype=jstr.grid.datatype;jstr.grid.datatype='xmlstring';jstr.grid.datastr=xml;$($t).jqGrid(jstr1).jqGrid("setGridParam",{datatype:svdatatype});}else{$($t).jqGrid(jstr1);}
jstr=null;jstr1=null;}else{alert("xml2json or parse are not present");}};var JsonConvert=function(jsonstr,o){if(jsonstr&&typeof jsonstr=='string'){var json=$.jgrid.parse(jsonstr);var gprm=json[o.jsonGrid.config];var jdata=json[o.jsonGrid.data];if(jdata){var svdatatype=gprm.datatype;gprm.datatype='jsonstring';gprm.datastr=jdata;$($t).jqGrid(gprm).jqGrid("setGridParam",{datatype:svdatatype});}else{$($t).jqGrid(gprm);}}};switch(o.imptype){case'xml':$.ajax($.extend({url:o.impurl,type:o.mtype,data:o.impData,dataType:"xml",complete:function(xml,stat){if(stat=='success'){XmlConvert(xml.responseXML,o);if($.isFunction(o.importComplete)){o.importComplete(xml);}}
xml=null;}},o.ajaxOptions));break;case'xmlstring':if(o.impstring&&typeof o.impstring=='string'){var xmld=$.jgrid.stringToDoc(o.impstring);if(xmld){XmlConvert(xmld,o);if($.isFunction(o.importComplete)){o.importComplete(xmld);}
o.impstring=null;}
xmld=null;}
break;case'json':$.ajax($.extend({url:o.impurl,type:o.mtype,data:o.impData,dataType:"json",complete:function(json,stat){if(stat=='success'){JsonConvert(json.responseText,o);if($.isFunction(o.importComplete)){o.importComplete(json);}}
json=null;}},o.ajaxOptions));break;case'jsonstring':if(o.impstring&&typeof o.impstring=='string'){JsonConvert(o.impstring,o);if($.isFunction(o.importComplete)){o.importComplete(o.impstring);}
o.impstring=null;}
break;}});},jqGridExport:function(o){o=$.extend({exptype:"xmlstring",root:"grid",ident:"\t"},o||{});var ret=null;this.each(function(){if(!this.grid){return;}
var gprm=$.extend({},$(this).jqGrid("getGridParam"));if(gprm.rownumbers){gprm.colNames.splice(0,1);gprm.colModel.splice(0,1);}
if(gprm.multiselect){gprm.colNames.splice(0,1);gprm.colModel.splice(0,1);}
if(gprm.subgrid){gprm.colNames.splice(0,1);gprm.colModel.splice(0,1);}
if(gprm.treeGrid){for(var key in gprm.treeReader){gprm.colNames.splice(gprm.colNames.length-1);gprm.colModel.splice(gprm.colModel.length-1);}}
switch(o.exptype){case'xmlstring':ret="<"+o.root+">"+xmlJsonClass.json2xml(gprm,o.ident)+"</"+o.root+">";break;case'jsonstring':ret="{"+xmlJsonClass.toJson(gprm,o.root,o.ident)+"}";if(gprm.postData.filters!=undefined){ret=ret.replace(/filters":"/,'filters":');ret=ret.replace(/}]}"/,'}]}');}
break;}});return ret;},excelExport:function(o){o=$.extend({exptype:"remote",url:null,oper:"oper",tag:"excel",exportOptions:{}},o||{});return this.each(function(){$t=this;if(!this.grid){return;}
if(o.exptype=="remote"){var pdata=$.extend({},this.p.postData);pdata[o.oper]=o.tag;var params=jQuery.param(pdata);window.location=o.url+"?"+params;}});}});})(jQuery);var xmlJsonClass={xml2json:function(xml,tab){if(xml.nodeType===9){xml=xml.documentElement;}
var nws=this.removeWhite(xml);var obj=this.toObj(nws);var json=this.toJson(obj,xml.nodeName,"\t");return"{\n"+tab+(tab?json.replace(/\t/g,tab):json.replace(/\t|\n/g,""))+"\n}";},json2xml:function(o,tab){var toXml=function(v,name,ind){var xml="";var i,n;if(v instanceof Array){if(v.length===0){xml+=ind+"<"+name+">__EMPTY_ARRAY_</"+name+">\n";}
else{for(i=0,n=v.length;i<n;i+=1){var sXml=ind+toXml(v[i],name,ind+"\t")+"\n";xml+=sXml;}}}
else if(typeof(v)==="object"){var hasChild=false;xml+=ind+"<"+name;var m;for(m in v)if(v.hasOwnProperty(m)){if(m.charAt(0)==="@"){xml+=" "+m.substr(1)+"=\""+v[m].toString()+"\"";}
else{hasChild=true;}}
xml+=hasChild?">":"/>";if(hasChild){for(m in v)if(v.hasOwnProperty(m)){if(m==="#text"){xml+=v[m];}
else if(m==="#cdata"){xml+="<![CDATA["+v[m]+"]]>";}
else if(m.charAt(0)!=="@"){xml+=toXml(v[m],m,ind+"\t");}}
xml+=(xml.charAt(xml.length-1)==="\n"?ind:"")+"</"+name+">";}}
else if(typeof(v)==="function"){xml+=ind+"<"+name+">"+"<![CDATA["+v+"]]>"+"</"+name+">";}
else{if(v.toString()==="\"\""||v.toString().length===0){xml+=ind+"<"+name+">__EMPTY_STRING_</"+name+">";}
else{xml+=ind+"<"+name+">"+v.toString()+"</"+name+">";}}
return xml;};var xml="";var m;for(m in o)if(o.hasOwnProperty(m)){xml+=toXml(o[m],m,"");}
return tab?xml.replace(/\t/g,tab):xml.replace(/\t|\n/g,"");},toObj:function(xml){var o={};var FuncTest=/function/i;if(xml.nodeType===1){if(xml.attributes.length){var i;for(i=0;i<xml.attributes.length;i+=1){o["@"+xml.attributes[i].nodeName]=(xml.attributes[i].nodeValue||"").toString();}}
if(xml.firstChild){var textChild=0,cdataChild=0,hasElementChild=false;var n;for(n=xml.firstChild;n;n=n.nextSibling){if(n.nodeType===1){hasElementChild=true;}
else if(n.nodeType===3&&n.nodeValue.match(/[^ \f\n\r\t\v]/)){textChild+=1;}
else if(n.nodeType===4){cdataChild+=1;}}
if(hasElementChild){if(textChild<2&&cdataChild<2){this.removeWhite(xml);for(n=xml.firstChild;n;n=n.nextSibling){if(n.nodeType===3){o["#text"]=this.escape(n.nodeValue);}
else if(n.nodeType===4){if(FuncTest.test(n.nodeValue)){o[n.nodeName]=[o[n.nodeName],n.nodeValue];}else{o["#cdata"]=this.escape(n.nodeValue);}}
else if(o[n.nodeName]){if(o[n.nodeName]instanceof Array){o[n.nodeName][o[n.nodeName].length]=this.toObj(n);}
else{o[n.nodeName]=[o[n.nodeName],this.toObj(n)];}}
else{o[n.nodeName]=this.toObj(n);}}}
else{if(!xml.attributes.length){o=this.escape(this.innerXml(xml));}
else{o["#text"]=this.escape(this.innerXml(xml));}}}
else if(textChild){if(!xml.attributes.length){o=this.escape(this.innerXml(xml));if(o==="__EMPTY_ARRAY_"){o="[]";}else if(o==="__EMPTY_STRING_"){o="";}}
else{o["#text"]=this.escape(this.innerXml(xml));}}
else if(cdataChild){if(cdataChild>1){o=this.escape(this.innerXml(xml));}
else{for(n=xml.firstChild;n;n=n.nextSibling){if(FuncTest.test(xml.firstChild.nodeValue)){o=xml.firstChild.nodeValue;break;}else{o["#cdata"]=this.escape(n.nodeValue);}}}}}
if(!xml.attributes.length&&!xml.firstChild){o=null;}}
else if(xml.nodeType===9){o=this.toObj(xml.documentElement);}
else{alert("unhandled node type: "+xml.nodeType);}
return o;},toJson:function(o,name,ind){var json=name?("\""+name+"\""):"";if(o==="[]"){json+=(name?":[]":"[]");}
else if(o instanceof Array){var n,i,ar=[];for(i=0,n=o.length;i<n;i+=1){ar[i]=this.toJson(o[i],"",ind+"\t");}
json+=(name?":[":"[")+(ar.length>1?("\n"+ind+"\t"+ar.join(",\n"+ind+"\t")+"\n"+ind):ar.join(""))+"]";}
else if(o===null){json+=(name&&":")+"null";}
else if(typeof(o)==="object"){var arr=[];var m;for(m in o)if(o.hasOwnProperty(m)){arr[arr.length]=this.toJson(o[m],m,ind+"\t");}
json+=(name?":{":"{")+(arr.length>1?("\n"+ind+"\t"+arr.join(",\n"+ind+"\t")+"\n"+ind):arr.join(""))+"}";}
else if(typeof(o)==="string"){var objRegExp=/(^-?\d+\.?\d*$)/;var FuncTest=/function/i;var os=o.toString();if(objRegExp.test(os)||FuncTest.test(os)||os==="false"||os==="true"){json+=(name&&":")+os;}
else{json+=(name&&":")+"\""+o+"\"";}}
else{json+=(name&&":")+o.toString();}
return json;},innerXml:function(node){var s="";if("innerHTML"in node){s=node.innerHTML;}
else{var asXml=function(n){var s="",i;if(n.nodeType===1){s+="<"+n.nodeName;for(i=0;i<n.attributes.length;i+=1){s+=" "+n.attributes[i].nodeName+"=\""+(n.attributes[i].nodeValue||"").toString()+"\"";}
if(n.firstChild){s+=">";for(var c=n.firstChild;c;c=c.nextSibling){s+=asXml(c);}
s+="</"+n.nodeName+">";}
else{s+="/>";}}
else if(n.nodeType===3){s+=n.nodeValue;}
else if(n.nodeType===4){s+="<![CDATA["+n.nodeValue+"]]>";}
return s;};for(var c=node.firstChild;c;c=c.nextSibling){s+=asXml(c);}}
return s;},escape:function(txt){return txt.replace(/[\\]/g,"\\\\").replace(/[\"]/g,'\\"').replace(/[\n]/g,'\\n').replace(/[\r]/g,'\\r');},removeWhite:function(e){e.normalize();var n;for(n=e.firstChild;n;){if(n.nodeType===3){if(!n.nodeValue.match(/[^ \f\n\r\t\v]/)){var nxt=n.nextSibling;e.removeChild(n);n=nxt;}
else{n=n.nextSibling;}}
else if(n.nodeType===1){this.removeWhite(n);n=n.nextSibling;}
else{n=n.nextSibling;}}
return e;}};;(function($){$.jgrid.extend({setColumns:function(p){p=$.extend({top:0,left:0,width:200,height:'auto',dataheight:'auto',modal:false,drag:true,beforeShowForm:null,afterShowForm:null,afterSubmitForm:null,closeOnEscape:true,ShrinkToFit:false,jqModal:false,saveicon:[true,"left","ui-icon-disk"],closeicon:[true,"left","ui-icon-close"],onClose:null,colnameview:true,closeAfterSubmit:true,updateAfterCheck:false,recreateForm:false},$.jgrid.col,p||{});return this.each(function(){var $t=this;if(!$t.grid){return;}
var onBeforeShow=typeof p.beforeShowForm==='function'?true:false;var onAfterShow=typeof p.afterShowForm==='function'?true:false;var onAfterSubmit=typeof p.afterSubmitForm==='function'?true:false;var gID=$t.p.id,dtbl="ColTbl_"+gID,IDs={themodal:'colmod'+gID,modalhead:'colhd'+gID,modalcontent:'colcnt'+gID,scrollelm:dtbl};if(p.recreateForm===true&&$("#"+IDs.themodal).html()!=null){$("#"+IDs.themodal).remove();}
if($("#"+IDs.themodal).html()!=null){if(onBeforeShow){p.beforeShowForm($("#"+dtbl));}
viewModal("#"+IDs.themodal,{gbox:"#gbox_"+gID,jqm:p.jqModal,jqM:false,modal:p.modal});if(onAfterShow){p.afterShowForm($("#"+dtbl));}}else{var dh=isNaN(p.dataheight)?p.dataheight:p.dataheight+"px";var formdata="<div id='"+dtbl+"' class='formdata' style='width:100%;overflow:auto;position:relative;height:"+dh+";'>";formdata+="<table class='ColTable' cellspacing='1' cellpading='2' border='0'><tbody>";for(i=0;i<this.p.colNames.length;i++){if(!$t.p.colModel[i].hidedlg){formdata+="<tr><td style='white-space: pre;'><input type='checkbox' style='margin-right:5px;' id='col_"+this.p.colModel[i].name+"' class='cbox' value='T' "+
((this.p.colModel[i].hidden===false)?"checked":"")+"/>"+"<label for='col_"+this.p.colModel[i].name+"'>"+this.p.colNames[i]+((p.colnameview)?" ("+this.p.colModel[i].name+")":"")+"</label></td></tr>";}}
formdata+="</tbody></table></div>"
var bS=!p.updateAfterCheck?"<a href='javascript:void(0)' id='dData' class='fm-button ui-state-default ui-corner-all'>"+p.bSubmit+"</a>":"",bC="<a href='javascript:void(0)' id='eData' class='fm-button ui-state-default ui-corner-all'>"+p.bCancel+"</a>";formdata+="<table border='0' class='EditTable' id='"+dtbl+"_2'><tbody><tr style='display:block;height:3px;'><td></td></tr><tr><td class='DataTD ui-widget-content'></td></tr><tr><td class='ColButton EditButton'>"+bS+"&#160;"+bC+"</td></tr></tbody></table>";p.gbox="#gbox_"+gID;createModal(IDs,formdata,p,"#gview_"+$t.p.id,$("#gview_"+$t.p.id)[0]);if(p.saveicon[0]==true){$("#dData","#"+dtbl+"_2").addClass(p.saveicon[1]=="right"?'fm-button-icon-right':'fm-button-icon-left').append("<span class='ui-icon "+p.saveicon[2]+"'></span>");}
if(p.closeicon[0]==true){$("#eData","#"+dtbl+"_2").addClass(p.closeicon[1]=="right"?'fm-button-icon-right':'fm-button-icon-left').append("<span class='ui-icon "+p.closeicon[2]+"'></span>");}
if(!p.updateAfterCheck){$("#dData","#"+dtbl+"_2").click(function(e){for(i=0;i<$t.p.colModel.length;i++){if(!$t.p.colModel[i].hidedlg){var nm=$t.p.colModel[i].name.replace(".","\\.");if($("#col_"+nm,"#"+dtbl).attr("checked")){$($t).jqGrid("showCol",$t.p.colModel[i].name);$("#col_"+nm,"#"+dtbl).attr("defaultChecked",true);}else{$($t).jqGrid("hideCol",$t.p.colModel[i].name);$("#col_"+nm,"#"+dtbl).attr("defaultChecked","");}}}
if(p.ShrinkToFit===true){$($t).jqGrid("setGridWidth",$t.grid.width-0.001,true);}
if(p.closeAfterSubmit)hideModal("#"+IDs.themodal,{gb:"#gbox_"+gID,jqm:p.jqModal,onClose:p.onClose});if(onAfterSubmit){p.afterSubmitForm($("#"+dtbl));}
return false;});}else{$(":input","#"+dtbl).click(function(e){var cn=this.id.substr(4);if(cn){if(this.checked){$($t).jqGrid("showCol",cn);}else{$($t).jqGrid("hideCol",cn);}
if(p.ShrinkToFit===true){$($t).jqGrid("setGridWidth",$t.grid.width-0.001,true);}}
return this;});}
$("#eData","#"+dtbl+"_2").click(function(e){hideModal("#"+IDs.themodal,{gb:"#gbox_"+gID,jqm:p.jqModal,onClose:p.onClose});return false;});$("#dData, #eData","#"+dtbl+"_2").hover(function(){$(this).addClass('ui-state-hover');},function(){$(this).removeClass('ui-state-hover');});if(onBeforeShow){p.beforeShowForm($("#"+dtbl));}
viewModal("#"+IDs.themodal,{gbox:"#gbox_"+gID,jqm:p.jqModal,jqM:true,modal:p.modal});if(onAfterShow){p.afterShowForm($("#"+dtbl));}}});}});})(jQuery);;(function($){$.jgrid.extend({getPostData:function(){var $t=this[0];if(!$t.grid){return;}
return $t.p.postData;},setPostData:function(newdata){var $t=this[0];if(!$t.grid){return;}
if(typeof(newdata)==='object'){$t.p.postData=newdata;}
else{alert("Error: cannot add a non-object postData value. postData unchanged.");}},appendPostData:function(newdata){var $t=this[0];if(!$t.grid){return;}
if(typeof(newdata)==='object'){$.extend($t.p.postData,newdata);}
else{alert("Error: cannot append a non-object postData value. postData unchanged.");}},setPostDataItem:function(key,val){var $t=this[0];if(!$t.grid){return;}
$t.p.postData[key]=val;},getPostDataItem:function(key){var $t=this[0];if(!$t.grid){return;}
return $t.p.postData[key];},removePostDataItem:function(key){var $t=this[0];if(!$t.grid){return;}
delete $t.p.postData[key];},getUserData:function(){var $t=this[0];if(!$t.grid){return;}
return $t.p.userData;},getUserDataItem:function(key){var $t=this[0];if(!$t.grid){return;}
return $t.p.userData[key];}});})(jQuery);function tableToGrid(selector,options){jQuery(selector).each(function(){if(this.grid){return;}
jQuery(this).width("99%");var w=jQuery(this).width();var inputCheckbox=jQuery('input[type=checkbox]:first',jQuery(this));var inputRadio=jQuery('input[type=radio]:first',jQuery(this));var selectMultiple=inputCheckbox.length>0;var selectSingle=!selectMultiple&&inputRadio.length>0;var selectable=selectMultiple||selectSingle;var inputName=inputCheckbox.attr("name")||inputRadio.attr("name");var colModel=[];var colNames=[];jQuery('th',jQuery(this)).each(function(){if(colModel.length==0&&selectable){colModel.push({name:'__selection__',index:'__selection__',width:0,hidden:true});colNames.push('__selection__');}else{colModel.push({name:jQuery(this).attr("id")||jQuery.trim(jQuery.jgrid.stripHtml(jQuery(this).html())).split(' ').join('_'),index:jQuery(this).attr("id")||jQuery.trim(jQuery.jgrid.stripHtml(jQuery(this).html())).split(' ').join('_'),width:jQuery(this).width()||150});colNames.push(jQuery(this).html());}});var data=[];var rowIds=[];var rowChecked=[];jQuery('tbody > tr',jQuery(this)).each(function(){var row={};var rowPos=0;jQuery('td',jQuery(this)).each(function(){if(rowPos==0&&selectable){var input=jQuery('input',jQuery(this));var rowId=input.attr("value");rowIds.push(rowId||data.length);if(input.attr("checked")){rowChecked.push(rowId);}
row[colModel[rowPos].name]=input.attr("value");}else{row[colModel[rowPos].name]=jQuery(this).html();}
rowPos++;});if(rowPos>0)data.push(row);});jQuery(this).empty();jQuery(this).addClass("scroll");jQuery(this).jqGrid($.extend({datatype:"local",width:w,colNames:colNames,colModel:colModel,multiselect:selectMultiple},options||{}));for(var a=0;a<data.length;a++){var id=null;if(rowIds.length>0){id=rowIds[a];if(id&&id.replace){id=encodeURIComponent(id).replace(/[.\-%]/g,"_");}}
if(id==null){id=a+1;}
jQuery(this).jqGrid("addRowData",id,data[a]);}
for(var a=0;a<rowChecked.length;a++){jQuery(this).jqGrid("setSelection",rowChecked[a]);}});};;(function($){if($.browser.msie&&$.browser.version==8){$.expr[":"].hidden=function(elem){return elem.offsetWidth===0||elem.offsetHeight===0||elem.style.display=="none";}}
if($.ui&&$.ui.multiselect&&$.ui.multiselect.prototype._setSelected){var setSelected=$.ui.multiselect.prototype._setSelected;$.ui.multiselect.prototype._setSelected=function(item,selected){var ret=setSelected.call(this,item,selected);if(selected&&this.selectedList){var elt=this.element;this.selectedList.find('li').each(function(){if($(this).data('optionLink'))
$(this).data('optionLink').remove().appendTo(elt);});}
return ret;}}
$.jgrid.extend({sortableColumns:function(tblrow)
{return this.each(function(){var ts=this;function start(){ts.p.disableClick=true;};var sortable_opts={"tolerance":"pointer","axis":"x","items":'>th:not(:has(#jqgh_cb,#jqgh_rn,#jqgh_subgrid),:hidden)',"placeholder":{element:function(item){var el=$(document.createElement(item[0].nodeName)).addClass(item[0].className+" ui-sortable-placeholder ui-state-highlight").removeClass("ui-sortable-helper")[0];return el;},update:function(self,p){p.height(self.currentItem.innerHeight()-parseInt(self.currentItem.css('paddingTop')||0,10)-parseInt(self.currentItem.css('paddingBottom')||0,10));p.width(self.currentItem.innerWidth()-parseInt(self.currentItem.css('paddingLeft')||0,10)-parseInt(self.currentItem.css('paddingRight')||0,10));}},"update":function(event,ui){var p=$(ui.item).parent();var th=$(">th",p);var colModel=ts.p.colModel;var cmMap={};$.each(colModel,function(i){cmMap[this.name]=i});var permutation=[];th.each(function(i){var id=$(">div",this).get(0).id.replace(/^jqgh_/,"");if(id in cmMap){permutation.push(cmMap[id]);}});$(ts).jqGrid("remapColumns",permutation,true,true);if($.isFunction(ts.p.sortable.update)){ts.p.sortable.update(permutation);}
setTimeout(function(){ts.p.disableClick=false},50);}};if(ts.p.sortable.options){$.extend(sortable_opts,ts.p.sortable.options);}else if($.isFunction(ts.p.sortable)){ts.p.sortable={"update":ts.p.sortable};}
if(sortable_opts.start){var s=sortable_opts.start;sortable_opts.start=function(e,ui){start();s.call(this,e,ui);}}else{sortable_opts.start=start;}
if(ts.p.sortable.exclude){sortable_opts.items+=":not("+ts.p.sortable.exclude+")";}
tblrow.sortable(sortable_opts).data("sortable").floating=true;});},columnChooser:function(opts){var self=this;if($("#colchooser_"+self[0].p.id).length)return;var selector=$('<div id="colchooser_'+self[0].p.id+'" style="position:relative;overflow:hidden"><div><select multiple="multiple"></select></div></div>');var select=$('select',selector);opts=$.extend({"width":420,"height":240,"classname":null,"done":function(perm){if(perm)self.jqGrid("remapColumns",perm,true)},"msel":"multiselect","dlog":"dialog","dlog_opts":function(opts){var buttons={};buttons[opts.bSubmit]=function(){opts.apply_perm();opts.cleanup(false);};buttons[opts.bCancel]=function(){opts.cleanup(true);};return{"buttons":buttons,"close":function(){opts.cleanup(true);},"modal":false,"resizable":false,"width":opts.width+20};},"apply_perm":function(){$('option',select).each(function(i){if(this.selected){self.jqGrid("showCol",colModel[this.value].name);}else{self.jqGrid("hideCol",colModel[this.value].name);}});var perm=[];$('option[selected]',select).each(function(){perm.push(parseInt(this.value))});$.each(perm,function(){delete colMap[colModel[parseInt(this)].name]});$.each(colMap,function(){var ti=parseInt(this);perm=insert(perm,ti,ti);});if(opts.done){opts.done.call(self,perm);}},"cleanup":function(calldone){call(opts.dlog,selector,'destroy');call(opts.msel,select,'destroy');selector.remove();if(calldone&&opts.done){opts.done.call(self);}},"msel_opts":{}},$.jgrid.col,opts||{});if(opts.caption){selector.attr("title",opts.caption);}
if(opts.classname){selector.addClass(classname);select.addClass(classname);}
if(opts.width){$(">div",selector).css({"width":opts.width,"margin":"0 auto"});select.css("width",opts.width);}
if(opts.height){$(">div",selector).css("height",opts.height);select.css("height",opts.height-10);}
var colModel=self.jqGrid("getGridParam","colModel");var colNames=self.jqGrid("getGridParam","colNames");var colMap={},fixedCols=[];select.empty();$.each(colModel,function(i){colMap[this.name]=i;if(this.hidedlg){if(!this.hidden){fixedCols.push(i);}
return;}
select.append("<option value='"+i+"' "+
(this.hidden?"":"selected='selected'")+">"+colNames[i]+"</option>");});function insert(perm,i,v){if(i>=0){var a=perm.slice();var b=a.splice(i);if(i>perm.length)i=perm.length;a[i]=v;return a.concat(b);}}
function call(fn,obj){if(!fn)return;if(typeof fn=='string'){if($.fn[fn]){$.fn[fn].apply(obj,$.makeArray(arguments).slice(2));}}else if($.isFunction(fn)){fn.apply(obj,$.makeArray(arguments).slice(2));}}
var dopts=$.isFunction(opts.dlog_opts)?opts.dlog_opts.call(self,opts):opts.dlog_opts;call(opts.dlog,selector,dopts);var mopts=$.isFunction(opts.msel_opts)?opts.msel_opts.call(self,opts):opts.msel_opts;call(opts.msel,select,mopts);},sortableRows:function(opts){return this.each(function(){var $t=this;if(!$t.grid)return;if($t.p.treeGrid)return;if($.fn['sortable']){opts=$.extend({"cursor":"move","axis":"y","items":".jqgrow"},opts||{});if(opts.start&&$.isFunction(opts.start)){opts._start_=opts.start;delete opts.start;}else{opts._start_=false;}
if(opts.update&&$.isFunction(opts.update)){opts._update_=opts.update;delete opts.update;}else{opts._update_=false;}
opts.start=function(ev,ui){$(ui.item).css("border-width","0px");$("td",ui.item).each(function(i){this.style.width=$t.grid.cols[i].style.width;});if($t.p.subGrid){var subgid=$(ui.item).attr("id");try{$($t).jqGrid('collapseSubGridRow',subgid);}catch(e){}}
if(opts._start_){opts._start_.apply(this,[ev,ui]);}}
opts.update=function(ev,ui){$(ui.item).css("border-width","");$t.updateColumns();if($t.p.rownumbers===true){$("td.jqgrid-rownum",$t.rows).each(function(i){$(this).html(i+1);});}
if(opts._update_){opts._update_.apply(this,[ev,ui]);}}
$("tbody:first",$t).sortable(opts);}});},gridDnD:function(opts){return this.each(function(){var $t=this;if(!$t.grid)return;if($t.p.treeGrid)return;if(!$.fn['draggable']||!$.fn['droppable'])return;function updateDnD()
{var datadnd=$.data($t,"dnd");$("tr.jqgrow:not(.ui-draggable)",$t).draggable($.isFunction(datadnd.drag)?datadnd.drag.call($($t),datadnd):datadnd.drag);}
var appender="<table id='jqgrid_dnd' class='ui-jqgrid-dnd'></table>";if($("#jqgrid_dnd").html()==null){$('body').append(appender);}
if(typeof opts=='string'&&opts=='updateDnD'&&$t.p.jqgdnd==true){updateDnD();return;}
opts=$.extend({"drag":function(opts){return $.extend({start:function(ev,ui){if($t.p.subGrid){var subgid=$(ui.helper).attr("id");try{$($t).jqGrid('collapseSubGridRow',subgid);}catch(e){}}
for(var i=0;i<$.data($t,"dnd").connectWith.length;i++){if($($.data($t,"dnd").connectWith[i]).jqGrid('getGridParam','reccount')=="0"){$($.data($t,"dnd").connectWith[i]).jqGrid('addRowData','jqg_empty_row',{});}}
ui.helper.addClass("ui-state-highlight");$("td",ui.helper).each(function(i){this.style.width=$t.grid.headers[i].width+"px";});if(opts.onstart&&$.isFunction(opts.onstart))opts.onstart.call($($t),ev,ui);},stop:function(ev,ui){if(ui.helper.dropped){var ids=$(ui.helper).attr("id");$($t).jqGrid('delRowData',ids);}
for(var i=0;i<$.data($t,"dnd").connectWith.length;i++){$($.data($t,"dnd").connectWith[i]).jqGrid('delRowData','jqg_empty_row');}
if(opts.onstop&&$.isFunction(opts.onstop))opts.onstop.call($($t),ev,ui);}},opts.drag_opts||{});},"drop":function(opts){return $.extend({accept:function(d){var tid=$(d).closest("table.ui-jqgrid-btable");if($.data(tid[0],"dnd")!=undefined){var cn=$.data(tid[0],"dnd").connectWith;return $.inArray('#'+this.id,cn)!=-1?true:false;}
return d;},drop:function(ev,ui){var accept=$(ui.draggable).attr("id");var getdata=$('#'+$t.id).jqGrid('getRowData',accept);if(!opts.dropbyname){var j=0,tmpdata={},dropname;var dropmodel=$("#"+this.id).jqGrid('getGridParam','colModel');try{for(key in getdata){if(dropmodel[j]){dropname=dropmodel[j].name;tmpdata[dropname]=getdata[key];}
j++;}
getdata=tmpdata;}catch(e){}}
ui.helper.dropped=true;if(opts.beforedrop&&$.isFunction(opts.beforedrop)){var datatoinsert=opts.beforedrop.call(this,ev,ui,getdata,$('#'+$t.id),$(this));if(typeof datatoinsert!="undefined"&&datatoinsert!==null&&typeof datatoinsert=="object")getdata=datatoinsert;}
if(ui.helper.dropped){var grid;if(opts.autoid){if($.isFunction(opts.autoid)){grid=opts.autoid.call(this,getdata);}else{grid=Math.ceil(Math.random()*1000);grid=opts.autoidprefix+grid;}}
$("#"+this.id).jqGrid('addRowData',grid,getdata,opts.droppos);}
if(opts.ondrop&&$.isFunction(opts.ondrop))opts.ondrop.call(this,ev,ui,getdata);}},opts.drop_opts||{});},"onstart":null,"onstop":null,"beforedrop":null,"ondrop":null,"drop_opts":{"activeClass":"ui-state-active","hoverClass":"ui-state-hover"},"drag_opts":{"revert":"invalid","helper":"clone","cursor":"move","appendTo":"#jqgrid_dnd","zIndex":5000},"dropbyname":false,"droppos":"first","autoid":true,"autoidprefix":"dnd_"},opts||{});if(!opts.connectWith)return;opts.connectWith=opts.connectWith.split(",");opts.connectWith=$.map(opts.connectWith,function(n){return $.trim(n);});$.data($t,"dnd",opts);if($t.p.reccount!="0"&&!$t.p.jqgdnd){updateDnD();}
$t.p.jqgdnd=true;for(var i=0;i<opts.connectWith.length;i++){var cn=opts.connectWith[i]
$(cn).droppable($.isFunction(opts.drop)?opts.drop.call($($t),opts):opts.drop);};});},gridResize:function(opts){return this.each(function(){var $t=this;if(!$t.grid||!$.fn['resizable'])return;opts=$.extend({},opts||{});if(opts.alsoResize){opts._alsoResize_=opts.alsoResize;delete opts.alsoResize;}else{opts._alsoResize_=false;}
if(opts.stop&&$.isFunction(opts.stop)){opts._stop_=opts.stop;delete opts.stop;}else{opts._stop_=false;}
opts.stop=function(ev,ui){$($t).jqGrid('setGridParam',{height:$("#gview_"+$t.p.id+" .ui-jqgrid-bdiv").height()});$($t).jqGrid('setGridWidth',ui.size.width,opts.shrinkToFit);if(opts._stop_)opts._stop_.call($t,ev,ui);};if(opts._alsoResize_){var optstest="{'\#gview_"+$t.p.id+" .ui-jqgrid-bdiv\':true,'"+opts._alsoResize_+"':true}";opts.alsoResize=eval('('+optstest+')');}else{opts.alsoResize=$(".ui-jqgrid-bdiv","#gview_"+$t.p.id);}
delete opts._alsoResize_;$("#gbox_"+$t.p.id).resizable(opts);});}});})(jQuery);